import{d as V,r as b,o as i,c as l,a as k,b as e,F as U,e as D,t as _,f as p,w as h,v as y,g as B,h as O,i as g,j as M,n as q,k as A,u as ht,l as F,p as G,m as K,q as lt,s as tt,x as pt,y as ot,z as gt,A as ft,B as vt,C as $t,D as yt}from"./vendor.84d86c50.js";const bt=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))d(v);new MutationObserver(v=>{for(const f of v)if(f.type==="childList")for(const c of f.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&d(c)}).observe(document,{childList:!0,subtree:!0});function o(v){const f={};return v.integrity&&(f.integrity=v.integrity),v.referrerpolicy&&(f.referrerPolicy=v.referrerpolicy),v.crossorigin==="use-credentials"?f.credentials="include":v.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function d(v){if(v.ep)return;v.ep=!0;const f=o(v);fetch(v.href,f)}};bt();var I=(t,s)=>{for(const[o,d]of s)t[o]=d;return t};const _t=V({name:"app"}),wt={id:"app"};function kt(t,s,o,d,v,f){const c=b("router-view");return i(),l("div",wt,[k(c)])}var Ct=I(_t,[["render",kt]]);const St=V({data:()=>({widgets:null}),async created(){const t=await fetch("/api/page/index");if(t.status!==200){this.$router.push({name:"login"});return}const s=await t.json();this.widgets=s.widgets}}),Vt={key:0,id:"app"},It={id:"top",ref:"top"},Ut={id:"main",ref:"main"},Dt={class:"table is-striped is-fullwidth"},At=e("thead",null,[e("tr",null,[e("th",null,"Widget"),e("th",null,"Hint")])],-1),Pt=["href"];function Tt(t,s,o,d,v,f){const c=b("navbar");return t.widgets?(i(),l("div",Vt,[e("div",It,[k(c)],512),e("div",Ut,[e("table",Dt,[At,e("tbody",null,[(i(!0),l(U,null,D(t.widgets,(n,m)=>(i(),l("tr",{key:m},[e("td",null,[e("a",{href:n.url,target:"blank"},_(n.title),9,Pt)]),e("td",null,_(n.hint),1)]))),128))])])],512)])):p("",!0)}var Et=I(St,[["render",Tt]]);let et=null;const Ft=async t=>{const s=await fetch(t);return s.status===200?await s.json():null};async function at(){et=await Ft("/api/user/me")}async function Mt(){return(await(await fetch("/api/logout",{method:"POST"})).json()).success?(et=null,{error:!1}):{error:"[2021-09-25 18:36]"}}async function zt(t,s){const o=await fetch("/api/auth",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user:t,pass:s})});return o.status===200?(await at(),{error:!1}):o.status===401?{error:(await o.json()).reason}:{error:"Unknown error"}}var N={getMe:()=>et,logout:Mt,login:zt,init:at};const Ot=V({data:()=>({user:"",pass:"",error:"",success:""}),async mounted(){const s=new URLSearchParams(window.location.search).get("t");if(s){this.success="",this.error="";const o=await fetch("/api/_handle-token",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:s})});o.status===200?(await o.json()).type==="registration-verified"&&(this.success="Registration complete"):this.error="Unknown error"}},methods:{async submit(){this.success="",this.error="";const t=await N.login(this.user,this.pass);t.error?this.error=t.error:this.$router.push({name:"index"})}}}),Nt={class:"center-screen"},Lt=e("h1",{class:"title is-6"},"Hyottoko.club",-1),Rt={key:0,class:"field has-background-success-light has-text-success-dark"},jt={key:1,class:"field has-background-danger-light has-text-danger-dark"},Jt={class:"field"},Bt={class:"control has-icons-left"},qt=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-user"})],-1),Wt={class:"field"},Ht={class:"control has-icons-left"},Gt=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-lock"})],-1),Kt={class:"field"},Yt={class:"field"},Xt=g("Register an account"),Qt=g(" | "),Zt=g("Forgot password?");function xt(t,s,o,d,v,f){const c=b("router-link");return i(),l("div",Nt,[Lt,e("form",null,[t.success?(i(),l("div",Rt,_(t.success),1)):p("",!0),t.error?(i(),l("div",jt,_(t.error),1)):p("",!0),e("div",Jt,[e("div",Bt,[h(e("input",{class:"input is-small",type:"text",placeholder:"User","onUpdate:modelValue":s[0]||(s[0]=n=>t.user=n),onKeyup:s[1]||(s[1]=n=>t.error="")},null,544),[[y,t.user]]),qt])]),e("div",Wt,[e("div",Ht,[h(e("input",{class:"input is-small",type:"password",placeholder:"Password","onUpdate:modelValue":s[2]||(s[2]=n=>t.pass=n),onKeyup:[s[3]||(s[3]=n=>t.error=""),s[4]||(s[4]=B((...n)=>t.submit&&t.submit(...n),["enter"]))]},null,544),[[y,t.pass]]),Gt])]),e("div",Kt,[e("span",{class:"button is-small is-primary",onClick:s[5]||(s[5]=(...n)=>t.submit&&t.submit(...n))},"Login")]),e("div",Yt,[k(c,{to:{name:"register"}},{default:O(()=>[Xt]),_:1}),Qt,k(c,{to:{name:"forgot-password"}},{default:O(()=>[Zt]),_:1})])])])}var te=I(Ot,[["render",xt]]);const ee=1001,dt=4e3;class se{constructor(s,o){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=s,this.protocols=o}send(s){this.handle?this.handle.send(s):this.sendBuffer.push(s)}connect(){let s=new WebSocket(this.addr,this.protocols);s.onopen=o=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=s;this.sendBuffer.length>0;){const d=this.sendBuffer.shift();d&&this.handle.send(d)}this.onopen(o)},s.onmessage=o=>{this.onmessage(o)},s.onclose=o=>{this.handle=null,o.code===dt||o.code===ee||(this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3)),this.onclose(o)}}disconnect(){this.handle&&this.handle.close(dt)}}const ne=(...t)=>console.log("[WsClient.ts]",...t);class Y extends se{constructor(s,o){super(s,o);this._on={},this.onopen=d=>{this._dispatch("socket","open",d)},this.onmessage=d=>{if(this._dispatch("socket","message",d),this._on.message){const v=this._parseMessageData(d.data);v.event&&this._dispatch("message",v.event,v.data)}},this.onclose=d=>{this._dispatch("socket","close",d)}}onSocket(s,o){this.addEventListener("socket",s,o)}onMessage(s,o){this.addEventListener("message",s,o)}addEventListener(s,o,d){const v=Array.isArray(o)?o:[o];this._on[s]=this._on[s]||{};for(const f of v)this._on[s][f]=this._on[s][f]||[],this._on[s][f].push(d)}_parseMessageData(s){try{const o=JSON.parse(s);if(o.event)return{event:o.event,data:o.data||null}}catch{}return{event:null,data:null}}_dispatch(s,o,...d){const f=(this._on[s]||{})[o]||[];if(f.length!==0){ne(`ws dispatch ${s} ${o}`);for(const c of f)c(...d)}}}const st=async(t,s,o)=>new Promise((d,v)=>{const f=new window.XMLHttpRequest;f.open(t,s,!0),f.withCredentials=!0;for(const c in o.headers||{})f.setRequestHeader(c,o.headers[c]);f.addEventListener("load",function(c){d({status:this.status,text:this.responseText,json:async()=>JSON.parse(this.responseText)})}),f.addEventListener("error",function(c){v(new Error("xhr error"))}),f.upload&&o.onUploadProgress&&f.upload.addEventListener("progress",function(c){o.onUploadProgress&&o.onUploadProgress(c)}),f.send(o.body)});var nt={request:st,get:(t,s)=>st("get",t,s),post:(t,s)=>st("post",t,s)};const ie=V({data:()=>({$me:null,unchangedJson:"{}",changedJson:"{}",settings:null,defaultSettings:null,ws:null,drawUrl:"",favoriteSelection:{hovered:"",items:[],pagination:{page:1,perPage:20}}}),async created(){this.$me=N.getMe(),this.ws=new Y(this.$conf.wsBase+"/drawcast",this.$me.token),this.ws.onMessage("init",async t=>{this.settings=t.settings,this.defaultSettings=t.defaultSettings,this.unchangedJson=JSON.stringify(t.settings),this.drawUrl=t.drawUrl;const s=await nt.get("/api/drawcast/all-images/",{});this.favoriteSelection.items=await s.json()}),this.ws.connect()},watch:{settings:{deep:!0,handler(t){this.changedJson=JSON.stringify(t)}}},computed:{changed(){return this.unchangedJson!==this.changedJson},receiveUrl(){return`${location.protocol}//${location.host}/widget/drawcast_receive/${this.$me.widgetToken}/`},favoriteSelectionTotalPages(){return Math.floor(this.favoriteSelection.items.length/this.favoriteSelection.pagination.perPage)+(this.favoriteSelection.items.length%this.favoriteSelection.pagination.perPage==0?0:1)},currentFavoriteSelectionItems(){const t=(this.favoriteSelection.pagination.page-1)*this.favoriteSelection.pagination.perPage;return this.favoriteSelection.items.slice(t,t+this.favoriteSelection.pagination.perPage)}},methods:{toggleFavorite(t){if(!this.settings){console.warn("toggleFavorite: this.settings not initialized");return}this.settings.favorites.includes(t)?this.settings.favorites=this.settings.favorites.filter(s=>s!==t):this.settings.favorites.push(t)},soundUploaded(t){if(!this.settings){console.warn("soundUploaded: this.settings not initialized");return}this.settings.notificationSound={filename:t.originalname,file:t.filename,volume:100}},sendSave(){if(!this.settings){console.warn("sendSave: this.settings not initialized");return}this.sendMsg({event:"save",settings:{canvasWidth:parseInt(`${this.settings.canvasWidth}`,10)||720,canvasHeight:parseInt(`${this.settings.canvasHeight}`,10)||405,submitButtonText:this.settings.submitButtonText,submitConfirm:this.settings.submitConfirm,customDescription:this.settings.customDescription,palette:this.settings.palette,displayDuration:parseInt(`${this.settings.displayDuration}`,10)||5e3,displayLatestForever:this.settings.displayLatestForever,displayLatestAutomatically:this.settings.displayLatestAutomatically,notificationSound:this.settings.notificationSound,favorites:this.settings.favorites}})},sendMsg(t){if(!this.ws){console.warn("sendMsg: this.ws not initialized");return}this.ws.send(JSON.stringify(t))}},unmounted(){this.ws&&this.ws.disconnect()}}),le={id:"app"},oe={id:"top",ref:"top"},ae={id:"actionbar",class:"p-1"},de=["disabled"],re=["href"],ue=["href"],ce={id:"main",ref:"main"},me={key:0,class:"table is-striped",ref:"table"},he=e("tr",null,[e("td",{colspan:"3"},"General")],-1),pe=e("td",null,[e("code",null,"settings.canvasWidth")],-1),ge=e("td",null,[g(" Width of the drawing area."),e("br"),g(" Caution: changing this will clear the area for currenty connected users. ")],-1),fe=e("td",null,[e("code",null,"settings.canvasHeight")],-1),ve=e("td",null,[g(" Height of the drawing area."),e("br"),g(" Caution: changing this will clear the area for currenty connected users. ")],-1),$e=e("td",null,[e("code",null,"settings.displayDuration")],-1),ye=e("td",null," The duration in Milliseconds that each drawing will be shown ",-1),be=e("td",null,[e("code",null,"settings.displayLatestForever")],-1),_e=e("td",null,"If checked, the latest drawing will be shown indefinately.",-1),we=e("td",null,[e("code",null,"settings.displayLatestAutomatically")],-1),ke=e("td",null," If checked, the latest drawing will be shown in widget automatically. ",-1),Ce=e("td",null,[e("code",null,"settings.submitButtonText")],-1),Se=e("td",null,null,-1),Ve=e("td",null,[e("code",null,"settings.submitConfirm")],-1),Ie=e("td",null," Leave empty if no confirm is required by user before sending. ",-1),Ue=e("td",null,[e("code",null,"settings.customDescription")],-1),De=e("td",null,"Description text below the drawing panel.",-1),Ae=e("td",null,[e("code",null,"settings.palette")],-1),Pe=["onUpdate:modelValue"],Te=e("br",null,null,-1),Ee=e("br",null,null,-1),Fe=e("td",null,[g(" Default colors appearing on the draw page."),e("br"),g(" Caution: Changing this will change selected color for currenty connected users. ")],-1),Me=e("td",null,[e("code",null,"settings.notificationSound")],-1),ze={key:0,class:"spacerow media-holder"},Oe=e("i",{class:"fa fa-remove"},null,-1),Ne=[Oe],Le=e("td",null,[g(" Add a sound here that plays when new drawings arrive. "),e("br"),g(" Note: Not played in drawing window, only in widget. ")],-1),Re=e("code",null,"settings.favorites",-1),je={class:"preview"},Je=["src"],Be=e("div",null,"Currently selected favorites:",-1),qe={class:"favorites"},We=["src","onClick","onMouseover"],He=e("div",{class:"mt-2"},"Select favorites:",-1),Ge={class:"favorites-select"},Ke=["src","onClick","onMouseover"],Ye=["disabled"],Xe=["disabled"],Qe=e("td",null," The favorites will always be displayed at the beginning of the gallery in the draw widget. ",-1);function Ze(t,s,o,d,v,f){const c=b("navbar"),n=b("player"),m=b("volume-slider"),u=b("upload");return i(),l("div",le,[e("div",oe,[k(c),e("div",ae,[e("button",{class:"button is-small is-primary mr-1",disabled:!t.changed,onClick:s[0]||(s[0]=(...$)=>t.sendSave&&t.sendSave(...$))}," Save ",8,de),e("a",{class:"button is-small mr-1",href:t.receiveUrl,target:"_blank"},"Open widget",8,re),e("a",{class:"button is-small",href:t.drawUrl,target:"_blank"},"Open draw",8,ue)])],512),e("div",ce,[t.settings?(i(),l("table",me,[e("tbody",null,[he,e("tr",null,[pe,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[1]||(s[1]=$=>t.settings.canvasWidth=$)},null,512),[[y,t.settings.canvasWidth]])]),ge]),e("tr",null,[fe,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[2]||(s[2]=$=>t.settings.canvasHeight=$)},null,512),[[y,t.settings.canvasHeight]])]),ve]),e("tr",null,[$e,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[3]||(s[3]=$=>t.settings.displayDuration=$)},null,512),[[y,t.settings.displayDuration]])]),ye]),e("tr",null,[be,e("td",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=$=>t.settings.displayLatestForever=$)},null,512),[[M,t.settings.displayLatestForever]])]),_e]),e("tr",null,[we,e("td",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=$=>t.settings.displayLatestAutomatically=$)},null,512),[[M,t.settings.displayLatestAutomatically]])]),ke]),e("tr",null,[Ce,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[6]||(s[6]=$=>t.settings.submitButtonText=$)},null,512),[[y,t.settings.submitButtonText]])]),Se]),e("tr",null,[Ve,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[7]||(s[7]=$=>t.settings.submitConfirm=$)},null,512),[[y,t.settings.submitConfirm]])]),Ie]),e("tr",null,[Ue,e("td",null,[h(e("textarea",{class:"textarea","onUpdate:modelValue":s[8]||(s[8]=$=>t.settings.customDescription=$)},null,512),[[y,t.settings.customDescription]])]),De]),e("tr",null,[Ae,e("td",null,[(i(!0),l(U,null,D(t.settings.palette,($,S)=>(i(),l("label",{class:"square",key:S},[h(e("input",{type:"color","onUpdate:modelValue":a=>t.settings.palette[S]=a},null,8,Pe),[[y,t.settings.palette[S]]]),e("span",{class:"square-inner",style:q({backgroundColor:$})},null,4)]))),128)),Te,Ee,e("button",{class:"button is-small",onClick:s[9]||(s[9]=$=>t.settings.palette=t.defaultSettings.palette)}," Reset to default palette ")]),Fe]),e("tr",null,[Me,e("td",null,[t.settings.notificationSound?(i(),l("div",ze,[k(n,{src:t.settings.notificationSound.file,name:t.settings.notificationSound.filename,volume:t.settings.notificationSound.volume,class:"button is-small"},null,8,["src","name","volume"]),k(m,{modelValue:t.settings.notificationSound.volume,"onUpdate:modelValue":s[10]||(s[10]=$=>t.settings.notificationSound.volume=$)},null,8,["modelValue"]),e("button",{class:"button is-small",onClick:s[11]||(s[11]=$=>t.settings.notificationSound=null)},Ne)])):p("",!0),k(u,{onUploaded:t.soundUploaded,accept:"audio/*",label:"Upload Audio"},null,8,["onUploaded"])]),Le]),e("tr",null,[e("td",null,[Re,e("div",je,[t.favoriteSelection.hovered?(i(),l("img",{key:0,src:t.favoriteSelection.hovered},null,8,Je)):p("",!0)])]),e("td",null,[Be,e("div",qe,[(i(!0),l(U,null,D(t.settings.favorites,($,S)=>(i(),l("img",{src:$,key:S,width:"50",height:"50",onClick:a=>t.toggleFavorite($),onMouseover:a=>t.favoriteSelection.hovered=$,onMouseleave:s[12]||(s[12]=a=>t.favoriteSelection.hovered=""),class:"thumbnail is-favorited mr-1"},null,40,We))),128))]),He,e("div",Ge,[(i(!0),l(U,null,D(t.currentFavoriteSelectionItems,($,S)=>(i(),l("img",{src:$,key:S,width:"50",height:"50",onClick:a=>t.toggleFavorite($),onMouseover:a=>t.favoriteSelection.hovered=$,onMouseleave:s[13]||(s[13]=a=>t.favoriteSelection.hovered=""),class:A(["thumbnail mr-1",{"is-favorited":t.settings.favorites.includes($)}])},null,42,Ke))),128))]),e("span",{class:"button is-small",onClick:s[14]||(s[14]=$=>t.favoriteSelection.pagination.page=t.favoriteSelection.pagination.page-1),disabled:t.favoriteSelection.pagination.page>1?null:!0},"Prev",8,Ye),e("span",{class:"button is-small",onClick:s[15]||(s[15]=$=>t.favoriteSelection.pagination.page=t.favoriteSelection.pagination.page+1),disabled:t.favoriteSelection.pagination.page<t.favoriteSelectionTotalPages?null:!0},"Next",8,Xe)]),Qe])])],512)):p("",!0)],512)])}var xe=I(ie,[["render",Ze]]);const ts=V({data:()=>({unchangedJson:"[]",changedJson:"[]",variables:[]}),computed:{changed(){return this.unchangedJson!==this.changedJson}},methods:{remove(t){this.variables=this.variables.filter((s,o)=>o!==t)},onAdd(){this.variables.push({name:"",value:""})},setChanged(){this.changedJson=JSON.stringify({variables:this.variables})},setUnchanged(){this.unchangedJson=JSON.stringify({variables:this.variables}),this.changedJson=this.unchangedJson},async sendSave(){await fetch("/save-variables",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({variables:this.variables})}),this.setUnchanged()}},watch:{variables:{deep:!0,handler(){this.setChanged()}}},async mounted(){const t=await fetch("/api/page/variables");if(t.status!==200){this.$router.push({name:"login"});return}const s=await t.json();this.variables=s.variables,this.setUnchanged()}}),es={id:"app"},ss={id:"top",ref:"top"},ns={id:"actionbar",class:"p-1"},is=["disabled"],ls={id:"main"},os={class:"mb-4"},as=e("h1",{class:"title mb-2"},"Global Variables",-1),ds=e("div",{class:"help"},[g(" Variables can be used from commands with "),e("code",null,"$var(variable_name)"),g(". In addition to the global variables defined here, commands can define their own local variables which have precedence over the global ones. ")],-1),rs={class:"table is-striped"},us=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Value"),e("th")])],-1),cs=["onUpdate:modelValue"],ms=["onUpdate:modelValue"],hs=e("i",{class:"fa fa-trash"},null,-1);function ps(t,s,o,d,v,f){const c=b("navbar"),n=b("doubleclick-button");return i(),l("div",es,[e("div",ss,[k(c),e("div",ns,[e("button",{class:"button is-small",onClick:s[0]||(s[0]=(...m)=>t.onAdd&&t.onAdd(...m))},"Add"),e("button",{class:"button is-small is-primary",disabled:!t.changed,onClick:s[1]||(s[1]=(...m)=>t.sendSave&&t.sendSave(...m))}," Save ",8,is)])],512),e("div",ls,[e("div",os,[as,ds,e("table",rs,[us,e("tbody",null,[(i(!0),l(U,null,D(t.variables,(m,u)=>(i(),l("tr",{key:u},[e("td",null,[h(e("input",{type:"text",class:"input is-small","onUpdate:modelValue":$=>m.name=$},null,8,cs),[[y,m.name]])]),e("td",null,[h(e("input",{type:"text",class:"input is-small","onUpdate:modelValue":$=>m.value=$},null,8,ms),[[y,m.value]])]),e("td",null,[k(n,{class:"button is-small mr-1",message:"Are you sure?",timeout:1e3,onDoubleclick:$=>t.remove(u)},{default:O(()=>[hs]),_:2},1032,["onDoubleclick"])])]))),128))])])])])])}var gs=I(ts,[["render",ps]]);const fs=V({data:()=>({user:"",pass:"",email:"",error:"",success:!1}),computed:{canRegister(){return this.user&&this.pass&&this.email&&!this.error}},methods:{async onRequestVerificationEmail(){this.success=!1,this.error="";const t=await fetch("/api/user/_resend_verification_mail",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:this.email})});if(t.status===200)this.success=!0;else try{this.error=(await t.json()).reason}catch{this.error="Unknown error"}},async submit(){this.success=!1,this.error="";const t=await fetch("/api/user/_register",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user:this.user,pass:this.pass,email:this.email})});if(t.status===200)this.success=!0;else try{this.error=(await t.json()).reason}catch{this.error="Unknown error"}}}}),vs={class:"center-screen"},$s=e("h1",{class:"title is-6"},"Hyottoko.club",-1),ys={key:0,class:"field has-background-success-light has-text-success-dark"},bs=g(" Account registered. Please check your mail. Click "),_s=g("here"),ws=g(" to login. "),ks={key:1},Cs={key:0,class:"field has-background-danger-light has-text-danger-dark"},Ss={key:0},Vs=g(" A user with this email is already registered. "),Is=e("br",null,null,-1),Us=g("Request a password reset."),Ds={key:1},As=g(" A user with this email is already registered. "),Ps=e("br",null,null,-1),Ts={key:2},Es={key:3},Fs={key:4},Ms={class:"field"},zs={class:"control has-icons-left"},Os=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-user"})],-1),Ns={class:"field"},Ls={class:"control has-icons-left"},Rs=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-envelope"})],-1),js={class:"field"},Js={class:"control has-icons-left"},Bs=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-lock"})],-1),qs={class:"field"},Ws=["disabled"];function Hs(t,s,o,d,v,f){const c=b("router-link");return i(),l("div",vs,[$s,t.success?(i(),l("div",ys,[bs,k(c,{to:{name:"login"}},{default:O(()=>[_s]),_:1}),ws])):(i(),l("div",ks,[t.error?(i(),l("div",Cs,[t.error==="verified_mail_already_exists"?(i(),l("div",Ss,[Vs,Is,k(c,{to:{name:"forgot-password"}},{default:O(()=>[Us]),_:1})])):t.error==="unverified_mail_already_exists"?(i(),l("div",Ds,[As,Ps,e("span",{class:"button is-small",onClick:s[0]||(s[0]=(...n)=>t.onRequestVerificationEmail&&t.onRequestVerificationEmail(...n))},"Resend verification email")])):t.error==="verified_name_already_exists"?(i(),l("div",Ts," A user with this name is already registered. ")):t.error==="unverified_name_already_exists"?(i(),l("div",Es," A user with this name is already registered. ")):(i(),l("span",Fs,_(t.error),1))])):p("",!0),e("div",Ms,[e("div",zs,[h(e("input",{class:"input is-small",type:"text",placeholder:"User","onUpdate:modelValue":[s[1]||(s[1]=n=>t.user=n),s[2]||(s[2]=n=>t.error="")]},null,512),[[y,t.user]]),Os])]),e("div",Ns,[e("div",Ls,[h(e("input",{class:"input is-small",type:"email",placeholder:"Email","onUpdate:modelValue":[s[3]||(s[3]=n=>t.email=n),s[4]||(s[4]=n=>t.error="")]},null,512),[[y,t.email]]),Rs])]),e("div",js,[e("div",Js,[h(e("input",{class:"input is-small",type:"password",placeholder:"Password","onUpdate:modelValue":[s[5]||(s[5]=n=>t.pass=n),s[6]||(s[6]=n=>t.error="")],onKeyup:s[7]||(s[7]=B((...n)=>t.submit&&t.submit(...n),["enter"]))},null,544),[[y,t.pass]]),Bs])]),e("div",qs,[e("button",{class:"button is-small is-primary",disabled:t.canRegister?null:!0,onClick:s[8]||(s[8]=(...n)=>t.submit&&t.submit(...n))}," Register ",8,Ws)])]))])}var Gs=I(fs,[["render",Hs]]);const Ks=V({data:()=>({unchangedJson:"[]",changedJson:"[]",user:{id:0,name:"",email:"",pass:"",groups:[],tmi_identity_client_id:"",tmi_identity_client_secret:""},twitch_channels:[]}),computed:{isAdmin(){return this.user.groups.includes("admin")},changed(){return this.unchangedJson!==this.changedJson},accessTokenLink(){if(!this.user.tmi_identity_client_id)return;const t=["analytics:read:extensions","analytics:read:games","bits:read","channel:edit:commercial","channel:manage:broadcast","channel:manage:extensions","channel:manage:redemptions","channel:manage:videos","channel:read:editors","channel:read:hype_train","channel:read:redemptions","channel:read:stream_key","channel:read:subscriptions","clips:edit","moderation:read","user:edit","user:edit:follows","user:read:blocked_users","user:manage:blocked_users","user:read:broadcast","user:read:email"],s=document.location,o=`${s.protocol}//${s.host}/twitch/redirect_uri`;return`https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=${this.user.tmi_identity_client_id}&redirect_uri=${o}&scope=${t.join("+")}`}},methods:{setChanged(){this.changedJson=JSON.stringify({user:this.user,twitch_channels:this.twitch_channels})},setUnchanged(){this.unchangedJson=JSON.stringify({user:this.user,twitch_channels:this.twitch_channels}),this.changedJson=this.unchangedJson},rmchannel(t){this.twitch_channels=this.twitch_channels.filter((s,o)=>o!==t)},addchannel(){this.twitch_channels.push({user_id:this.user.id,channel_id:"",channel_name:"",access_token:""})},async loadid(t){this.twitch_channels[t].channel_id=await this.getTwitchUserIdByName(this.twitch_channels[t].channel_name)},async getTwitchUserIdByName(t){const s={name:t,client_id:this.user.tmi_identity_client_id||null,client_secret:this.user.tmi_identity_client_secret||null},o=await fetch("/twitch/user-id-by-name",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)});try{return`${(await o.json()).id}`}catch{return""}},async sendSave(){await fetch("/api/save-settings",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user:this.user,twitch_channels:this.twitch_channels})}),this.setUnchanged()}},watch:{user:{deep:!0,handler(){this.setChanged()}},twitch_channels:{deep:!0,handler(){this.setChanged()}}},async mounted(){const t=await fetch("/api/page/settings");if(t.status!==200){this.$router.push({name:"login"});return}const s=await t.json();this.user=s.user,this.twitch_channels=s.twitchChannels,this.setUnchanged()}}),Ys={id:"app"},Xs={id:"top",ref:"top"},Qs={id:"actionbar",class:"p-1"},Zs=["disabled"],xs={id:"main"},tn={class:"mb-4"},en=e("h1",{class:"title mb-2"},"User",-1),sn={class:"table is-striped"},nn=e("td",null,"Name:",-1),ln=e("td",null,"Email:",-1),on=e("td",null,"Password:",-1),an={key:0,class:"mb-4"},dn=e("h1",{class:"title mb-2"},"Twitch-Bot",-1),rn=e("p",null,[g(" Please refer to "),e("a",{href:"https://dev.twitch.tv/docs/irc/#building-the-bot",target:"_blank"},"building the bot"),g(". ")],-1),un={class:"table is-striped"},cn=e("td",null,"Bot name:",-1),mn=e("td",null,"Bot oauth (pass):",-1),hn=e("td",null,"Bot client_id:",-1),pn=e("td",null,"Bot client_secret:",-1),gn={class:"mb-4"},fn=e("h1",{class:"title mb-2"},"Twitch Channels",-1),vn=g(" List of twitch channels where the bot will connect to. "),$n={key:0},yn={key:0,class:"table is-striped"},bn=e("thead",null,[e("tr",null,[e("td",null,"Channel name"),e("td",null,"Channel id*"),e("td",null,"Access Token*"),e("td")])],-1),_n=["onUpdate:modelValue"],wn=["onUpdate:modelValue"],kn=["onClick"],Cn=["onUpdate:modelValue"],Sn=["onClick"],Vn=e("i",{class:"fa fa-remove"},null,-1),In=[Vn],Un={key:1,class:"content"},Dn=e("p",null," Channel Id* and Access Token*: You may not need the client id or access token. No public feature currently uses them. ",-1),An={key:0},Pn={key:1,class:"list"},Tn=e("li",{class:"list-item"},"Login to twitch as the channel owner",-1),En={class:"list-item"},Fn=g(" Click "),Mn=["href"],zn=g(" to authorize the bot with the channel "),On=e("li",{class:"list-item"}," If authorized, you get redirected back to hyottoko.club, and the access token will display ",-1),Nn={key:2};function Ln(t,s,o,d,v,f){const c=b("navbar");return i(),l("div",Ys,[e("div",Xs,[k(c),e("div",Qs,[e("button",{class:"button is-small is-primary",disabled:!t.changed,onClick:s[0]||(s[0]=(...n)=>t.sendSave&&t.sendSave(...n))}," Save ",8,Zs)])],512),e("div",xs,[e("div",tn,[en,e("table",sn,[e("tbody",null,[e("tr",null,[nn,e("td",null,_(t.user.name),1)]),e("tr",null,[ln,e("td",null,[h(e("input",{type:"email","onUpdate:modelValue":s[1]||(s[1]=n=>t.user.email=n)},null,512),[[y,t.user.email]])])]),e("tr",null,[on,e("td",null,[h(e("input",{type:"password","onUpdate:modelValue":s[2]||(s[2]=n=>t.user.pass=n)},null,512),[[y,t.user.pass]])])])])])]),t.isAdmin?(i(),l("div",an,[dn,rn,e("table",un,[e("tbody",null,[e("tr",null,[cn,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[3]||(s[3]=n=>t.user.tmi_identity_username=n)},null,512),[[y,t.user.tmi_identity_username]])])]),e("tr",null,[mn,e("td",null,[h(e("input",{class:"input is-small",type:"password","onUpdate:modelValue":s[4]||(s[4]=n=>t.user.tmi_identity_password=n)},null,512),[[y,t.user.tmi_identity_password]])])]),e("tr",null,[hn,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[5]||(s[5]=n=>t.user.tmi_identity_client_id=n)},null,512),[[y,t.user.tmi_identity_client_id]])])]),e("tr",null,[pn,e("td",null,[h(e("input",{class:"input is-small",type:"password","onUpdate:modelValue":s[6]||(s[6]=n=>t.user.tmi_identity_client_secret=n)},null,512),[[y,t.user.tmi_identity_client_secret]])])])])])])):p("",!0),e("div",gn,[fn,e("p",null,[vn,t.twitch_channels.length===0?(i(),l("span",$n," Currently no channels are configured. ")):p("",!0)]),t.twitch_channels.length>0?(i(),l("table",yn,[bn,e("tbody",null,[(i(!0),l(U,null,D(t.twitch_channels,(n,m)=>(i(),l("tr",{key:m},[e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":u=>n.channel_name=u},null,8,_n),[[y,n.channel_name]])]),e("td",null,[n.channel_id?h((i(),l("input",{key:0,class:"input is-small",type:"text","onUpdate:modelValue":u=>n.channel_id=u},null,8,wn)),[[y,n.channel_id]]):p("",!0),n.channel_id?p("",!0):(i(),l("button",{key:1,class:"button is-small",onClick:u=>t.loadid(m)}," Load id ",8,kn))]),e("td",null,[h(e("input",{class:"input is-small",type:"password","onUpdate:modelValue":u=>n.access_token=u},null,8,Cn),[[y,n.access_token]])]),e("td",null,[e("button",{class:"button is-small",onClick:u=>t.rmchannel(m)},In,8,Sn)])]))),128))])])):p("",!0),e("button",{class:"button is-small",onClick:s[7]||(s[7]=n=>t.addchannel())}," Add channel ")]),t.twitch_channels.length>0?(i(),l("div",Un,[Dn,t.accessTokenLink?(i(),l("p",An,"To get an access token, do the following:")):p("",!0),t.accessTokenLink?(i(),l("ol",Pn,[Tn,e("li",En,[Fn,e("a",{href:t.accessTokenLink,target:"_blank"},"here",8,Mn),zn]),On])):t.isAdmin?(i(),l("p",Nn,' To configure an access token, please configure the "Bot client_id" above. ')):p("",!0)])):p("",!0)])])}var Rn=I(Ks,[["render",Ln]]);const jn=V({data:()=>({$me:null,playerVisible:!1,playlist:[],settings:{volume:100,hideVideoImage:{file:"",filename:""},initAutoplay:!0,customCss:"",showProgressBar:!1,showThumbnails:!0,maxItemsShown:-1,customCssPresets:[]},filter:{tag:""},ws:null,resrinput:"",srinput:"",inited:!1,tab:"playlist",importPlaylist:"",toast:ht(),controlDefinitions:[{title:"Reset stats",ctrl:"resetStats",icon:"fa-eraser"},{title:"Clear playlist",ctrl:"clear",icon:"fa-eject"},{title:"Shuffle",ctrl:"shuffle",icon:"fa-random"},{title:"Play",ctrl:"unpause",icon:"fa-play"},{title:"Pause",ctrl:"pause",icon:"fa-pause"},{title:"Prev",ctrl:"prev",icon:"fa-step-backward"},{title:"Next",ctrl:"skip",icon:"fa-step-forward"}]}),computed:{tags(){const t=[];return this.playlist.forEach(s=>{s.tags.forEach(o=>{const d=t.findIndex(v=>v.value===o);d===-1?t.push({value:o,count:1}):t[d].count++})}),t},player(){return this.$refs.youtube||{stop:()=>{},play:()=>{},pause:()=>{},unpause:()=>{},setVolume:()=>{},setLoop:()=>{},playing:()=>{}}},filteredPlaylist(){return this.filter.tag===""?this.playlist:this.playlist.filter(t=>t.tags.includes(this.filter.tag))},item(){return this.filteredPlaylist[0]},hasItems(){return this.filteredPlaylist.length!==0},playerstyle(){return this.playerVisible?"":"width:0;height:0;padding:0;margin-bottom:0;"},togglePlayerButtonText(){return this.playerVisible?"Hide Player":"Show Player"},importPlaylistUrl(){return`${location.protocol}//${location.host}/api/sr/import`},exportPlaylistUrl(){return`${location.protocol}//${location.host}/api/sr/export`},widgetUrl(){return`${location.protocol}//${location.host}/widget/sr/${this.$me.widgetToken}/`}},methods:{sendSettings(){this.sendCtrl("settings",[this.settings])},onTagUpdated(t){this.updateTag(t[0],t[1])},onPlaylistCtrl(t){this.sendCtrl(t[0],t[1])},applyFilter(t){this.sendCtrl("filter",[{tag:t}])},async doImportPlaylist(){(await nt.post(this.importPlaylistUrl,{headers:{Accept:"application/json","Content-Type":"application/json"},body:this.importPlaylist})).status===200?(this.tab="playlist",this.toast.success("Import successful")):this.toast.error("Import failed")},togglePlayer(){this.playerVisible=!this.playerVisible,this.playerVisible?this.player.playing()||this.play():this.player.stop()},resr(){this.resrinput!==""&&this.sendCtrl("resr",[this.resrinput])},sr(){this.srinput!==""&&this.sendCtrl("sr",[this.srinput])},sendCtrl(t,s){this.sendMsg({event:"ctrl",ctrl:t,args:s})},ended(){this.sendMsg({event:"ended"})},sendMsg(t){this.ws?this.ws.send(JSON.stringify(t)):console.warn("sendMsg: this.ws not initialized")},play(){this.adjustVolume(this.settings.volume),this.playerVisible&&this.hasItems&&(this.player.play(this.item.yt),this.sendMsg({event:"play",id:this.item.id}))},unpause(){this.hasItems&&(this.player.unpause(),this.sendMsg({event:"unpause",id:this.item.id}))},pause(){this.playerVisible&&this.hasItems&&(this.player.pause(),this.sendMsg({event:"pause"}))},adjustVolume(t){this.player.setVolume(t)},updateTag(t,s){t!==s&&this.sendCtrl("updatetag",[t,s])}},created(){this.$me=N.getMe()},async mounted(){this.$nextTick(()=>{this.ws=new Y(this.$conf.wsBase+"/sr",this.$me.token),this.ws.onMessage("settings",t=>{this.settings=t.settings}),this.ws.onMessage(["pause"],t=>{this.player.playing()&&this.pause()}),this.ws.onMessage(["unpause"],t=>{this.player.playing()||this.unpause()}),this.ws.onMessage(["loop"],t=>{this.player.setLoop(!0)}),this.ws.onMessage(["noloop"],t=>{this.player.setLoop(!1)}),this.ws.onMessage(["onEnded","prev","skip","remove","clear","move","tags"],t=>{this.settings=t.settings;const s=this.filteredPlaylist.length>0?this.filteredPlaylist[0].id:null;this.filter=t.filter,this.playlist=t.playlist;const o=this.filteredPlaylist.length>0?this.filteredPlaylist[0].id:null;s!==o&&this.play()}),this.ws.onMessage(["filter"],t=>{this.settings=t.settings;const s=this.filteredPlaylist.length>0?this.filteredPlaylist[0].id:null;this.filter=t.filter,this.playlist=t.playlist,this.filteredPlaylist.find(o=>o.id===s)||this.play()}),this.ws.onMessage(["dislike","like","video","playIdx","resetStats","shuffle"],t=>{this.settings=t.settings,this.filter=t.filter,this.playlist=t.playlist}),this.ws.onMessage(["add","init"],t=>{this.settings=t.settings,this.filter=t.filter,this.playlist=t.playlist,!this.inited&&!this.player.playing()&&this.play(),this.inited=!0}),this.ws.connect(),this.play()})},unmounted(){this.ws&&this.ws.disconnect()}}),R=t=>(G("data-v-bac6a4d8"),t=t(),K(),t),Jn={id:"app"},Bn={id:"top",ref:"top"},qn={id:"actionbar",class:"p-1"},Wn=["disabled","onClick","title"],Hn=["disabled","title"],Gn=R(()=>e("i",{class:"fa fa-tv mr-1"},null,-1)),Kn={class:"txt"},Yn={class:"field has-addons mr-1"},Xn={class:"control"},Qn=["disabled"],Zn={class:"control"},xn=["disabled"],ti=R(()=>e("i",{class:"fa fa-search mr-1"},null,-1)),ei=g(" from playlist "),si=[ti,ei],ni={class:"field has-addons mr-1"},ii={class:"control"},li=["disabled"],oi={class:"control"},ai=["disabled"],di=R(()=>e("i",{class:"fa fa-plus mr-1"},null,-1)),ri=g(" from YouTube "),ui=[di,ri],ci=["disabled","href"],mi={id:"main",ref:"main"},hi={style:{width:"640px","max-width":"100%"}},pi={class:"tabs"},gi=R(()=>e("a",null,"Playlist",-1)),fi=[gi],vi=R(()=>e("a",null,"Settings",-1)),$i=[vi],yi=R(()=>e("a",null,"Help",-1)),bi=[yi],_i=R(()=>e("a",null,"Tags",-1)),wi=[_i],ki=R(()=>e("a",null,"Import/Export",-1)),Ci=[ki],Si={key:0},Vi={class:"mb-1"},Ii=["href"],Ui=R(()=>e("i",{class:"fa fa-download mr-1"},null,-1)),Di=g(" Export playlist"),Ai=[Ui,Di],Pi=R(()=>e("i",{class:"fa fa-upload mr-1"},null,-1)),Ti=g(" Import playlist "),Ei=[Pi,Ti],Fi={key:1,id:"help"},Mi={key:2,id:"tags"},zi={key:4,id:"playlist",class:"table-container"};function Oi(t,s,o,d,v,f){const c=b("navbar"),n=b("youtube"),m=b("help"),u=b("tags-editor"),$=b("song-request-settings"),S=b("playlist-editor");return i(),l("div",Jn,[e("div",Bn,[k(c),e("div",qn,[(i(!0),l(U,null,D(t.controlDefinitions,(a,C)=>(i(),l("button",{class:"button is-small mr-1",disabled:t.inited?null:!0,onClick:r=>t.sendCtrl(a.ctrl,[]),title:a.title,key:C},[e("i",{class:A(["fa",a.icon])},null,2)],8,Wn))),128)),e("button",{class:"button is-small mr-1",disabled:t.inited?null:!0,onClick:s[0]||(s[0]=(...a)=>t.togglePlayer&&t.togglePlayer(...a)),title:t.togglePlayerButtonText},[Gn,e("span",Kn,_(t.togglePlayerButtonText),1)],8,Hn),e("div",Yn,[e("div",Xn,[h(e("input",{class:"input is-small",disabled:t.inited?null:!0,"onUpdate:modelValue":s[1]||(s[1]=a=>t.resrinput=a),onKeyup:s[2]||(s[2]=B((...a)=>t.resr&&t.resr(...a),["enter"]))},null,40,Qn),[[y,t.resrinput]])]),e("div",Zn,[e("button",{class:"button is-small",disabled:t.inited?null:!0,onClick:s[3]||(s[3]=(...a)=>t.resr&&t.resr(...a))},si,8,xn)])]),e("div",ni,[e("div",ii,[h(e("input",{class:"input is-small",disabled:t.inited?null:!0,"onUpdate:modelValue":s[4]||(s[4]=a=>t.srinput=a),onKeyup:s[5]||(s[5]=B((...a)=>t.sr&&t.sr(...a),["enter"]))},null,40,li),[[y,t.srinput]])]),e("div",oi,[e("button",{class:"button is-small",disabled:t.inited?null:!0,onClick:s[6]||(s[6]=(...a)=>t.sr&&t.sr(...a))},ui,8,ai)])]),e("a",{class:"button is-small mr-1",disabled:t.inited?null:!0,href:t.widgetUrl,target:"_blank"},"Open SR widget",8,ci)])],512),e("div",mi,[e("div",hi,[e("div",{id:"player",class:"video-16-9",style:q(t.playerstyle)},[k(n,{ref:"youtube",onEnded:t.ended,visible:t.playerVisible},null,8,["onEnded","visible"])],4)]),e("div",pi,[e("ul",null,[e("li",{class:A({"is-active":t.tab==="playlist"}),onClick:s[7]||(s[7]=a=>t.tab="playlist")},fi,2),e("li",{class:A({"is-active":t.tab==="settings"}),onClick:s[8]||(s[8]=a=>t.tab="settings")},$i,2),e("li",{class:A({"is-active":t.tab==="help"}),onClick:s[9]||(s[9]=a=>t.tab="help")},bi,2),e("li",{class:A({"is-active":t.tab==="tags"}),onClick:s[10]||(s[10]=a=>t.tab="tags")},wi,2),e("li",{class:A({"is-active":t.tab==="import"}),onClick:s[11]||(s[11]=a=>t.tab="import")},Ci,2)])]),t.inited&&t.tab==="import"?(i(),l("div",Si,[e("div",Vi,[e("a",{class:"button is-small mr-1",href:t.exportPlaylistUrl,target:"_blank"},Ai,8,Ii),e("button",{class:"button is-small",onClick:s[12]||(s[12]=(...a)=>t.doImportPlaylist&&t.doImportPlaylist(...a))},Ei)]),h(e("textarea",{class:"textarea mb-1","onUpdate:modelValue":s[13]||(s[13]=a=>t.importPlaylist=a)},null,512),[[y,t.importPlaylist]])])):p("",!0),t.inited&&t.tab==="help"?(i(),l("div",Fi,[k(m)])):p("",!0),t.inited&&t.tab==="tags"?(i(),l("div",Mi,[k(u,{tags:t.tags,onUpdateTag:t.onTagUpdated},null,8,["tags","onUpdateTag"])])):p("",!0),t.inited&&t.tab==="settings"?(i(),F($,{key:3,id:"settings",modelValue:t.settings,"onUpdate:modelValue":[s[14]||(s[14]=a=>t.settings=a),t.sendSettings]},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),t.inited&&t.tab==="playlist"?(i(),l("div",zi,[k(S,{playlist:t.playlist,filter:t.filter,onStopPlayer:s[15]||(s[15]=a=>t.player.stop()),onFilterChange:t.applyFilter,onCtrl:t.onPlaylistCtrl},null,8,["playlist","filter","onFilterChange","onCtrl"])])):p("",!0)],512)])}var Ni=I(jn,[["render",Oi],["__scopeId","data-v-bac6a4d8"]]);const it=()=>"",rt=()=>({sound:{filename:"",file:"",volume:100},image:{filename:"",file:""},minDurationMs:"1s"}),Li=()=>({steps:3,interval:"1s",intro:"Starting countdown...",outro:"Done!"}),ut=t=>({type:t,data:{command:"",commandExact:!1,minInterval:0,minLines:0}}),H=(t="",s=!1)=>{const o=ut("command");return o.data.command=t,o.data.commandExact=s,o},Ri=t=>{switch(t){case"text":return{triggers:[H()],action:"text",restrict_to:[],variables:[],variableChanges:[],data:{text:[it()]}};case"media":return{triggers:[H()],action:"media",restrict_to:[],variables:[],variableChanges:[],data:rt()};case"countdown":return{triggers:[H()],action:"countdown",restrict_to:[],variables:[],variableChanges:[],data:Li()};case"dict_lookup":return{triggers:[H()],action:"dict_lookup",restrict_to:[],variables:[],variableChanges:[],data:{lang:"ja",phrase:""}};case"madochan_createword":return{triggers:[H()],action:"madochan_createword",restrict_to:[],variables:[],variableChanges:[],data:{model:"100epochs800lenhashingbidirectional.h5",weirdness:1}};case"chatters":return{triggers:[H()],action:"chatters",restrict_to:[],variables:[],variableChanges:[],data:{}};default:return null}},ji=1,X=1e3*ji,Q=60*X,Z=60*Q,x=24*Z,ct=t=>{if(t==="")throw new Error("unable to parse duration");const s=`${t}`.trim();if(!s)throw new Error("unable to parse duration");if(s.match(/^\d+$/))return parseInt(s,10);const o=s.match(/^((?:\d*)\.(?:\d*))(d|h|m|s)$/);if(o){const u=parseFloat(o[1]);if(isNaN(u))throw new Error("unable to parse duration");const $=o[2];let S=0;return $==="d"?S=u*x:$==="h"?S=u*Z:$==="m"?S=u*Q:$==="s"&&(S=u*X),Math.round(S)}const d=s.match(/^(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!d)throw new Error("unable to parse duration");const v=d[1]?parseInt(d[1],10):0,f=d[2]?parseInt(d[2],10):0,c=d[3]?parseInt(d[3],10):0,n=d[4]?parseInt(d[4],10):0,m=d[5]?parseInt(d[5],10):0;return n*X+c*Q+f*Z+v*x+m},Ji=t=>{try{return ct(t)}catch{return 0}},Bi=t=>{let s=t;const o=Math.floor(s/x);s=s%x;const d=Math.floor(s/Z);s=s%Z;const v=Math.floor(s/Q);s=s%Q;const f=Math.floor(s/X);s=s%X;const c=s,n=["ms","s","m","h","d"],m=[c,f,v,d,o];let u=0;for(;u<m.length&&m[u]===0;)u++;let $=m.length-1;for(;$>=0&&m[$]===0;)$--;const S=[];for(let a=u;a<=$;a++)S.unshift(`${m[a]}${n[a]}`);return S.join(" ")};function qi(t,s,o){if(o>=t.length)for(var d=o-t.length+1;d--;)t.push(void 0);return t.splice(o,0,t.splice(s,1)[0]),t}const Wi=(t,s)=>{const o=[{regex:/\$args\((\d*)(:?)(\d*)\)/g,replacer:(f,c)=>s},{regex:/\$rand\((\d+),(\d+)\)/g,replacer:(f,c,n)=>s},{regex:/\$var\(([^)]+)\)/g,replacer:(f,c)=>s},{regex:/\$user\.name/g,replacer:()=>s},{regex:/\$([a-z][a-z0-9]*)(?!\()/g,replacer:(f,c)=>f},{regex:/\$customapi\(([^$\)]*)\)\[\'([A-Za-z0-9_ -]+)\'\]/g,replacer:(f,c,n)=>s},{regex:/\$customapi\(([^$\)]*)\)/g,replacer:(f,c)=>s},{regex:/\$urlencode\(([^$\)]*)\)/g,replacer:(f,c)=>s},{regex:/\$calc\((\d+)([*/+-])(\d+)\)/g,replacer:(f,c,n,m)=>s}];let d=t,v;do{v=d;for(let f of o)d=d.replace(f.regex,f.replacer)}while(v!==d);return d},Hi=(t,s=",",o=-1)=>{const d=t.split(s);return o===-1||d.length<=o?d:[...d.slice(0,o-1),d.slice(o-1).join(s)]},Gi=t=>{let s=t.length;for(;s>0;){let o=Math.floor(Math.random()*s);s--;let d=t[s];t[s]=t[o],t[o]=d}return t};var J={arrayMove:qi,humanDuration:Bi,parseHumanDuration:Ji,mustParseHumanDuration:ct,doDummyReplacements:Wi,split:Hi,shuffle:Gi};const Ki=V({created(){this.$me=N.getMe()},data:()=>({$me:null,commands:[],settings:{volume:100},adminSettings:{showImages:!0},globalVariables:[],ws:null,editIdx:null,editCommand:null,addDropdownActive:!1,possibleCommands:[{action:"text",title:"Send a message to chat",text:"Add text"},{action:"media",title:"Display an image and/or play a sound",text:"Add media"},{action:"countdown",title:"Add a countdown or messages spaced by time intervals",text:"Add countdown"},{action:"dict_lookup",title:"Lookup a translation of a word",text:"Add dict_lookup"},{action:"madochan_createword",title:"Create a word with madochan",text:"Add madochan"},{action:"chatters",title:"Displays users who chatted during the stream",text:"Add chatters"}],possibleActions:["text","media","countdown","dict_lookup","madochan_createword","chatters"],filter:{search:"",actions:[]},inited:!1,tab:"commands"}),computed:{baseVolume(){return this.settings.volume},widgetUrl(){return`${location.protocol}//${location.host}/widget/media/${this.$me.widgetToken}/`}},methods:{commandCount(t){let s=0;for(const o of this.commands)o.action===t&&s++;return s},filteredOut(t){if(this.filter.actions.length>0&&!this.filter.actions.includes(t.action))return!0;if(!this.filter.search)return!1;const s=this.filter.search.toLowerCase();return!t.triggers.find(({type:o,data:d})=>o==="command"&&d.command.toLowerCase().indexOf(s)>=0)},permissionsStr(t){if(!t.restrict_to||t.restrict_to.length===0)return"Everyone";const s=[];return t.restrict_to.includes("broadcaster")&&s.push("Broadcaster"),t.restrict_to.includes("mod")&&s.push("Moderators"),t.restrict_to.includes("sub")&&s.push("Subscribers"),s.join(", ")},add(t){const s=Ri(t);!s||(this.editIdx=this.commands.length,this.editCommand=s)},remove(t){this.commands=this.commands.filter((s,o)=>o!==t),this.sendSave()},edit(t){this.editIdx=t,this.editCommand=this.commands[t]},duplicate(t){this.editIdx=this.commands.length,this.editCommand=JSON.parse(JSON.stringify(this.commands[t]))},editedCommand(t){this.editIdx!==null&&(this.commands[this.editIdx]=t,this.sendSave(),this.editIdx=null,this.editCommand=null)},sendSave(){this.sendMsg({event:"save",commands:this.commands,settings:this.settings,adminSettings:this.adminSettings})},sendMsg(t){this.ws?this.ws.send(JSON.stringify(t)):console.warn("sendMsg: this.ws not initialized")},dragEnd(t){this.commands=J.arrayMove(this.commands,t.oldIndex,t.newIndex),this.sendSave()},openDropdown(){this.addDropdownActive=!0},closeDropdown(){this.addDropdownActive=!1},hideAddDropdown(t){!this.$refs.addDropdown||this.$refs.addDropdown.contains(t.target)||this.closeDropdown()}},async mounted(){this.ws=new Y(this.$conf.wsBase+"/general",this.$me.token),this.ws.onMessage("init",t=>{this.commands=t.commands,this.settings=t.settings,this.adminSettings=t.adminSettings,this.globalVariables=t.globalVariables,this.inited=!0}),this.ws.connect(),window.addEventListener("click",this.hideAddDropdown)},unmounted(){this.ws&&this.ws.disconnect(),window.removeEventListener("click",this.hideAddDropdown)}}),P=t=>(G("data-v-74765307"),t=t(),K(),t),Yi={id:"app"},Xi={id:"top",ref:"top"},Qi={id:"main",ref:"main"},Zi={class:"tabs"},xi=P(()=>e("a",null,"Commands",-1)),tl=[xi],el=P(()=>e("a",null,"Settings",-1)),sl=[el],nl={key:1},il={class:"actions"},ll={class:"dropdown-trigger"},ol=["disabled"],al=P(()=>e("span",null,"Add command",-1)),dl=P(()=>e("span",{class:"icon is-small"},[e("i",{class:"fa fa-angle-down","aria-hidden":"true"})],-1)),rl=[al,dl],ul={class:"dropdown-menu",id:"dropdown-menu",role:"menu"},cl={class:"dropdown-content"},ml=["onClick","title"],hl=["href"],pl=P(()=>e("div",{class:"mr-1"},"Filter:",-1)),gl={class:"field has-addons mr-1 mb-0"},fl={class:"control"},vl=["value"],$l={key:0,class:"table-container"},yl={class:"table is-striped",ref:"table"},bl=P(()=>e("th",null,null,-1)),_l=P(()=>e("th",null,null,-1)),wl=P(()=>e("th",null,"Trigger",-1)),kl=g(" Response "),Cl=g(" Show images "),Sl=P(()=>e("th",null,"Type",-1)),Vl=P(()=>e("th",null,"Permissions",-1)),Il=P(()=>e("th",null,null,-1)),Ul=P(()=>e("th",null,null,-1)),Dl=P(()=>e("td",{class:"pt-4 handle"},[e("i",{class:"fa fa-arrows"})],-1)),Al={class:"pl-0 pr-0"},Pl=["onClick"],Tl=P(()=>e("i",{class:"fa fa-pencil"},null,-1)),El=[Tl],Fl={class:"col-triggers"},Ml={key:0},zl={key:1},Ol=P(()=>e("span",{class:"is-small",title:"Channel Point Reward"},[e("i",{class:"fa fa-bullseye"}),g(": ")],-1)),Nl={key:2},Ll=P(()=>e("span",{class:"is-small"},"Timer: ",-1)),Rl={key:0},jl={key:1},Jl={key:2},Bl={key:3},ql={key:0},Wl={key:0,class:"spacerow media-holder media-holder-inline"},Hl={key:1},Gl={key:2,class:"fa fa-plus is-justify-content-center mr-2 ml-2"},Kl={key:3,class:"ml-2"},Yl=g("for at least "),Xl={key:4,class:"ml-2"},Ql=g("for "),Zl={key:5},xl={key:0},to=P(()=>e("span",null,"\u2192",-1)),eo=g(" \u2715 "),so=P(()=>e("span",null,"\u2192",-1)),no={key:1},io={key:1},lo={key:2},oo=g(" Media("),ao={key:0},ro={key:1},uo={key:2},co=g(") "),mo={key:3},ho={class:"pl-0 pr-0"},po=P(()=>e("i",{class:"fa fa-trash"},null,-1)),go=["onClick"],fo=P(()=>e("i",{class:"fa fa-clone"},null,-1)),vo=[fo],$o={key:1},yo={key:2},bo={key:0,class:"table is-striped",ref:"table"},_o=P(()=>e("td",null,[e("code",null,"settings.volume")],-1)),wo=P(()=>e("td",null,"Base volume for all media playing from commands",-1));function ko(t,s,o,d,v,f){const c=b("navbar"),n=b("command-editor"),m=b("duration"),u=b("responsive-image"),$=b("player"),S=b("doubleclick-button"),a=b("draggable"),C=b("volume-slider");return i(),l("div",Yi,[e("div",Xi,[k(c)],512),e("div",Qi,[t.editCommand?(i(),F(n,{key:0,globalVariables:t.globalVariables,modelValue:t.editCommand,mode:t.editIdx>=t.commands.length?"create":"edit",baseVolume:t.baseVolume,"onUpdate:modelValue":t.editedCommand,onCancel:s[0]||(s[0]=r=>t.editCommand=null)},null,8,["globalVariables","modelValue","mode","baseVolume","onUpdate:modelValue"])):p("",!0),e("div",Zi,[e("ul",null,[e("li",{class:A({"is-active":t.tab==="commands"}),onClick:s[1]||(s[1]=r=>t.tab="commands")},tl,2),e("li",{class:A({"is-active":t.tab==="settings"}),onClick:s[2]||(s[2]=r=>t.tab="settings")},sl,2)])]),t.inited&&t.tab==="commands"?(i(),l("div",nl,[e("div",il,[e("div",{class:A(["dropdown mr-1",{"is-active":t.addDropdownActive}]),ref:"addDropdown"},[e("div",ll,[e("button",{class:"button is-small mr-1","aria-haspopup":"true","aria-controls":"dropdown-menu",disabled:t.inited?null:!0,onClick:s[3]||(s[3]=(...r)=>t.openDropdown&&t.openDropdown(...r))},rl,8,ol)]),e("div",ul,[e("div",cl,[(i(!0),l(U,null,D(t.possibleCommands,(r,j)=>(i(),l("a",{href:"#",class:"dropdown-item",key:j,onClick:E=>{t.closeDropdown(),t.add(r.action)},title:r.title},_(r.text),9,ml))),128))])])],2),e("a",{class:"button is-small mr-1",href:t.widgetUrl,target:"_blank"},"Open Media widget",8,hl),pl,e("div",gl,[e("div",fl,[h(e("input",{class:"input is-small","onUpdate:modelValue":s[4]||(s[4]=r=>t.filter.search=r)},null,512),[[y,t.filter.search]])])]),(i(!0),l(U,null,D(t.possibleActions,(r,j)=>(i(),l("label",{class:"mr-1",key:j},[h(e("input",{class:"mr-1",type:"checkbox",value:r,"onUpdate:modelValue":s[5]||(s[5]=E=>t.filter.actions=E)},null,8,vl),[[M,t.filter.actions]]),g(_(r)+" ("+_(t.commandCount(r))+")",1)]))),128))]),t.commands.length>0?(i(),l("div",$l,[e("table",yl,[e("thead",null,[e("tr",null,[bl,_l,wl,e("th",null,[kl,e("label",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":[s[6]||(s[6]=r=>t.adminSettings.showImages=r),s[7]||(s[7]=(...r)=>t.sendSave&&t.sendSave(...r))]},null,512),[[M,t.adminSettings.showImages]]),Cl])]),Sl,Vl,Il,Ul])]),k(a,{modelValue:t.commands,onEnd:t.dragEnd,tag:"tbody",handle:".handle","item-key":"id"},{item:O(({element:r,index:j})=>[h(e("tr",null,[Dl,e("td",Al,[e("button",{class:"button is-small",onClick:E=>t.edit(j)},El,8,Pl)]),e("td",Fl,[(i(!0),l(U,null,D(r.triggers,(E,z)=>(i(),l("div",{key:z,class:"spacerow"},[r.triggers[z].type==="command"?(i(),l("div",Ml,[e("code",null,_(r.triggers[z].data.command),1)])):p("",!0),r.triggers[z].type==="reward_redemption"?(i(),l("div",zl,[Ol,e("code",null,_(r.triggers[z].data.command),1)])):p("",!0),r.triggers[z].type==="timer"?(i(),l("div",Nl,[Ll,e("code",null,[g(_(r.triggers[z].data.minLines)+" lines, ",1),k(m,{value:r.triggers[z].data.minInterval},null,8,["value"])])])):p("",!0)]))),128))]),e("td",null,[r.action==="dict_lookup"?(i(),l("div",Rl," Outputs the translation for the searched word. ")):p("",!0),r.action==="madochan_createword"?(i(),l("div",jl," Creates a word for a definition. ")):p("",!0),r.action==="chatters"?(i(),l("div",Jl," Outputs the people who chatted during the stream. ")):p("",!0),r.action==="text"?(i(),l("div",Bl,[(i(!0),l(U,null,D(r.data.text,(E,z)=>(i(),l(U,{key:z},[e("code",null,_(r.data.text[z]),1),z<r.data.text.length-1?(i(),l("span",ql,"or")):p("",!0)],64))),128))])):p("",!0),r.action==="media"?(i(),l("div",{key:4,class:A(r.action)},[r.data.image.file||r.data.sound.file?(i(),l("div",Wl,[r.data.image.file&&t.adminSettings.showImages?(i(),F(u,{key:0,src:r.data.image.file,title:r.data.image.filename,width:"100px",height:"50px",style:{display:"inline-block"}},null,8,["src","title"])):r.data.image.file?(i(),l("code",Hl,_(r.data.image.filename),1)):p("",!0),r.data.image.file&&r.data.sound.file?(i(),l("i",Gl)):p("",!0),k($,{src:r.data.sound.file,name:r.data.sound.filename,volume:r.data.sound.volume,baseVolume:t.baseVolume,class:"button is-small is-justify-content-center"},null,8,["src","name","volume","baseVolume"]),r.data.image.file&&r.data.sound.file?(i(),l("span",Kl,[Yl,k(m,{value:r.data.minDurationMs},null,8,["value"])])):r.data.image.file?(i(),l("span",Xl,[Ql,k(m,{value:r.data.minDurationMs},null,8,["value"])])):p("",!0)])):p("",!0)],2)):p("",!0),r.action==="countdown"?(i(),l("div",Zl,[(r.data.type||"auto")==="auto"?(i(),l("div",xl,[e("code",null,_(r.data.intro),1),to,e("code",null,_(r.data.steps),1),eo,k(m,{value:r.data.interval},null,8,["value"]),so,e("code",null,_(r.data.outro),1)])):(i(),l("div",no,[(i(!0),l(U,null,D(r.data.actions,(E,z)=>(i(),l(U,{key:z},[E.type==="delay"?(i(),F(m,{key:0,value:E.value},null,8,["value"])):p("",!0),E.type==="text"?(i(),l("code",io,_(E.value),1)):p("",!0),E.type==="media"?(i(),l("code",lo,[oo,E.value.image.file?(i(),l("span",ao,_(E.value.image.filename),1)):p("",!0),E.value.image.file&&E.value.sound.file?(i(),l("span",ro,"+")):p("",!0),E.value.sound.file?(i(),l("span",uo,_(E.value.sound.filename),1)):p("",!0),co])):p("",!0),z<r.data.actions.length-1?(i(),l("span",mo,"\u2192")):p("",!0)],64))),128))]))])):p("",!0)]),e("td",null,_(r.action),1),e("td",null,_(t.permissionsStr(r)),1),e("td",ho,[k(S,{class:"button is-small mr-1",message:"Are you sure?",timeout:1e3,onDoubleclick:E=>t.remove(j)},{default:O(()=>[po]),_:2},1032,["onDoubleclick"]),e("button",{class:"button is-small",onClick:E=>t.duplicate(j)},vo,8,go)])],512),[[lt,!t.filteredOut(r)]])]),_:1},8,["modelValue","onEnd"])],512)])):(i(),l("div",$o,"No commands set up"))])):p("",!0),t.inited&&t.tab==="settings"?(i(),l("div",yo,[t.settings?(i(),l("table",bo,[e("tbody",null,[e("tr",null,[_o,e("td",null,[k(C,{modelValue:t.settings.volume,"onUpdate:modelValue":[s[8]||(s[8]=r=>t.settings.volume=r),t.sendSave]},null,8,["modelValue","onUpdate:modelValue"])]),wo])])],512)):p("",!0)])):p("",!0)],512)])}var Co=I(Ki,[["render",ko],["__scopeId","data-v-74765307"]]);const So=V({created(){this.$me=N.getMe()},data:()=>({$me:null,unchangedJson:"{}",changedJson:"{}",settings:null,defaultSettings:null,ws:null}),watch:{settings:{deep:!0,handler(t){this.changedJson=JSON.stringify(t)}}},computed:{changed(){return this.unchangedJson!==this.changedJson},widgetUrl(){return`${location.protocol}//${location.host}/widget/speech-to-text/${this.$me.widgetToken}/`}},methods:{sendSave(){if(!this.settings){console.warn("sendSave: this.settings not initialized");return}this.sendMsg({event:"save",settings:this.settings})},sendMsg(t){if(!this.ws){console.warn("sendMsg: this.ws not initialized");return}this.ws.send(JSON.stringify(t))}},async mounted(){this.ws=new Y(this.$conf.wsBase+"/speech-to-text",this.$me.token),this.ws.onMessage("init",t=>{this.settings=t.settings,this.defaultSettings=t.defaultSettings,this.unchangedJson=JSON.stringify(t.settings)}),this.ws.connect()},unmounted(){this.ws&&this.ws.disconnect()}}),Vo={id:"app"},Io={id:"top",ref:"top"},Uo={id:"actionbar",class:"p-1"},Do=["disabled"],Ao=["href"],Po={id:"main",ref:"main"},To={key:0,class:"table is-striped",ref:"table"},Eo=e("tr",null,[e("td",{colspan:"3"},"General")],-1),Fo=e("td",null,[e("code",null,"settings.style.bgColor")],-1),Mo=["disabled"],zo=e("i",{class:"fa fa-remove"},null,-1),Oo=[zo],No=e("td",null,[e("code",null,"settings.style.vAlign")],-1),Lo={class:"select is-small"},Ro=e("option",{value:"top"},"top",-1),jo=e("option",{value:"bottom"},"bottom",-1),Jo=[Ro,jo],Bo=["disabled"],qo=e("i",{class:"fa fa-remove"},null,-1),Wo=[qo],Ho=e("tr",null,[e("td",{colspan:"3"},"Recognition")],-1),Go=e("td",null,[e("code",null,"settings.recognition.lang")],-1),Ko=["disabled"],Yo=e("i",{class:"fa fa-remove"},null,-1),Xo=[Yo],Qo=e("td",null,[e("code",null,"settings.recognition.synthesize")],-1),Zo=["disabled"],xo=e("i",{class:"fa fa-remove"},null,-1),ta=[xo],ea=e("td",null,[e("code",null,"settings.recognition.synthesizeLang")],-1),sa=["disabled"],na=e("i",{class:"fa fa-remove"},null,-1),ia=[na],la=e("td",null,[e("code",null,"settings.recognition.display")],-1),oa=["disabled"],aa=e("i",{class:"fa fa-remove"},null,-1),da=[aa],ra=e("td",null,[e("code",null,"settings.styles.recognition.color")],-1),ua=["disabled"],ca=e("i",{class:"fa fa-remove"},null,-1),ma=[ca],ha=e("td",null,[e("code",null,"settings.styles.recognition.strokeWidth")],-1),pa=["disabled"],ga=e("i",{class:"fa fa-remove"},null,-1),fa=[ga],va=e("td",null,[e("code",null,"settings.styles.recognition.strokeColor")],-1),$a=["disabled"],ya=e("i",{class:"fa fa-remove"},null,-1),ba=[ya],_a=e("td",null,[e("code",null,"settings.styles.recognition.fontFamily")],-1),wa=["disabled"],ka=e("i",{class:"fa fa-remove"},null,-1),Ca=[ka],Sa=e("td",null,[e("code",null,"settings.styles.recognition.fontSize")],-1),Va=["disabled"],Ia=e("i",{class:"fa fa-remove"},null,-1),Ua=[Ia],Da=e("td",null,[e("code",null,"settings.styles.recognition.fontWeight")],-1),Aa=["disabled"],Pa=e("i",{class:"fa fa-remove"},null,-1),Ta=[Pa],Ea=e("tr",null,[e("td",{colspan:"3"},"Translation")],-1),Fa=e("td",null,[e("code",null,"settings.translation.enabled")],-1),Ma=["disabled"],za=e("i",{class:"fa fa-remove"},null,-1),Oa=[za],Na=e("td",null,[e("code",null,"settings.translation.synthesize")],-1),La=["disabled"],Ra=e("i",{class:"fa fa-remove"},null,-1),ja=[Ra],Ja=e("td",null,[e("code",null,"settings.translation.synthesizeLang")],-1),Ba=["disabled"],qa=e("i",{class:"fa fa-remove"},null,-1),Wa=[qa],Ha=e("td",null,[e("code",null,"settings.translation.langSrc")],-1),Ga=["disabled"],Ka=e("i",{class:"fa fa-remove"},null,-1),Ya=[Ka],Xa=e("td",null,[e("code",null,"settings.translation.langDst")],-1),Qa=["disabled"],Za=e("i",{class:"fa fa-remove"},null,-1),xa=[Za],td=e("td",null,[e("code",null,"settings.styles.translation.color")],-1),ed=["disabled"],sd=e("i",{class:"fa fa-remove"},null,-1),nd=[sd],id=e("td",null,[e("code",null,"settings.styles.translation.strokeWidth")],-1),ld=["disabled"],od=e("i",{class:"fa fa-remove"},null,-1),ad=[od],dd=e("td",null,[e("code",null,"settings.styles.translation.strokeColor")],-1),rd=["disabled"],ud=e("i",{class:"fa fa-remove"},null,-1),cd=[ud],md=e("td",null,[e("code",null,"settings.styles.translation.fontFamily")],-1),hd=["disabled"],pd=e("i",{class:"fa fa-remove"},null,-1),gd=[pd],fd=e("td",null,[e("code",null,"settings.styles.translation.fontSize")],-1),vd=["disabled"],$d=e("i",{class:"fa fa-remove"},null,-1),yd=[$d],bd=e("td",null,[e("code",null,"settings.styles.translation.fontWeight")],-1),_d=["disabled"],wd=e("i",{class:"fa fa-remove"},null,-1),kd=[wd],Cd=e("tr",null,[e("td",{colspan:"3"},"Debug")],-1),Sd=e("td",null,[e("code",null,"settings.status.enabled")],-1),Vd=["disabled"],Id=e("i",{class:"fa fa-remove"},null,-1),Ud=[Id];function Dd(t,s,o,d,v,f){const c=b("navbar");return i(),l("div",Vo,[e("div",Io,[k(c),e("div",Uo,[e("button",{class:"button is-small is-primary mr-1",disabled:!t.changed,onClick:s[0]||(s[0]=(...n)=>t.sendSave&&t.sendSave(...n))}," Save ",8,Do),e("a",{class:"button is-small",href:t.widgetUrl,target:"_blank"},"Open widget",8,Ao)])],512),e("div",Po,[t.settings?(i(),l("table",To,[e("tbody",null,[Eo,e("tr",null,[Fo,e("td",null,[h(e("input",{class:"input is-small",type:"color","onUpdate:modelValue":s[1]||(s[1]=n=>t.settings.styles.bgColor=n)},null,512),[[y,t.settings.styles.bgColor]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.bgColor===t.defaultSettings.styles.bgColor,onClick:s[2]||(s[2]=n=>t.settings.styles.bgColor=t.defaultSettings.styles.bgColor)},Oo,8,Mo)])]),e("tr",null,[No,e("td",null,[e("div",Lo,[h(e("select",{"onUpdate:modelValue":s[3]||(s[3]=n=>t.settings.styles.vAlign=n)},Jo,512),[[tt,t.settings.styles.vAlign]])])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.vAlign===t.defaultSettings.styles.vAlign,onClick:s[4]||(s[4]=n=>t.settings.styles.vAlign=t.defaultSettings.styles.vAlign)},Wo,8,Bo)])]),Ho,e("tr",null,[Go,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[5]||(s[5]=n=>t.settings.recognition.lang=n)},null,512),[[y,t.settings.recognition.lang]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.recognition.lang===t.defaultSettings.recognition.lang,onClick:s[6]||(s[6]=n=>t.settings.recognition.lang=t.defaultSettings.recognition.lang)},Xo,8,Ko)])]),e("tr",null,[Qo,e("td",null,[h(e("input",{class:"is-small",type:"checkbox","onUpdate:modelValue":s[7]||(s[7]=n=>t.settings.recognition.synthesize=n)},null,512),[[M,t.settings.recognition.synthesize]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.recognition.synthesize===t.defaultSettings.recognition.synthesize,onClick:s[8]||(s[8]=n=>t.settings.translation.enabled=t.defaultSettings.translation.enabled)},ta,8,Zo)])]),e("tr",null,[ea,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[9]||(s[9]=n=>t.settings.recognition.synthesizeLang=n)},null,512),[[y,t.settings.recognition.synthesizeLang]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.recognition.synthesizeLang===t.defaultSettings.recognition.synthesizeLang,onClick:s[10]||(s[10]=n=>t.settings.recognition.synthesizeLang=t.defaultSettings.recognition.synthesizeLang)},ia,8,sa)])]),e("tr",null,[la,e("td",null,[h(e("input",{class:"is-small",type:"checkbox","onUpdate:modelValue":s[11]||(s[11]=n=>t.settings.recognition.display=n)},null,512),[[M,t.settings.recognition.display]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.recognition.display===t.defaultSettings.recognition.display,onClick:s[12]||(s[12]=n=>t.settings.recognition.display=t.defaultSettings.recognition.display)},da,8,oa)])]),e("tr",null,[ra,e("td",null,[h(e("input",{class:"input is-small",type:"color","onUpdate:modelValue":s[13]||(s[13]=n=>t.settings.styles.recognition.color=n)},null,512),[[y,t.settings.styles.recognition.color]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.recognition.color===t.defaultSettings.styles.recognition.color,onClick:s[14]||(s[14]=n=>t.settings.styles.recognition.color=t.defaultSettings.styles.recognition.color)},ma,8,ua)])]),e("tr",null,[ha,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[15]||(s[15]=n=>t.settings.styles.recognition.strokeWidth=n)},null,512),[[y,t.settings.styles.recognition.strokeWidth]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.recognition.strokeWidth===t.defaultSettings.styles.recognition.strokeWidth,onClick:s[16]||(s[16]=n=>t.settings.styles.recognition.strokeWidth=t.defaultSettings.styles.recognition.strokeWidth)},fa,8,pa)])]),e("tr",null,[va,e("td",null,[h(e("input",{class:"input is-small",type:"color","onUpdate:modelValue":s[17]||(s[17]=n=>t.settings.styles.recognition.strokeColor=n)},null,512),[[y,t.settings.styles.recognition.strokeColor]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.recognition.strokeColor===t.defaultSettings.styles.recognition.strokeColor,onClick:s[18]||(s[18]=n=>t.settings.styles.recognition.strokeColor=t.defaultSettings.styles.recognition.strokeColor)},ba,8,$a)])]),e("tr",null,[_a,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[19]||(s[19]=n=>t.settings.styles.recognition.fontFamily=n)},null,512),[[y,t.settings.styles.recognition.fontFamily]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.recognition.fontFamily===t.defaultSettings.styles.recognition.fontFamily,onClick:s[20]||(s[20]=n=>t.settings.styles.recognition.fontFamily=t.defaultSettings.styles.recognition.fontFamily)},Ca,8,wa)])]),e("tr",null,[Sa,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[21]||(s[21]=n=>t.settings.styles.recognition.fontSize=n)},null,512),[[y,t.settings.styles.recognition.fontSize]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.recognition.fontSize===t.defaultSettings.styles.recognition.fontSize,onClick:s[22]||(s[22]=n=>t.settings.styles.recognition.fontSize=t.defaultSettings.styles.recognition.fontSize)},Ua,8,Va)])]),e("tr",null,[Da,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[23]||(s[23]=n=>t.settings.styles.recognition.fontWeight=n)},null,512),[[y,t.settings.styles.recognition.fontWeight]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.recognition.fontWeight===t.defaultSettings.styles.recognition.fontWeight,onClick:s[24]||(s[24]=n=>t.settings.styles.weight=t.defaultSettings.styles.weight)},Ta,8,Aa)])]),Ea,e("tr",null,[Fa,e("td",null,[h(e("input",{class:"is-small",type:"checkbox","onUpdate:modelValue":s[25]||(s[25]=n=>t.settings.translation.enabled=n)},null,512),[[M,t.settings.translation.enabled]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.translation.enabled===t.defaultSettings.translation.enabled,onClick:s[26]||(s[26]=n=>t.settings.translation.enabled=t.defaultSettings.translation.enabled)},Oa,8,Ma)])]),e("tr",null,[Na,e("td",null,[h(e("input",{class:"is-small",type:"checkbox","onUpdate:modelValue":s[27]||(s[27]=n=>t.settings.translation.synthesize=n)},null,512),[[M,t.settings.translation.synthesize]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.translation.synthesize===t.defaultSettings.translation.synthesize,onClick:s[28]||(s[28]=n=>t.settings.translation.synthesize=t.defaultSettings.translation.synthesize)},ja,8,La)])]),e("tr",null,[Ja,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[29]||(s[29]=n=>t.settings.translation.synthesizeLang=n)},null,512),[[y,t.settings.translation.synthesizeLang]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.translation.synthesizeLang===t.defaultSettings.translation.synthesizeLang,onClick:s[30]||(s[30]=n=>t.settings.translation.synthesizeLang=t.defaultSettings.translation.synthesizeLang)},Wa,8,Ba)])]),e("tr",null,[Ha,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[31]||(s[31]=n=>t.settings.translation.langSrc=n)},null,512),[[y,t.settings.translation.langSrc]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.translation.langSrc===t.defaultSettings.translation.langSrc,onClick:s[32]||(s[32]=n=>t.settings.translation.langSrc=t.defaultSettings.translation.langSrc)},Ya,8,Ga)])]),e("tr",null,[Xa,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[33]||(s[33]=n=>t.settings.translation.langDst=n)},null,512),[[y,t.settings.translation.langDst]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.translation.langDst===t.defaultSettings.translation.langDst,onClick:s[34]||(s[34]=n=>t.settings.translation.langDst=t.defaultSettings.translation.langDst)},xa,8,Qa)])]),e("tr",null,[td,e("td",null,[h(e("input",{class:"input is-small",type:"color","onUpdate:modelValue":s[35]||(s[35]=n=>t.settings.styles.translation.color=n)},null,512),[[y,t.settings.styles.translation.color]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.translation.color===t.defaultSettings.styles.translation.color,onClick:s[36]||(s[36]=n=>t.settings.styles.translation.color=t.defaultSettings.styles.translation.color)},nd,8,ed)])]),e("tr",null,[id,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[37]||(s[37]=n=>t.settings.styles.translation.strokeWidth=n)},null,512),[[y,t.settings.styles.translation.strokeWidth]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.translation.strokeWidth===t.defaultSettings.styles.translation.strokeWidth,onClick:s[38]||(s[38]=n=>t.settings.styles.translation.strokeWidth=t.defaultSettings.styles.translation.strokeWidth)},ad,8,ld)])]),e("tr",null,[dd,e("td",null,[h(e("input",{class:"input is-small",type:"color","onUpdate:modelValue":s[39]||(s[39]=n=>t.settings.styles.translation.strokeColor=n)},null,512),[[y,t.settings.styles.translation.strokeColor]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.translation.strokeColor===t.defaultSettings.styles.translation.strokeColor,onClick:s[40]||(s[40]=n=>t.settings.styles.translation.strokeColor=t.defaultSettings.styles.translation.strokeColor)},cd,8,rd)])]),e("tr",null,[md,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[41]||(s[41]=n=>t.settings.styles.translation.fontFamily=n)},null,512),[[y,t.settings.styles.translation.fontFamily]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.translation.fontFamily===t.defaultSettings.styles.translation.fontFamily,onClick:s[42]||(s[42]=n=>t.settings.styles.translation.fontFamily=t.defaultSettings.styles.translation.fontFamily)},gd,8,hd)])]),e("tr",null,[fd,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[43]||(s[43]=n=>t.settings.styles.translation.fontSize=n)},null,512),[[y,t.settings.styles.translation.fontSize]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.translation.fontSize===t.defaultSettings.styles.translation.fontSize,onClick:s[44]||(s[44]=n=>t.settings.styles.translation.fontSize=t.defaultSettings.styles.translation.fontSize)},yd,8,vd)])]),e("tr",null,[bd,e("td",null,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[45]||(s[45]=n=>t.settings.styles.translation.fontWeight=n)},null,512),[[y,t.settings.styles.translation.fontWeight]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.translation.fontWeight===t.defaultSettings.styles.translation.fontWeight,onClick:s[46]||(s[46]=n=>t.settings.styles.weight=t.defaultSettings.styles.weight)},kd,8,_d)])]),Cd,e("tr",null,[Sd,e("td",null,[h(e("input",{class:"is-small",type:"checkbox","onUpdate:modelValue":s[47]||(s[47]=n=>t.settings.status.enabled=n)},null,512),[[M,t.settings.status.enabled]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.status.enabled===t.defaultSettings.status.enabled,onClick:s[48]||(s[48]=n=>t.settings.status.enabled=t.defaultSettings.status.enabled)},Ud,8,Vd)])])])],512)):p("",!0)],512)])}var Ad=I(So,[["render",Dd]]);const Pd=V({data:()=>({editIdx:-1,editEntity:null,unchangedJson:"{}",changedJson:"{}",settings:null,defaultSettings:null,ws:null,tab:"avatars",$me:null}),watch:{settings:{deep:!0,handler(t){this.changedJson=JSON.stringify(t)}}},computed:{changed(){return this.unchangedJson!==this.changedJson},controlWidgetUrl(){return`${location.protocol}//${location.host}/widget/avatar/${this.$me.widgetToken}/`},displayWidgetUrl(){return`${location.protocol}//${location.host}/widget/avatar_receive/${this.$me.widgetToken}/`}},methods:{edit(t){if(!this.settings){console.warn("edit: this.settings not initialized");return}this.editIdx=t,this.editEntity=this.settings.avatarDefinitions[t]},remove(t){if(!this.settings){console.warn("remove: this.settings not initialized");return}this.settings.avatarDefinitions=this.settings.avatarDefinitions.filter((s,o)=>o!==t),this.sendSave()},duplicate(t){if(!this.settings){console.warn("duplicate: this.settings not initialized");return}this.editIdx=this.settings.avatarDefinitions.length,this.editEntity=JSON.parse(JSON.stringify(this.settings.avatarDefinitions[t]))},updatedAvatar(t){if(!this.settings){console.warn("updateAvatar: this.settings not initialized");return}this.settings.avatarDefinitions[this.editIdx]=t,this.sendSave()},addAvatar(){if(!this.settings){console.warn("addAvatar: this.settings not initialized");return}const t={name:"Unnamed Avatar",stateDefinitions:[{value:"default",deletable:!1},{value:"speaking",deletable:!1}],slotDefinitions:[]};this.editIdx=this.settings.avatarDefinitions.length,this.editEntity=t},sendSave(){if(!this.settings){console.warn("sendSave: this.settings not initialized");return}this.sendMsg({event:"save",settings:this.settings})},sendMsg(t){if(!this.ws){console.warn("sendMsg: this.ws not initialized");return}this.ws.send(JSON.stringify(t))},dragEnd(t){if(!this.settings){console.warn("dragEnd: this.settings not initialized");return}this.settings.avatarDefinitions=J.arrayMove(this.settings.avatarDefinitions,t.oldIndex,t.newIndex),this.sendSave()}},created(){this.$me=N.getMe()},async mounted(){this.ws=new Y(this.$conf.wsBase+"/avatar",this.$me.token),this.ws.onMessage("init",t=>{this.settings=t.settings,this.defaultSettings=t.defaultSettings,this.unchangedJson=JSON.stringify(t.settings)}),this.ws.connect()},unmounted(){this.ws&&this.ws.disconnect()}}),Td={id:"app"},Ed={id:"top",ref:"top"},Fd={id:"actionbar",class:"p-1"},Md=["href"],zd=["href"],Od={key:0,id:"main",ref:"main"},Nd={class:"tabs"},Ld=e("a",null,"Avatars",-1),Rd=[Ld],jd=e("a",null,"Settings",-1),Jd=[jd],Bd={key:0,class:"table is-striped"},qd=e("tr",null,[e("td",{colspan:"3"},"General")],-1),Wd=e("td",null,[e("code",null,"settings.style.bgColor")],-1),Hd=["disabled"],Gd=e("i",{class:"fa fa-remove"},null,-1),Kd=[Gd],Yd={key:1},Xd={class:"table is-striped"},Qd=e("thead",null,[e("tr",null,[e("th"),e("th"),e("th",null,"Preview"),e("th",null,"Name"),e("th")])],-1),Zd=e("td",{class:"pt-4 handle"},[e("i",{class:"fa fa-arrows"})],-1),xd={class:"pl-0 pr-0"},tr=["onClick"],er=e("i",{class:"fa fa-pencil"},null,-1),sr=[er],nr={class:"pl-0 pr-0"},ir=e("i",{class:"fa fa-trash"},null,-1),lr=["onClick"],or=e("i",{class:"fa fa-clone"},null,-1),ar=[or];function dr(t,s,o,d,v,f){const c=b("navbar"),n=b("avatar-preview"),m=b("doubleclick-button"),u=b("draggable"),$=b("avatar-editor");return i(),l("div",Td,[e("div",Ed,[k(c),e("div",Fd,[e("a",{class:"button is-small mr-1",href:t.controlWidgetUrl,target:"_blank"},"Open control widget",8,Md),e("a",{class:"button is-small mr-1",href:t.displayWidgetUrl,target:"_blank"},"Open display widget",8,zd)])],512),t.settings?(i(),l("div",Od,[e("div",Nd,[e("ul",null,[e("li",{class:A({"is-active":t.tab==="avatars"}),onClick:s[0]||(s[0]=S=>t.tab="avatars")},Rd,2),e("li",{class:A({"is-active":t.tab==="settings"}),onClick:s[1]||(s[1]=S=>t.tab="settings")},Jd,2)])]),t.tab==="settings"?(i(),l("table",Bd,[e("tbody",null,[qd,e("tr",null,[Wd,e("td",null,[h(e("input",{class:"input is-small",type:"color","onUpdate:modelValue":[s[2]||(s[2]=S=>t.settings.styles.bgColor=S),s[3]||(s[3]=(...S)=>t.sendSave&&t.sendSave(...S))]},null,512),[[y,t.settings.styles.bgColor]])]),e("td",null,[e("button",{class:"button is-small",disabled:t.settings.styles.bgColor===t.defaultSettings.styles.bgColor,onClick:s[4]||(s[4]=S=>t.settings.styles.bgColor=t.defaultSettings.styles.bgColor)},Kd,8,Hd)])])])])):p("",!0),t.tab==="avatars"?(i(),l("div",Yd,[e("table",Xd,[Qd,k(u,{modelValue:t.settings.avatarDefinitions,onEnd:t.dragEnd,tag:"tbody",handle:".handle","item-key":"id"},{item:O(({element:S,index:a})=>[e("tr",null,[Zd,e("td",xd,[e("button",{class:"button is-small",onClick:C=>t.edit(a)},sr,8,tr)]),e("td",null,[k(n,{avatar:S},null,8,["avatar"])]),e("td",null,_(S.name),1),e("td",nr,[k(m,{class:"button is-small mr-1",message:"Are you sure?",timeout:1e3,onDoubleclick:C=>t.remove(a)},{default:O(()=>[ir]),_:2},1032,["onDoubleclick"]),e("button",{class:"button is-small",onClick:C=>t.duplicate(a)},ar,8,lr)])])]),_:1},8,["modelValue","onEnd"])]),t.editEntity?(i(),F($,{key:0,modelValue:t.editEntity,"onUpdate:modelValue":t.updatedAvatar,onCancel:s[5]||(s[5]=S=>t.editEntity=null)},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),e("span",{class:"button is-small",onClick:s[6]||(s[6]=(...S)=>t.addAvatar&&t.addAvatar(...S))},"Add avatar")])):p("",!0)],512)):p("",!0)])}var rr=I(Pd,[["render",dr]]);const ur=V({data:()=>({pass:"",error:"",success:!1}),computed:{canSubmit(){return this.pass&&!this.error}},methods:{async submit(){const s=new URLSearchParams(window.location.search).get("t");this.success=!1,this.error="";const o=await fetch("/api/user/_reset_password",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({pass:this.pass,token:s})});if(o.status===200)this.success=!0;else try{this.error=(await o.json()).reason}catch{this.error="Unknown error"}}}}),cr={class:"center-screen"},mr=e("h1",{class:"title is-6"},"Hyottoko.club",-1),hr={key:0,class:"field has-background-success-light has-text-success-dark"},pr=g(" Password successfully set. Click "),gr=g("here"),fr=g(" to login. "),vr={key:1},$r={key:0,class:"field has-background-danger-light has-text-danger-dark"},yr={class:"field"},br={class:"control has-icons-left"},_r=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-lock"})],-1),wr={class:"field"},kr=["disabled"];function Cr(t,s,o,d,v,f){const c=b("router-link");return i(),l("div",cr,[mr,t.success?(i(),l("div",hr,[pr,k(c,{to:{name:"login"}},{default:O(()=>[gr]),_:1}),fr])):(i(),l("div",vr,[t.error?(i(),l("div",$r,_(t.error),1)):p("",!0),e("div",yr,[e("div",br,[h(e("input",{class:"input is-small",type:"password",placeholder:"New Password","onUpdate:modelValue":s[0]||(s[0]=n=>t.pass=n),onKeyup:[s[1]||(s[1]=n=>t.error=""),s[2]||(s[2]=B((...n)=>t.submit&&t.submit(...n),["enter"]))]},null,544),[[y,t.pass]]),_r])]),e("div",wr,[e("button",{class:"button is-small is-primary",disabled:t.canSubmit?null:!0,onClick:s[3]||(s[3]=(...n)=>t.submit&&t.submit(...n))}," Save Password ",8,kr)])]))])}var Sr=I(ur,[["render",Cr]]);const Vr=V({data:()=>({email:"",error:"",success:!1}),methods:{async submit(){this.success=!1,this.error="";const t=await fetch("/api/user/_request_password_reset",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:this.email})});if(t.status===200)this.success=!0;else try{this.error=(await t.json()).reason}catch{this.error="Unknown error"}}}}),Ir={class:"center-screen"},Ur=e("h1",{class:"title is-6"},"Hyottoko.club",-1),Dr={key:0,class:"field has-background-success-light has-text-success-dark"},Ar=g(" Password-reset mail sent. Click "),Pr=g("here"),Tr=g(" to login. "),Er={key:1},Fr={key:0,class:"field has-background-danger-light has-text-danger-dark"},Mr={class:"field"},zr={class:"control has-icons-left"},Or=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-envelope"})],-1),Nr={class:"field"};function Lr(t,s,o,d,v,f){const c=b("router-link");return i(),l("div",Ir,[Ur,t.success?(i(),l("div",Dr,[Ar,k(c,{to:{name:"login"}},{default:O(()=>[Pr]),_:1}),Tr])):(i(),l("form",Er,[t.error?(i(),l("div",Fr,_(t.error),1)):p("",!0),e("div",Mr,[e("div",zr,[h(e("input",{class:"input is-small",type:"email",placeholder:"Email","onUpdate:modelValue":s[0]||(s[0]=n=>t.email=n),onKeyup:s[1]||(s[1]=n=>t.error="")},null,544),[[y,t.email]]),Or])]),e("div",Nr,[e("span",{class:"button is-small is-primary",onClick:s[2]||(s[2]=(...n)=>t.submit&&t.submit(...n))},"Request Password Reset")])]))])}var Rr=I(Vr,[["render",Lr]]);const jr=V({name:"upload",props:{accept:String,label:{type:String,default:"Upload File"}},data:()=>({uploading:!1,progress:0}),computed:{uploadPercent(){return Math.round(this.progress*100)},buttonText(){return this.uploading?` Uploading (${this.uploadPercent}%)`:this.label?` ${this.label}`:""},progressStyle(){if(!this.uploading)return{};const t=this.uploadPercent,s="rgba(0,255,0, .5)";return{background:`linear-gradient(90deg, ${s} 0%, ${s} ${t}%, transparent ${t}%)`}}},methods:{async upload(t){const s=t.target.files[0];if(!s)return;this.uploading=!0;const o=new FormData;o.append("file",s,s.name);const d=await nt.post("/api/upload",{body:o,onUploadProgress:f=>{this.progress=f.loaded/f.total}});this.uploading=!1;const v=await d.json();this.$emit("uploaded",v)}}}),Jr={class:"upload"},Br=["disabled","accept"],qr={class:"button is-small"};function Wr(t,s,o,d,v,f){return i(),l("label",Jr,[e("input",{type:"file",disabled:t.uploading,style:{display:"none"},onChange:s[0]||(s[0]=(...c)=>t.upload&&t.upload(...c)),accept:t.accept},null,40,Br),e("span",qr,[e("i",{class:A(["fa fa-upload",{"mr-1":t.buttonText}])},null,2),g(_(t.buttonText),1)]),e("span",{class:"progress",style:q(t.progressStyle)},null,4)])}var Hr=I(jr,[["render",Wr],["__scopeId","data-v-4e5c4b12"]]);const Gr=V({props:{modelValue:{required:!0}},emits:["update:modelValue"],data:()=>({v:"",valid:!0}),computed:{classes(){return this.valid?[]:["has-background-danger-light","has-text-danger-dark"]}},mounted(){this.v=`${this.modelValue}`},watch:{v:{handler(t){try{const s=J.doDummyReplacements(t,"0");J.mustParseHumanDuration(s),this.valid=!0}catch{this.valid=!1}this.$emit("update:modelValue",t)}},modelValue:{handler(t){this.v=`${t}`}}}});function Kr(t,s,o,d,v,f){return h((i(),l("input",{class:A(["input is-small spaceinput",t.classes]),"onUpdate:modelValue":s[0]||(s[0]=c=>t.v=c)},null,2)),[[y,t.v]])}var Yr=I(Gr,[["render",Kr]]);const Xr=V({name:"player",props:{src:String,name:String,volume:{required:!0},baseVolume:{default:100}},data:()=>({audio:null,playing:!1}),created:function(){this.load(),this.$watch("src",()=>{this.load()})},computed:{cls(){return this.playing?"fa-stop":"fa-play"}},methods:{toggle(){if(this.playing)this.audio.pause(),this.audio.currentTime=0;else{const t=parseInt(`${this.baseVolume}`,10)/100,s=parseInt(`${this.volume}`,10)/100;this.audio.volume=t*s,this.audio.play()}this.playing=!this.playing},load(){this.audio&&(this.audio.pause(),this.audio=null),this.audio=new Audio("/uploads/"+this.src),this.audio.addEventListener("ended",()=>{this.playing=!1}),this.playing=!1}}});function Qr(t,s,o,d,v,f){return t.src?(i(),l("span",{key:0,class:"player",onClick:s[0]||(s[0]=(...c)=>t.toggle&&t.toggle(...c))},[g(_(t.name)+" ",1),e("i",{class:A(["fa ml-1",t.cls])},null,2)])):p("",!0)}var Zr=I(Xr,[["render",Qr]]);const xr=V({name:"slider",props:{modelValue:{type:Number,required:!0},iconLeft:String,iconRight:String,min:{type:Number,default:0},max:{type:Number,default:100}},data:()=>({curVal:100}),methods:{valChange(){this.$emit("update:modelValue",parseInt(`${this.curVal}`,10))}},created(){this.curVal=this.modelValue}}),tu={class:"columns"},eu={class:"column is-four-fifth"},su={class:"control has-icons-left has-icons-right range slider"},nu=["min","max"],iu={class:"icon is-small is-left"},lu={class:"icon is-small is-right"},ou={class:"column is-one-fifth"};function au(t,s,o,d,v,f){return i(),l("div",tu,[e("div",eu,[e("div",su,[h(e("input",{type:"range",class:"input is-small",min:t.min,max:t.max,"onUpdate:modelValue":[s[0]||(s[0]=c=>t.curVal=c),s[1]||(s[1]=(...c)=>t.valChange&&t.valChange(...c))]},null,8,nu),[[y,t.curVal]]),e("span",iu,[e("i",{class:A(["fa",t.iconLeft])},null,2)]),e("span",lu,[e("i",{class:A(["fa",t.iconRight])},null,2)])])]),e("div",ou,[h(e("input",{type:"number",class:"input is-small","onUpdate:modelValue":[s[2]||(s[2]=c=>t.curVal=c),s[3]||(s[3]=(...c)=>t.valChange&&t.valChange(...c))]},null,512),[[y,t.curVal]])])])}var du=I(xr,[["render",au],["__scopeId","data-v-0799d56c"]]);const ru=V({name:"volume-slider",props:{modelValue:{required:!0}},data:()=>({volume:100}),methods:{valChange(){this.$emit("update:modelValue",this.volume)}},created(){this.volume=parseInt(this.modelValue,10)}});function uu(t,s,o,d,v,f){const c=b("slider");return i(),F(c,{class:"volume-slider",iconLeft:"fa-volume-down",iconRight:"fa-volume-up",min:0,max:100,modelValue:t.volume,"onUpdate:modelValue":[s[0]||(s[0]=n=>t.volume=n),t.valChange]},null,8,["modelValue","onUpdate:modelValue"])}var cu=I(ru,[["render",uu]]);const mu=V({name:"responsive-image",props:{src:String,title:String,height:{type:String,default:"100%"},width:{type:String,default:"100%"}},computed:{style(){return{display:"inline-block",verticalAlign:"text-bottom",backgroundImage:`url(/uploads/${encodeURIComponent(this.src)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",width:this.width,height:this.height}}}}),hu=["title"];function pu(t,s,o,d,v,f){return i(),l("div",{class:"responsive-image",style:q(t.style),title:t.title},null,12,hu)}var gu=I(mu,[["render",pu]]),fu="/assets/hyottoko.30d2bcb9.png";const vu=V({name:"navbar",computed:{user(){var t,s;return((s=(t=this.$me)==null?void 0:t.user)==null?void 0:s.name)||""}},created(){this.$me=N.getMe()},data:()=>({$me:null,linksStart:[{to:{name:"index"},text:"Widgets"},{to:{name:"commands"},text:"Commands"},{to:{name:"variables"},text:"Variables"},{to:{name:"sr"},text:"Song Request"},{to:{name:"speech-to-text"},text:"Speech-To-Text"},{to:{name:"avatar"},text:"Avatar"},{to:{name:"drawcast"},text:"Drawcast"},{to:{name:"settings"},text:"Settings"}],burgerActive:!1}),methods:{toggleBurgerMenu(){this.burgerActive=!this.burgerActive},async onLogoutClick(){const t=await N.logout();if(t.error)throw new Error(t.error);this.$router.push({name:"login"})}}}),$u={class:"navbar",role:"navigation","aria-label":"main navigation"},yu={class:"navbar-brand"},bu=e("img",{src:fu,width:"32",height:"32",alt:"hyottoko.club",class:"flip-horizontal mr-1"},null,-1),_u={class:"greeting"},wu=e("span",{"aria-hidden":"true"},null,-1),ku=e("span",{"aria-hidden":"true"},null,-1),Cu=e("span",{"aria-hidden":"true"},null,-1),Su=[wu,ku,Cu],Vu={class:"navbar-start"},Iu={class:"navbar-end"};function Uu(t,s,o,d,v,f){const c=b("router-link");return i(),l("nav",$u,[e("div",yu,[k(c,{class:"navbar-item",to:{name:"index"}},{default:O(()=>[bu,e("span",_u,"Welcome back, "+_(t.user),1)]),_:1}),e("a",{role:"button",class:A(["navbar-burger",{"is-active":t.burgerActive}]),"aria-label":"menu","aria-expanded":"false","data-target":"navbarBasicExample",onClick:s[0]||(s[0]=(...n)=>t.toggleBurgerMenu&&t.toggleBurgerMenu(...n))},Su,2)]),e("div",{id:"navbarBasicExample",class:A(["navbar-menu",{"is-active":t.burgerActive}])},[e("div",Vu,[(i(!0),l(U,null,D(t.linksStart,(n,m)=>(i(),F(c,{class:"navbar-item",key:m,to:n.to},{default:O(()=>[g(_(n.text),1)]),_:2},1032,["to"]))),128))]),e("div",Iu,[e("a",{class:"navbar-item",onClick:s[1]||(s[1]=(...n)=>t.onLogoutClick&&t.onLogoutClick(...n))},"Logout")])],2)])}var Du=I(vu,[["render",Uu]]);const Au=V({props:{value:{required:!0}},computed:{tag(){try{return J.mustParseHumanDuration(this.value),"span"}catch{return"code"}},humanReadable(){try{return J.humanDuration(J.mustParseHumanDuration(this.value))}catch{return this.value}}}}),Pu={key:0},Tu={key:1};function Eu(t,s,o,d,v,f){return t.tag==="span"?(i(),l("span",Pu,_(t.humanReadable),1)):(i(),l("code",Tu,_(t.humanReadable),1))}var Fu=I(Au,[["render",Eu]]);const Mu=V({emits:["click","doubleclick"],props:{message:{type:String,required:!0},timeout:{type:Number,required:!0}},data:()=>({time:null,timer:null}),computed:{indicatorStyle(){return this.timer===null?{}:{width:`${this.time/this.timeout*100}%`}}},methods:{onClick(t){this.timer===null?(this.$emit("click"),this.time=this.timeout,this.timer=setInterval(()=>{this.time-=10,this.time<=0&&(clearInterval(this.timer),this.timer=null,this.time=null)},10)):(this.$emit("doubleclick"),this.timer&&(clearInterval(this.timer),this.timer=null,this.time=null))}}}),zu={key:0,class:"doubleclick-button-message mr-2 p-1 has-text-danger"};function Ou(t,s,o,d,v,f){return i(),l("button",{class:"doubleclick-button",onClick:s[0]||(s[0]=(...c)=>t.onClick&&t.onClick(...c))},[pt(t.$slots,"default",{},void 0,!0),t.timer?(i(),l("span",zu,[g(_(t.message)+" ",1),e("span",{class:"doubleclick-button-timout-indicator",style:q(t.indicatorStyle)},null,4)])):p("",!0)])}var Nu=I(Mu,[["render",Ou],["__scopeId","data-v-72e9e0bd"]]);const W=(...t)=>console.log("[youtube.js]",...t);let mt=!1;function Lu(){return mt?(W("ytapi ALREADY ready"),Promise.resolve()):new Promise(t=>{const s=document.createElement("script");s.src="https://www.youtube.com/iframe_api",document.head.append(s),window.onYouTubeIframeAPIReady=()=>{mt=!0,W("ytapi ready"),t()}})}function Ru(t){return new Promise(s=>{W("create player on "+t);const o=new YT.Player(t,{playerVars:{iv_load_policy:3,modestbranding:1},events:{onReady:()=>{W("player ready"),s(o)}}})})}async function ju(t){return await Lu(),await Ru(t)}const Ju=V({name:"youtube",props:{visible:{type:Boolean,default:!0}},data:()=>({id:"",yt:null,toplay:null,tovolume:null,tryPlayInterval:null}),created(){this.id=`yt-${Math.floor(Math.random()*99+1)}-${new Date().getTime()}`},methods:{getDuration(){return this.yt?this.yt.getDuration():0},getCurrentTime(){return this.yt?this.yt.getCurrentTime():0},getProgress(){const t=this.getDuration(),s=this.getCurrentTime();return t?s/t:0},stop(){this.yt&&this.yt.stopVideo()},stopTryPlayInterval(){this.tryPlayInterval&&(clearInterval(this.tryPlayInterval),this.tryPlayInterval=null)},tryPlay(){if(this.stopTryPlayInterval(),!this.visible)return;this.yt.playVideo();let t=20;this.tryPlayInterval=setInterval(()=>{if(W("playing",this.playing(),"triesRemaining",t),--t,this.playing()||t<0){W("stopping interval"),this.stopTryPlayInterval();return}this.yt.playVideo()},250)},play(t){this.yt?(this.yt.cueVideoById(t),this.tryPlay()):this.toplay=t},pause(){this.yt&&this.yt.pauseVideo()},unpause(){this.yt&&this.tryPlay()},setVolume(t){this.yt?this.yt.setVolume(t):this.tovolume=t},setLoop(t){this.loop=t},playing(){return this.yt&&this.yt.getPlayerState()===1}},async mounted(){this.yt=await ju(this.id),this.tovolume!==null&&this.yt.setVolume(this.tovolume),this.toplay!==null&&(W("trying to play.."),this.play(this.toplay)),this.yt.addEventListener("onStateChange",t=>{t.data===YT.PlayerState.CUED?this.tryPlay():t.data===YT.PlayerState.ENDED&&(this.loop?this.tryPlay():this.$emit("ended"))})}}),Bu=["id"];function qu(t,s,o,d,v,f){return i(),l("div",{id:t.id},null,8,Bu)}var Wu=I(Ju,[["render",qu]]);const Hu=V({props:{modelValue:{type:Object,required:!0},mode:{type:String,required:!0},globalVariables:{type:Array,required:!0},baseVolume:{default:100}},emits:["update:modelValue","cancel"],data:()=>({item:null,newtrigger:"command",variableChangeFocusIdx:-1,dictLangs:[{value:"ja",flag:"\u{1F1EF}\u{1F1F5}",title:"Japanese"},{value:"ru",flag:"\u{1F1F7}\u{1F1FA}",title:"Russian"},{value:"de",flag:"\u{1F1E9}\u{1F1EA}",title:"German"},{value:"es",flag:"\u{1F1EA}\u{1F1F8}",title:"Spanish"},{value:"fr",flag:"\u{1F1EB}\u{1F1F7}",title:"French"},{value:"it",flag:"\u{1F1EE}\u{1F1F9}",title:"Italian"},{value:"pt",flag:"\u{1F1F5}\u{1F1F9}/\u{1F1E7}\u{1F1F7}",title:"Portuguese"}]}),mounted(){this.item=JSON.parse(JSON.stringify(this.modelValue)),this.$nextTick(()=>{this.$el.querySelector('input[type="text"]').focus()})},watch:{modelValue:{handler(t){this.item=JSON.parse(JSON.stringify(t))}}},methods:{addtxt(){if(!this.item){console.warn("addtxt: this.item not initialized");return}this.item.data.text.push(it())},addtrigger(){if(!this.item){console.warn("addtrigger: this.item not initialized");return}this.item.triggers.push(ut(this.newtrigger))},onAddVariableChange(){if(!this.item){console.warn("onAddVariableChange: this.item not initialized");return}this.item.variableChanges.push({name:"",change:"set",value:""})},rmVariableChange(t){if(!this.item){console.warn("rmVariableChange: this.item not initialized");return}this.item.variableChanges=this.item.variableChanges.filter((s,o)=>o!==t)},onAddVariable(){if(!this.item){console.warn("onAddVariable: this.item not initialized");return}this.item.variables.push({name:"",value:""})},rmVariable(t){if(!this.item){console.warn("rmVariable: this.item not initialized");return}this.item.variables=this.item.variables.filter((s,o)=>o!==t)},onSaveClick(){this.$emit("update:modelValue",this.item)},onCancelClick(){this.$emit("cancel")},onCloseClick(){this.$emit("cancel")},onOverlayClick(){this.$emit("cancel")},mediaSndUploaded(t){if(!this.item){console.warn("mediaSndUploaded: this.item not initialized");return}this.item.data.sound.filename=t.originalname,this.item.data.sound.file=t.filename},mediaImgUploaded(t){if(!this.item){console.warn("mediaImgUploaded: this.item not initialized");return}this.item.data.image.filename=t.originalname,this.item.data.image.file=t.filename},rmtxt(t){if(!this.item){console.warn("rmtxt: this.item not initialized");return}this.item.data.text=this.item.data.text.filter((s,o)=>o!==t)},rmtrigger(t){if(!this.item){console.warn("rmtrigger: this.item not initialized");return}this.item.triggers=this.item.triggers.filter((s,o)=>o!==t)},autocompletableVariables(t){if(!this.item){console.warn("autocompletableVariables: this.item not initialized");return}const s=this.item.variables.slice().map(o=>({var:o,type:"local"}));return this.globalVariables.forEach(o=>{s.find(d=>d.var.name===o.name)||s.push({var:o,type:"global"})}),s.filter(o=>o.var.name.startsWith(t)).slice(0,10)},onVarChangeInputBlur(){setTimeout(()=>{this.variableChangeFocusIdx=-1},50)}},computed:{valid(){if(!this.item)return!1;for(const t of this.item.triggers)if(t.type==="command"){if(!t.data.command)return!1}else if(t.type==="timer"){try{J.mustParseHumanDuration(t.data.minInterval)}catch{return!1}const s=parseInt(`${t.data.minLines}`,10);if(isNaN(s))return!1}if(this.item.action==="text"){for(const t of this.item.data.text)if(t==="")return!1}return!0},title(){if(!this.item)return"";const t={create:"Create new ",edit:"Edit "},s={dict_lookup:"dictionary lookup",madochan_createword:"madochan",chatters:"chatters command",media:"media command",countdown:"countdown",text:"command"};return`${t[this.mode]}${s[this.item.action]}`}}}),w=t=>(G("data-v-50d6ccaa"),t=t(),K(),t),Gu={key:0,class:"modal is-active"},Ku={class:"modal-card"},Yu={class:"modal-card-head"},Xu={class:"modal-card-title"},Qu={class:"modal-card-body"},Zu={class:"table is-striped"},xu=w(()=>e("td",null,"Triggers:",-1)),tc={key:0,class:"field has-addons"},ec={class:"control has-icons-left"},sc=["onUpdate:modelValue"],nc=w(()=>e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-comments-o"})],-1)),ic={class:"control"},lc=["disabled","onClick"],oc=w(()=>e("i",{class:"fa fa-remove"},null,-1)),ac=[oc],dc={key:1,class:"field has-addons"},rc={class:"control has-icons-left"},uc=["onUpdate:modelValue"],cc=w(()=>e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-bullseye"})],-1)),mc={class:"control"},hc=["disabled","onClick"],pc=w(()=>e("i",{class:"fa fa-remove"},null,-1)),gc=[pc],fc={key:2,class:"timer-trigger"},vc={class:"control"},$c=["disabled","onClick"],yc=w(()=>e("i",{class:"fa fa-remove"},null,-1)),bc=[yc],_c={class:"columns"},wc=w(()=>e("div",{class:"column is-one-third"},[e("label",null,"Min. Lines")],-1)),kc={class:"column is-two-third"},Cc={class:"control has-icons-left"},Sc=["onUpdate:modelValue"],Vc=w(()=>e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-comments-o"})],-1)),Ic={class:"columns"},Uc=w(()=>e("div",{class:"column is-one-third"},[e("label",null,"Min. Interval")],-1)),Dc={class:"column is-two-third"},Ac={class:"control has-icons-left has-icons-right"},Pc=w(()=>e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-hourglass"})],-1)),Tc=w(()=>e("p",{class:"help"}," Command will be triggered when at least min. lines chat messages arrived AND time interval have passed. ",-1)),Ec={class:"field has-addons mr-1"},Fc={class:"control has-icons-left"},Mc={key:0,class:"select is-small"},zc=w(()=>e("option",{value:"command"},"Command",-1)),Oc=w(()=>e("option",{value:"reward_redemption"}," Reward Redemption ",-1)),Nc=w(()=>e("option",{value:"timer"},"Timer",-1)),Lc=[zc,Oc,Nc],Rc=w(()=>e("i",{class:"fa fa-plus mr-1"},null,-1)),jc=g(" Add "),Jc=[Rc,jc],Bc={key:0},qc=w(()=>e("td",null,"Language:",-1)),Wc=["onClick","title"],Hc=w(()=>e("code",null,"$args(0)",-1)),Gc=[Hc],Kc={key:1},Yc=w(()=>e("td",null,"Phrase:",-1)),Xc=w(()=>e("code",null,"$args(1:)",-1)),Qc=[Xc],Zc={key:2},xc=w(()=>e("td",null,"Response:",-1)),tm=w(()=>e("td",null,[e("div",{class:"help"},[g(" Outputs the translation for the input phrase. The translation is always from/to english. "),e("br"),g(" To let the user decide on the language use "),e("code",null,"$args(0)"),g(" as language, and "),e("code",null,"$args(1:)"),g(" as phrase. "),e("br"),g(" If phrase is left empty, all arguments to the command will be used as the phrase. ")])],-1)),em=[xc,tm],sm={key:3},nm=w(()=>e("td",null,"Response:",-1)),im=w(()=>e("td",null,"Creates a word for a definition.",-1)),lm=[nm,im],om={key:4},am=w(()=>e("td",null,"Model:",-1)),dm={class:"control"},rm=w(()=>e("div",{class:"help"},[g(" For possible values refer to "),e("a",{href:"https://madochan.hyottoko.club/",target:"_blank"},"madochan")],-1)),um={key:5},cm=w(()=>e("td",null,"Weirdness:",-1)),mm={class:"control"},hm=w(()=>e("div",{class:"help"},[g(" For possible values refer to "),e("a",{href:"https://madochan.hyottoko.club/",target:"_blank"},"madochan")],-1)),pm={key:6},gm=w(()=>e("td",null,"Response:",-1)),fm=w(()=>e("td",null,"Outputs the people who chatted during the stream.",-1)),vm=[gm,fm],$m={key:7},ym=w(()=>e("td",null,"Response:",-1)),bm=["onUpdate:modelValue"],_m=["disabled","onClick"],wm=w(()=>e("i",{class:"fa fa-remove"},null,-1)),km=[wm],Cm={class:"field"},Sm=w(()=>e("i",{class:"fa fa-plus mr-1"},null,-1)),Vm=g(" Add response "),Im=[Sm,Vm],Um=w(()=>e("div",null,[e("p",{class:"help"}," If multiple responses exist, a random one will be used when the command is triggered. ")],-1)),Dm={key:8},Am=w(()=>e("td",null,"Image:",-1)),Pm=w(()=>e("i",{class:"fa fa-remove mr-1"},null,-1)),Tm=g(" Remove "),Em=[Pm,Tm],Fm={key:2},Mm={key:9},zm=w(()=>e("td",null,"Sound:",-1)),Om=w(()=>e("i",{class:"fa fa-remove mr-1"},null,-1)),Nm=g(" Remove "),Lm=[Om,Nm],Rm={key:3},jm={key:10},Jm=w(()=>e("td",null,"Duration:",-1)),Bm={class:"control has-icons-left"},qm=w(()=>e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-hourglass"})],-1)),Wm={key:11},Hm=w(()=>e("td",null,"Settings",-1)),Gm=w(()=>e("td",null,"Variables:",-1)),Km={key:0},Ym=w(()=>e("thead",null,[e("tr",null,[e("td",null,"Name"),e("td",null,"Value")])],-1)),Xm=["onUpdate:modelValue"],Qm=["onUpdate:modelValue"],Zm=["onClick"],xm=w(()=>e("i",{class:"fa fa-remove"},null,-1)),th=[xm],eh=w(()=>e("div",{class:"help"},[g(" Variables can be used from the command with "),e("code",null,"$var(variable_name)"),g(". If the referenced variable is not defined here, "),e("a",{href:"/variables/",target:"_blank"},"global variables"),g(" are used. ")],-1)),sh=w(()=>e("td",null,"Variable changes:",-1)),nh={key:0},ih=w(()=>e("thead",null,[e("tr",null,[e("td",null,"Name"),e("td",null,"Change"),e("td",null,"Value"),e("td")])],-1)),lh={class:"dropdown is-active is-up"},oh={class:"dropdown-trigger"},ah=["onUpdate:modelValue","onFocus"],dh={key:0,class:"dropdown-menu",id:"dropdown-menu",role:"menu"},rh={class:"dropdown-content"},uh=["onClick"],ch=g(") "),mh={class:"select is-small"},hh=["onUpdate:modelValue"],ph=w(()=>e("option",{value:"set"},"set",-1)),gh=w(()=>e("option",{value:"increase_by"},"increase by",-1)),fh=w(()=>e("option",{value:"decrease_by"},"decrease by",-1)),vh=[ph,gh,fh],$h=["onUpdate:modelValue"],yh=["onClick"],bh=w(()=>e("i",{class:"fa fa-remove"},null,-1)),_h=[bh],wh=w(()=>e("div",{class:"help"}," Variable changes are performed when the command is executed, before anything else. ",-1)),kh=w(()=>e("td",null,"Permissions:",-1)),Ch=g(" Broadcaster "),Sh=g(" Moderators "),Vh=g(" Subscribers "),Ih={class:"modal-card-foot"},Uh=["disabled"];function Dh(t,s,o,d,v,f){const c=b("duration-input"),n=b("responsive-image"),m=b("upload"),u=b("player"),$=b("volume-slider"),S=b("countdown-editor");return t.item?(i(),l("div",Gu,[e("div",{class:"modal-background",onClick:s[0]||(s[0]=(...a)=>t.onOverlayClick&&t.onOverlayClick(...a))}),e("div",Ku,[e("header",Yu,[e("p",Xu,_(t.title),1),e("button",{class:"delete","aria-label":"close",onClick:s[1]||(s[1]=(...a)=>t.onCloseClick&&t.onCloseClick(...a))})]),e("section",Qu,[e("table",Zu,[e("tbody",null,[e("tr",null,[xu,e("td",null,[(i(!0),l(U,null,D(t.item.triggers,(a,C)=>(i(),l("div",{key:C,class:"spacerow"},[t.item.triggers[C].type==="command"?(i(),l("div",tc,[e("div",ec,[h(e("input",{class:A(["input is-small",{"has-background-danger-light":!t.item.triggers[C].data.command,"has-text-danger-dark":!t.item.triggers[C].data.command}]),type:"text","onUpdate:modelValue":r=>t.item.triggers[C].data.command=r},null,10,sc),[[y,t.item.triggers[C].data.command]]),nc]),e("div",ic,[e("button",{class:"button is-small",disabled:t.item.triggers.length<=1,onClick:r=>t.rmtrigger(C)},ac,8,lc)])])):p("",!0),t.item.triggers[C].type==="reward_redemption"?(i(),l("div",dc,[e("div",rc,[h(e("input",{class:A(["input is-small",{"has-background-danger-light":!t.item.triggers[C].data.command,"has-text-danger-dark":!t.item.triggers[C].data.command}]),type:"text","onUpdate:modelValue":r=>t.item.triggers[C].data.command=r},null,10,uc),[[y,t.item.triggers[C].data.command]]),cc]),e("div",mc,[e("button",{class:"button is-small",disabled:t.item.triggers.length<=1,onClick:r=>t.rmtrigger(C)},gc,8,hc)])])):p("",!0),t.item.triggers[C].type==="timer"?(i(),l("div",fc,[e("div",vc,[e("button",{class:"button is-small",disabled:t.item.triggers.length<=1,onClick:r=>t.rmtrigger(C)},bc,8,$c)]),e("div",_c,[wc,e("div",kc,[e("div",Cc,[h(e("input",{class:"input is-small spaceinput","onUpdate:modelValue":r=>t.item.triggers[C].data.minLines=r},null,8,Sc),[[y,t.item.triggers[C].data.minLines]]),Vc])])]),e("div",Ic,[Uc,e("div",Dc,[e("div",Ac,[k(c,{modelValue:t.item.triggers[C].data.minInterval,"onUpdate:modelValue":r=>t.item.triggers[C].data.minInterval=r},null,8,["modelValue","onUpdate:modelValue"]),Pc])])]),Tc])):p("",!0)]))),128)),e("div",Ec,[e("div",Fc,[t.item.action!=="dict_lookup"?(i(),l("div",Mc,[h(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.newtrigger=a)},Lc,512),[[tt,t.newtrigger]])])):p("",!0)]),e("button",{class:"button is-small",onClick:s[3]||(s[3]=a=>t.addtrigger())},Jc)])])]),t.item.action==="dict_lookup"?(i(),l("tr",Bc,[qc,e("td",null,[h(e("input",{class:"input is-small spaceinput mb-1","onUpdate:modelValue":s[4]||(s[4]=a=>t.item.data.lang=a)},null,512),[[y,t.item.data.lang]]),(i(!0),l(U,null,D(t.dictLangs,(a,C)=>(i(),l("span",{key:C,class:"button is-small mr-1",onClick:r=>t.item.data.lang=a.value,title:a.title},_(a.flag),9,Wc))),128)),e("span",{class:"button is-small mr-1",onClick:s[5]||(s[5]=a=>t.item.data.lang="$args(0)")},Gc)])])):p("",!0),t.item.action==="dict_lookup"?(i(),l("tr",Kc,[Yc,e("td",null,[h(e("input",{class:"input is-small spaceinput mb-1","onUpdate:modelValue":s[6]||(s[6]=a=>t.item.data.phrase=a)},null,512),[[y,t.item.data.phrase]]),e("span",{class:"button is-small mr-1",onClick:s[7]||(s[7]=a=>t.item.data.phrase="")},"All args"),e("span",{class:"button is-small mr-1",onClick:s[8]||(s[8]=a=>t.item.data.phrase="$args(1:)")},Qc)])])):p("",!0),t.item.action==="dict_lookup"?(i(),l("tr",Zc,em)):p("",!0),t.item.action==="madochan_createword"?(i(),l("tr",sm,lm)):p("",!0),t.item.action==="madochan_createword"?(i(),l("tr",om,[am,e("td",null,[e("div",dm,[h(e("input",{class:"input is-small spaceinput","onUpdate:modelValue":s[9]||(s[9]=a=>t.item.data.model=a)},null,512),[[y,t.item.data.model]])]),rm])])):p("",!0),t.item.action==="madochan_createword"?(i(),l("tr",um,[cm,e("td",null,[e("div",mm,[h(e("input",{class:"input is-small spaceinput","onUpdate:modelValue":s[10]||(s[10]=a=>t.item.data.weirdness=a)},null,512),[[y,t.item.data.weirdness]])]),hm])])):p("",!0),t.item.action==="chatters"?(i(),l("tr",pm,vm)):p("",!0),t.item.action==="text"?(i(),l("tr",$m,[ym,e("td",null,[(i(!0),l(U,null,D(t.item.data.text,(a,C)=>(i(),l("div",{key:C,class:"field textarea-holder"},[h(e("textarea",{class:A(["textarea",{"has-background-danger-light":!t.item.data.text[C],"has-text-danger-dark":!t.item.data.text[C]}]),type:"text","onUpdate:modelValue":r=>t.item.data.text[C]=r},null,10,bm),[[y,t.item.data.text[C]]]),e("button",{class:"button is-small",disabled:t.item.data.text.length<=1,onClick:r=>t.rmtxt(C)},km,8,_m)]))),128)),e("div",Cm,[e("button",{class:"button is-small",onClick:s[11]||(s[11]=(...a)=>t.addtxt&&t.addtxt(...a))},Im)]),Um])])):p("",!0),t.item.action==="media"?(i(),l("tr",Dm,[Am,e("td",null,[t.item.data.image.file?(i(),F(n,{key:0,src:t.item.data.image.file,title:t.item.data.image.filename,width:"100%",height:"90px",style:{display:"block"}},null,8,["src","title"])):p("",!0),t.item.data.image.file?(i(),l("button",{key:1,class:"button is-small",onClick:s[12]||(s[12]=a=>t.item.data.image.file=null)},Em)):p("",!0),t.item.data.image.file?(i(),l("br",Fm)):p("",!0),k(m,{onUploaded:t.mediaImgUploaded,accept:"image/*",label:"Upload Image",class:A({"mt-1":t.item.data.image.file})},null,8,["onUploaded","class"])])])):p("",!0),t.item.action==="media"?(i(),l("tr",Mm,[zm,e("td",null,[t.item.data.sound.file?(i(),F(u,{key:0,src:t.item.data.sound.file,name:t.item.data.sound.filename,volume:t.item.data.sound.volume,baseVolume:t.baseVolume,class:"button is-small"},null,8,["src","name","volume","baseVolume"])):p("",!0),t.item.data.sound.file?(i(),F($,{key:1,modelValue:t.item.data.sound.volume,"onUpdate:modelValue":s[13]||(s[13]=a=>t.item.data.sound.volume=a)},null,8,["modelValue"])):p("",!0),t.item.data.sound.file?(i(),l("button",{key:2,class:"button is-small",onClick:s[14]||(s[14]=a=>t.item.data.sound.file=null)},Lm)):p("",!0),t.item.data.sound.file?(i(),l("br",Rm)):p("",!0),k(m,{onUploaded:t.mediaSndUploaded,accept:"audio/*",label:"Upload Sound",class:A({"mt-1":t.item.data.sound.file})},null,8,["onUploaded","class"])])])):p("",!0),t.item.action==="media"?(i(),l("tr",jm,[Jm,e("td",null,[e("div",Bm,[k(c,{modelValue:t.item.data.minDurationMs,"onUpdate:modelValue":s[15]||(s[15]=a=>t.item.data.minDurationMs=a)},null,8,["modelValue"]),qm])])])):p("",!0),t.item.action==="countdown"?(i(),l("tr",Wm,[Hm,e("td",null,[k(S,{modelValue:t.item.data,"onUpdate:modelValue":s[16]||(s[16]=a=>t.item.data=a),baseVolume:t.baseVolume},null,8,["modelValue","baseVolume"])])])):p("",!0),e("tr",null,[Gm,e("td",null,[t.item.variables.length>0?(i(),l("table",Km,[Ym,e("tbody",null,[(i(!0),l(U,null,D(t.item.variables,(a,C)=>(i(),l("tr",{key:C},[e("td",null,[h(e("input",{type:"text",class:"input is-small","onUpdate:modelValue":r=>a.name=r},null,8,Xm),[[y,a.name]])]),e("td",null,[h(e("input",{type:"text",class:"input is-small","onUpdate:modelValue":r=>a.value=r},null,8,Qm),[[y,a.value]])]),e("td",null,[e("button",{class:"button is-small",onClick:r=>t.rmVariable(C)},th,8,Zm)])]))),128))])])):p("",!0),e("span",{class:"button is-small",onClick:s[17]||(s[17]=(...a)=>t.onAddVariable&&t.onAddVariable(...a))},"Add Variable"),eh])]),e("tr",null,[sh,e("td",null,[t.item.variableChanges.length>0?(i(),l("table",nh,[ih,e("tbody",null,[(i(!0),l(U,null,D(t.item.variableChanges,(a,C)=>(i(),l("tr",{key:C},[e("td",null,[e("div",lh,[e("div",oh,[h(e("input",{type:"text",class:"input is-small","onUpdate:modelValue":r=>a.name=r,onFocus:r=>t.variableChangeFocusIdx=C,onBlur:s[18]||(s[18]=(...r)=>t.onVarChangeInputBlur&&t.onVarChangeInputBlur(...r))},null,40,ah),[[y,a.name]])]),t.variableChangeFocusIdx===C?(i(),l("div",dh,[e("div",rh,[(i(!0),l(U,null,D(t.autocompletableVariables(a.name),(r,j)=>(i(),l("a",{class:"dropdown-item",key:j,onClick:E=>a.name=r.var.name},[g(_(r.var.name)+" ("+_(r.type)+", ",1),e("code",null,_(r.var.value),1),ch],8,uh))),128))])])):p("",!0)])]),e("td",null,[e("div",mh,[h(e("select",{"onUpdate:modelValue":r=>a.change=r},vh,8,hh),[[tt,a.change]])])]),e("td",null,[h(e("input",{type:"text",class:"input is-small","onUpdate:modelValue":r=>a.value=r},null,8,$h),[[y,a.value]])]),e("td",null,[e("button",{class:"button is-small",onClick:r=>t.rmVariableChange(C)},_h,8,yh)])]))),128))])])):p("",!0),e("span",{class:"button is-small",onClick:s[19]||(s[19]=(...a)=>t.onAddVariableChange&&t.onAddVariableChange(...a))},"Add Variable Change"),wh])]),e("tr",null,[kh,e("td",null,[e("label",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[20]||(s[20]=a=>t.item.restrict_to=a),value:"broadcaster"},null,512),[[M,t.item.restrict_to]]),Ch]),e("label",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[21]||(s[21]=a=>t.item.restrict_to=a),value:"mod"},null,512),[[M,t.item.restrict_to]]),Sh]),e("label",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[22]||(s[22]=a=>t.item.restrict_to=a),value:"sub"},null,512),[[M,t.item.restrict_to]]),Vh])])])])])]),e("footer",Ih,[e("button",{class:"button is-small is-primary",disabled:!t.valid,onClick:s[23]||(s[23]=(...a)=>t.onSaveClick&&t.onSaveClick(...a))}," Save changes ",8,Uh),e("button",{class:"button is-small",onClick:s[24]||(s[24]=(...a)=>t.onCancelClick&&t.onCancelClick(...a))},"Cancel")])])])):p("",!0)}var Ah=I(Hu,[["render",Dh],["__scopeId","data-v-50d6ccaa"]]);const Ph=V({name:"countdown-edit",props:{baseVolume:{default:100},modelValue:{type:Object,required:!0}},data:()=>({countdown:{type:"manual",actions:[],steps:3,interval:1e3,intro:"",outro:""}}),methods:{dragEnd(t){this.countdown.actions=J.arrayMove(this.countdown.actions,t.oldIndex,t.newIndex)},onAddDelay(){this.countdown.actions.push({type:"delay",value:"1s"})},onAddText(){this.countdown.actions.push({type:"text",value:it()})},onAddMedia(){this.countdown.actions.push({type:"media",value:rt()})},rmaction(t){this.countdown.actions=this.countdown.actions.filter((s,o)=>o!==t)},mediaSndUploaded(t,s){this.countdown.actions[t].value.sound.filename=s.originalname,this.countdown.actions[t].value.sound.file=s.filename},mediaImgUploaded(t,s){this.countdown.actions[t].value.image.filename=s.originalname,this.countdown.actions[t].value.image.file=s.filename}},created(){this.countdown.type=this.modelValue.type||"auto",this.countdown.actions=this.modelValue.actions||[],this.countdown.steps=this.modelValue.steps,this.countdown.interval=this.modelValue.interval,this.countdown.intro=this.modelValue.intro,this.countdown.outro=this.modelValue.outro,this.$watch("countdown",()=>{this.$emit("update:modelValue",{type:this.countdown.type,actions:this.countdown.actions,steps:this.countdown.steps,interval:this.countdown.interval,intro:this.countdown.intro,outro:this.countdown.outro})},{deep:!0})}}),Th={class:"control"},Eh={class:"radio"},Fh=g(" Manual "),Mh={class:"radio"},zh=g(" Auto "),Oh={key:0},Nh={class:"spacerow"},Lh=e("label",{class:"spacelabel"},"Steps ",-1),Rh={class:"spacerow"},jh=e("label",{class:"spacelabel"},"Interval ",-1),Jh={class:"spacerow"},Bh=e("label",{class:"spacelabel"},"Intro ",-1),qh={class:"spacerow"},Wh=e("label",{class:"spacelabel"},"Outro ",-1),Hh={key:1},Gh={class:"field has-addons mr-1"},Kh=e("span",{class:"handle p-2"},[e("i",{class:"fa fa-arrows"})],-1),Yh={key:0,class:"control has-icons-left"},Xh=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-hourglass"})],-1),Qh={key:1,class:"control has-icons-left"},Zh=["onUpdate:modelValue"],xh=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-comments-o"})],-1),tp={key:2,class:"control has-icons-left"},ep=e("td",null,"Image:",-1),sp=["onClick"],np=e("i",{class:"fa fa-remove mr-1"},null,-1),ip=g(" Remove "),lp=[np,ip],op={key:2},ap=e("td",null,"Sound:",-1),dp=["onClick"],rp=e("i",{class:"fa fa-remove mr-1"},null,-1),up=g(" Remove "),cp=[rp,up],mp={key:3},hp=e("td",null,"Duration:",-1),pp={class:"control has-icons-left"},gp=e("span",{class:"icon is-small is-left"},[e("i",{class:"fa fa-hourglass"})],-1),fp={class:"control"},vp=["onClick"],$p=e("i",{class:"fa fa-remove"},null,-1),yp=[$p],bp=e("i",{class:"fa fa-hourglass mr-1"},null,-1),_p=g(" Add Delay "),wp=[bp,_p],kp=e("i",{class:"fa fa-comments-o mr-1"},null,-1),Cp=g(" Add Chat "),Sp=[kp,Cp],Vp=e("i",{class:"fa fa-picture-o mr-1"},null,-1),Ip=g(" Add Media "),Up=[Vp,Ip];function Dp(t,s,o,d,v,f){const c=b("duration-input"),n=b("responsive-image"),m=b("upload"),u=b("player"),$=b("volume-slider"),S=b("draggable");return i(),l("div",null,[e("div",Th,[e("label",Eh,[h(e("input",{type:"radio",value:"manual","onUpdate:modelValue":s[0]||(s[0]=a=>t.countdown.type=a)},null,512),[[ot,t.countdown.type]]),Fh]),e("label",Mh,[h(e("input",{type:"radio",value:"auto","onUpdate:modelValue":s[1]||(s[1]=a=>t.countdown.type=a)},null,512),[[ot,t.countdown.type]]),zh])]),t.countdown.type==="auto"?(i(),l("div",Oh,[e("div",Nh,[Lh,h(e("input",{class:"input is-small spaceinput","onUpdate:modelValue":s[2]||(s[2]=a=>t.countdown.steps=a)},null,512),[[y,t.countdown.steps]])]),e("div",Rh,[jh,k(c,{modelValue:t.countdown.interval,"onUpdate:modelValue":s[3]||(s[3]=a=>t.countdown.interval=a)},null,8,["modelValue"])]),e("div",Jh,[Bh,h(e("input",{class:"input is-small spaceinput","onUpdate:modelValue":s[4]||(s[4]=a=>t.countdown.intro=a)},null,512),[[y,t.countdown.intro]])]),e("div",qh,[Wh,h(e("input",{class:"input is-small spaceinput","onUpdate:modelValue":s[5]||(s[5]=a=>t.countdown.outro=a)},null,512),[[y,t.countdown.outro]])])])):(i(),l("div",Hh,[k(S,{modelValue:t.countdown.actions,onEnd:t.dragEnd,handle:".handle","item-key":"id"},{item:O(({element:a,index:C})=>[e("div",Gh,[Kh,a.type==="delay"?(i(),l("div",Yh,[k(c,{modelValue:a.value,"onUpdate:modelValue":r=>a.value=r},null,8,["modelValue","onUpdate:modelValue"]),Xh])):a.type==="text"?(i(),l("div",Qh,[h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":r=>a.value=r},null,8,Zh),[[y,a.value]]),xh])):a.type==="media"?(i(),l("div",tp,[e("table",null,[e("tr",null,[ep,e("td",null,[a.value.image.file?(i(),F(n,{key:0,src:a.value.image.file,title:a.value.image.filename,width:"100%",height:"90px",style:{display:"block"}},null,8,["src","title"])):p("",!0),a.value.image.file?(i(),l("button",{key:1,class:"button is-small",onClick:r=>a.value.image.file=null},lp,8,sp)):p("",!0),a.value.image.file?(i(),l("br",op)):p("",!0),k(m,{onUploaded:r=>t.mediaImgUploaded(C,r),accept:"image/*",label:"Upload Image",class:A({"mt-1":a.value.image.file})},null,8,["onUploaded","class"])])]),e("tr",null,[ap,e("td",null,[a.value.sound.file?(i(),F(u,{key:0,src:a.value.sound.file,name:a.value.sound.filename,volume:a.value.sound.volume,baseVolume:t.baseVolume,class:"button is-small"},null,8,["src","name","volume","baseVolume"])):p("",!0),a.value.sound.file?(i(),F($,{key:1,modelValue:a.value.sound.volume,"onUpdate:modelValue":r=>a.value.sound.volume=r},null,8,["modelValue","onUpdate:modelValue"])):p("",!0),a.value.sound.file?(i(),l("button",{key:2,class:"button is-small",onClick:r=>a.value.sound.file=null},cp,8,dp)):p("",!0),a.value.sound.file?(i(),l("br",mp)):p("",!0),k(m,{onUploaded:r=>t.mediaSndUploaded(C,r),accept:"audio/*",label:"Upload Sound",class:A({"mt-1":a.value.sound.file})},null,8,["onUploaded","class"])])]),e("tr",null,[hp,e("td",null,[e("div",pp,[k(c,{modelValue:a.value.minDurationMs,"onUpdate:modelValue":r=>a.value.minDurationMs=r},null,8,["modelValue","onUpdate:modelValue"]),gp])])])])])):p("",!0),e("div",fp,[e("button",{class:"button is-small",onClick:r=>t.rmaction(C)},yp,8,vp)])])]),_:1},8,["modelValue","onEnd"]),e("button",{class:"button is-small",onClick:s[6]||(s[6]=(...a)=>t.onAddDelay&&t.onAddDelay(...a))},wp),e("button",{class:"button is-small",onClick:s[7]||(s[7]=(...a)=>t.onAddText&&t.onAddText(...a))},Sp),e("button",{class:"button is-small",onClick:s[8]||(s[8]=(...a)=>t.onAddMedia&&t.onAddMedia(...a))},Up)]))])}var Ap=I(Ph,[["render",Dp]]);const Pp=V({setup(){}}),Tp={class:"table is-striped"},Ep=e("thead",null,[e("tr",null,[e("th",null,"Chat command"),e("th",null,"Viewer"),e("th",null,"Mod"),e("th",null,"Explanation")])],-1),Fp=e("tbody",null,[e("tr",null,[e("td",null,[e("code",null,"!sr <SEARCH>")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,[g(" Search for "),e("code",null,"<SEARCH>"),g(" at youtube (by id or by title) and queue the first result in the playlist (after the first found batch of unplayed songs)."),e("br"),g(" This only executes if "),e("code",null,"<SEARCH>"),g(" does not match one of the commands below. ")])]),e("tr",null,[e("td",null,[e("code",null,"!sr undo")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Remove the song that was last added by oneself.")]),e("tr",null,[e("td",null,[e("code",null,"!sr current")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Show what song is currently playing")]),e("tr",null,[e("td",null,[e("code",null,"!sr good")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Vote the current song up")]),e("tr",null,[e("td",null,[e("code",null,"!sr bad")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Vote the current song down")]),e("tr",null,[e("td",null,[e("code",null,"!sr stats")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Show stats about the playlist")]),e("tr",null,[e("td",null,[e("code",null,"!sr stat")]),e("td",{class:"has-text-success"},"\u2714"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Alias for stats")]),e("tr",null,[e("td",null,[e("code",null,"!sr rm")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Remove the current song from the playlist")]),e("tr",null,[e("td",null,[e("code",null,"!sr next")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Skip to the next song")]),e("tr",null,[e("td",null,[e("code",null,"!sr prev")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Skip to the previous song")]),e("tr",null,[e("td",null,[e("code",null,"!sr skip")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Alias for next")]),e("tr",null,[e("td",null,[e("code",null,"!sr jumptonew")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Jump to the next unplayed song")]),e("tr",null,[e("td",null,[e("code",null,"!sr shuffle")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,[g(" Shuffle the playlist (current song unaffected). "),e("br"),g(" Non-played and played songs will be shuffled separately and non-played songs will be put after currently playing song. ")])]),e("tr",null,[e("td",null,[e("code",null,"!sr resetStats")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Reset all statistics of all songs")]),e("tr",null,[e("td",null,[e("code",null,"!sr clear")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Clear the playlist")]),e("tr",null,[e("td",null,[e("code",null,"!sr pause")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Pause currently playing song")]),e("tr",null,[e("td",null,[e("code",null,"!sr unpause")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Unpause currently paused song")]),e("tr",null,[e("td",null,[e("code",null,"!sr loop")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Loop the current song")]),e("tr",null,[e("td",null,[e("code",null,"!sr noloop")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Stop looping the current song")]),e("tr",null,[e("td",null,[e("code",null,"!sr unloop")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Alias for noloop")]),e("tr",null,[e("td",null,[e("code",null,"!sr hidevideo")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Hide video for current song")]),e("tr",null,[e("td",null,[e("code",null,"!sr showvideo")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,"Show video for current song")]),e("tr",null,[e("td",null,[e("code",null,"!sr tag <TAG>")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,[g("Add tag "),e("code",null,"<TAG>"),g(" to the current song")])]),e("tr",null,[e("td",null,[e("code",null,"!sr rmtag <TAG>")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,[g("Remove tag "),e("code",null,"<TAG>"),g(" from the current song")])]),e("tr",null,[e("td",null,[e("code",null,"!sr filter [<TAG>]")]),e("td",{class:"has-text-danger"},"\u2716"),e("td",{class:"has-text-success"},"\u2714"),e("td",null,[g(" Play only songs with the given tag "),e("code",null,"<TAG>"),g(". If no tag is given, play all songs. ")])])],-1),Mp=[Ep,Fp];function zp(t,s,o,d,v,f){return i(),l("table",Tp,Mp)}var Op=I(Pp,[["render",zp]]);const Np=V({props:{playlist:Array,filter:Object},data:()=>({hideFilteredOut:!0,filterTagInput:"",tagInput:"",tagInputIdx:-1}),methods:{toggleVisibility(t,s){t.hidevideo?this.sendCtrl("videoVisibility",[!0,s]):this.sendCtrl("videoVisibility",[!1,s])},dragEnd(t){this.sendCtrl("move",[t.oldIndex,t.newIndex])},applyFilter(t){this.$emit("filterChange",t)},sendCtrl(t,s){this.$emit("ctrl",[t,s])},isFilteredOut(t){return this.filter.tag!==""&&!t.tags.includes(this.filter.tag)},startAddTag(t){this.tagInputIdx=t,this.$nextTick(()=>{this.$el.querySelector("table .filter-tag-input").focus()})}},computed:{enhancedPlaylist(){return this.playlist.map(t=>(t.filteredOut=this.isFilteredOut(t),t))},firstIndex(){return this.filter.tag===""?0:this.playlist.findIndex(t=>t.tags.includes(this.filter.tag))}},watch:{playlist:function(t,s){t.find(o=>!this.isFilteredOut(o))||this.$emit("stopPlayer")},filter:function(t,s){this.playlist.find(o=>!this.isFilteredOut(o))||this.$emit("stopPlayer")}}}),L=t=>(G("data-v-c0843896"),t=t(),K(),t),Lp={class:"filters"},Rp={class:"currentfilter"},jp=L(()=>e("div",{class:"mr-1"},"Filter:",-1)),Jp=L(()=>e("i",{class:"fa fa-remove ml-1"},null,-1)),Bp={key:1,class:"field has-addons mr-1 mb-0"},qp={class:"control"},Wp={class:"control"},Hp={class:"pt-1"},Gp=g(" Hide filtered out"),Kp={key:0,class:"table is-striped"},Yp=L(()=>e("thead",null,[e("tr",null,[e("th"),e("th"),e("th"),e("th",null,"Title"),e("th",null,"User"),e("th",null,"Plays"),e("th"),e("th"),e("th"),e("th")])],-1)),Xp=L(()=>e("td",{class:"pt-4 handle"},[e("i",{class:"fa fa-arrows"})],-1)),Qp=["disabled","onClick"],Zp=L(()=>e("i",{class:"fa fa-play"},null,-1)),xp=[Zp],tg=["href"],eg=L(()=>e("i",{class:"fa fa-external-link"},null,-1)),sg=["onClick"],ng=L(()=>e("i",{class:"fa fa-remove ml-1"},null,-1)),ig=["onClick"],lg=L(()=>e("i",{class:"fa fa-plus"},null,-1)),og=[lg],ag={key:0,class:"field has-addons"},dg={class:"control"},rg=["onKeyup"],ug={class:"control"},cg=["disabled","onClick"],mg=["onClick","title"],hg=["onClick"],pg=L(()=>e("i",{class:"fa fa-thumbs-up mr-1"},null,-1)),gg=["onClick"],fg=L(()=>e("i",{class:"fa fa-thumbs-down mr-1"},null,-1)),vg=["onClick"],$g=L(()=>e("i",{class:"fa fa-trash"},null,-1)),yg=[$g],bg={key:1};function _g(t,s,o,d,v,f){const c=b("draggable");return i(),l("div",null,[e("div",Lp,[e("div",Rp,[jp,t.filter.tag?(i(),l("span",{key:0,class:"tag mr-1",onClick:s[0]||(s[0]=n=>t.applyFilter(""))},[g(_(t.filter.tag)+" ",1),Jp])):(i(),l("div",Bp,[e("div",qp,[h(e("input",{class:"input is-small filter-tag-input",type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>t.filterTagInput=n),onKeyup:s[2]||(s[2]=B(n=>t.applyFilter(t.filterTagInput),["enter"]))},null,544),[[y,t.filterTagInput]])]),e("div",Wp,[e("span",{class:"button is-small",onClick:s[3]||(s[3]=n=>t.applyFilter(t.filterTagInput))},"Apply filter")])])),e("label",Hp,[h(e("input",{class:"checkbox",type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=n=>t.hideFilteredOut=n)},null,512),[[M,t.hideFilteredOut]]),Gp])])]),t.playlist.length>0?(i(),l("table",Kp,[Yp,k(c,{modelValue:t.enhancedPlaylist,onEnd:t.dragEnd,tag:"tbody",handle:".handle","item-key":"id"},{item:O(({element:n,index:m})=>[h(e("tr",null,[Xp,e("td",null,_(m+1),1),e("td",null,[m!==t.firstIndex?(i(),l("button",{key:0,class:"button is-small",disabled:n.filteredOut?!0:null,onClick:u=>t.sendCtrl("playIdx",[m]),title:"Play"},xp,8,Qp)):p("",!0)]),e("td",null,[e("a",{href:"https://www.youtube.com/watch?v="+n.yt,target:"_blank"},[g(_(n.title||n.yt)+" ",1),eg],8,tg),e("div",null,[(i(!0),l(U,null,D(n.tags,(u,$)=>(i(),l("span",{key:$,class:"tag",onClick:S=>t.sendCtrl("rmtag",[u,m])},[g(_(u)+" ",1),ng],8,sg))),128)),e("span",{class:"button is-small",onClick:u=>t.startAddTag(m)},og,8,ig)]),t.tagInputIdx===m?(i(),l("div",ag,[e("div",dg,[h(e("input",{class:"input is-small filter-tag-input",type:"text","onUpdate:modelValue":s[5]||(s[5]=u=>t.tagInput=u),onKeyup:B(u=>{t.sendCtrl("addtag",[t.tagInput,m]),t.tagInput=""},["enter"])},null,40,rg),[[y,t.tagInput]])]),e("div",ug,[e("span",{class:"button is-small",disabled:t.tagInput?null:!0,onClick:u=>{t.sendCtrl("addtag",[t.tagInput,m]),t.tagInput=""}},"Add tag",8,cg)])])):p("",!0)]),e("td",null,_(n.user),1),e("td",null,_(n.plays)+"x",1),e("td",null,[e("button",{class:"button is-small",onClick:u=>t.toggleVisibility(n,m),title:n.hidevideo?"Video hidden":"Video visible"},[e("i",{class:A(["fa mr-1",{"fa-eye":!n.hidevideo,"fa-eye-slash":n.hidevideo}])},null,2)],8,mg)]),e("td",null,[e("button",{class:"button is-small",onClick:u=>t.sendCtrl("goodIdx",[m])},[pg,g(" "+_(n.goods),1)],8,hg)]),e("td",null,[e("button",{class:"button is-small",onClick:u=>t.sendCtrl("badIdx",[m])},[fg,g(" "+_(n.bads),1)],8,gg)]),e("td",null,[e("button",{class:"button is-small",onClick:u=>t.sendCtrl("rmIdx",[m]),title:"Remove"},yg,8,vg)])],512),[[lt,!t.hideFilteredOut||!n.filteredOut]])]),_:1},8,["modelValue","onEnd"])])):(i(),l("div",bg,"Playlist is empty"))])}var wg=I(Np,[["render",_g],["__scopeId","data-v-c0843896"]]);const kg=V({props:{modelValue:{type:Object,required:!0}},emits:{"update:modelValue":null},created(){this.settings=this.modelValue},methods:{loadPreset(t){const s=this.settings.customCssPresets.find(o=>o.name===t);s?(this.settings.customCss=s.css,this.settings.showProgressBar=s.showProgressBar,this.settings.showThumbnails=s.showThumbnails,this.settings.maxItemsShown=s.maxItemsShown):console.warn(`preset not found: ${t}`),this.sendSettings()},removePreset(t){this.settings.customCssPresets=this.settings.customCssPresets.filter(s=>s.name!==t),this.sendSettings()},savePreset(){const t=this.settings.customCssPresets.findIndex(s=>s.name===this.cssPresetName);t>=0?(this.settings.customCssPresets[t].css=this.settings.customCss,this.settings.customCssPresets[t].showProgressBar=this.settings.showProgressBar,this.settings.customCssPresets[t].showThumbnails=this.settings.showThumbnails,this.settings.customCssPresets[t].maxItemsShown=this.settings.maxItemsShown):this.settings.customCssPresets.push({name:this.cssPresetName,css:this.settings.customCss,showProgressBar:this.settings.showProgressBar,showThumbnails:this.settings.showThumbnails,maxItemsShown:this.settings.maxItemsShown}),this.sendSettings()},hideVideoImageRemoved(){this.settings.hideVideoImage={filename:"",file:""},this.sendSettings()},hideVideoImageUploaded(t){this.settings.hideVideoImage={filename:t.originalname,file:t.filename},this.sendSettings()},sendSettings(){this.$emit("update:modelValue",this.settings)}},data:()=>({cssPresetName:"",cssPresetDropdownActive:!1,settings:{volume:100,hideVideoImage:{file:"",filename:""},showProgressBar:!1,customCssPresets:[],customCss:""},css:{classExamples:[{class:".wrapper",desc:"Wrapper for everything"},{class:".player",desc:"The player"},{class:".list",desc:"The playlist"},{class:".item",desc:"A playlist item"},{class:".playing",desc:"Currently playing item"},{class:".not-playing",desc:"Queued items"},{class:".title",desc:"Wrapper for the title of a playlist item"},{class:".title-content",desc:"Title texts"},{class:".title-orig",desc:"Title text displayed by default"},{class:".title-dupl",desc:"Title text duplicated, useful for marquee effect"},{class:".vote",desc:"Vote elements"},{class:".vote-up",desc:"Up vote element"},{class:".vote-down",desc:"Down vote element"},{class:".meta",desc:"Meta info about an item"},{class:".meta-user",desc:"User who requested the song"},{class:".meta-plays",desc:"How many times the song was played"}],codeExamples:[{desc:"Hide Player:",code:".player { position: absolute; }"},{desc:"Change font to external font:",code:`@import url('https://fonts.googleapis.com/css2?family=Shadows+Into+Light');
body { font-family: 'Shadows into Light'; font-size: 30px; }`},{desc:"Change colors of items:",code:`.playing { background: #222; color: #bbb; }
.not-playing { background: #eee; color: #444; }`},{desc:"Display something in front of the currently playing item title:",code:".playing .title:before { content: '\u{1F3B6} Now Playing \u{1F3B6} ' }"},{desc:"Add a margin between the items:",code:".item { margin-bottom: 20px; }"},{desc:"Hide votes and meta:",code:".vote, .meta { display: none; }"},{desc:"Hide down votes:",code:".vote-down { display: none; }"},{desc:"Hite all items starting from the 6th:",code:".item:nth-child(n+6) { display: none; }"},{desc:"Show only titles and marquee the current song:",code:`.playing .title { overflow: hidden; white-space: nowrap; height: 20px; line-height: 20px; }
.playing .title-content { position: absolute; padding: 0 10px; min-width: 100%; animation: init 5s linear, back 10s linear 5s infinite; }
.playing .title-content.title-dupl { display: block; animation: back 10s linear 0s infinite; }
.title { margin-bottom: 0; }
.meta-left, .meta-right, .thumbnail { display: none; }
@keyframes back {
    from { transform: translateX(100%); }
    to { transform: translateX(-100%); }
}
@keyframes init {
    to { transform: translateX(-100%); }
}`},{desc:"Replace icon for thumbs-up with an image",code:`.meta-right .vote-up { background: url('https://hyottoko.club/assets/hyottoko.30d2bcb9.png') no-repeat 0 center; background-size: 1em; padding-left: 1.2em; }
.meta-right .vote-up .fa { display: none; }`},{desc:"Remove text before/after username",code:`.meta-user-text-before,
.meta-user-text-after {display: none}`},{desc:"Add a fontawesome icon before username (\\f075 is the icon unicode, refer to https://fontawesome.com/v4.7/icons/)",code:'.meta-user-name::before { content: "\\f075"; display: inline-block; font: normal normal normal 14px/1 FontAwesome; font-size: inherit; margin-right: .5em; }'},{desc:"Add an image icon before username",code:".meta-user-name { background: url('https://hyottoko.club/assets/hyottoko.30d2bcb9.png') no-repeat 0 center; background-size: 1em; padding-left: 1.2em; }"},{desc:"Add an image icon before username for specific user only",code:`[data-user="nc_para_" i] .meta-user-name { background: url('https://hyottoko.club/assets/hyottoko.30d2bcb9.png') no-repeat 0 center; background-size: 1em; padding-left: 1.2em; }`},{desc:"Change item display depending on username (this one changes background and makes thumbnails black boxes)",code:`[data-user="nc_para_" i] { background: #dd0066; }
[data-user="nc_para_" i] .thumbnail img { display: none; }
[data-user="nc_para_" i] .thumbnail { background: black; }`},{desc:"Show player left of the playlist (and limit its height to 320px)",code:`.wrapper { display: grid; grid-template-areas: "player playlist"; grid-template-columns: 50% auto; grid-template-rows: 320px; }
.player iframe { height: 320px; }`},{desc:"Show thumbnails only, and display meta info above them",code:`.item { display: block; position: relative; padding: 0; color: white; }
.title, .meta-left, .meta-right { position: absolute; padding: .2em; background: rgba(244,0,90,.9); }
.meta-left { top: 0; left: 0; font-size: 1em; }
.meta-right { top: 0; right: 0; font-size: 1em; }
.title { bottom: 0; left: 0; right: 0; margin-bottom: 0; }
.thumbnail { width: auto; }`},{desc:"Align thumbnails to the bottom",code:".thumbnail { align-self: end; }"},{desc:"Align thumbnails to the center",code:".thumbnail { align-self: center; }"},{desc:"Add a margin/padding to the thumbnails",code:".thumbnail { padding: 20px; }"},{desc:"Show number of plays not at player, but in icon form on the right near votes",code:`.meta-left .meta-user:after,
.meta-left .meta-plays { display: none; }
.meta-right .meta-plays { display: inline-block; }`}]}})}),T=t=>(G("data-v-335293ad"),t=t(),K(),t),Cg={key:0,class:"table is-striped",ref:"table"},Sg=T(()=>e("tr",null,[e("td",{colspan:"3"},"General")],-1)),Vg=T(()=>e("td",null,[e("code",null,"settings.volume")],-1)),Ig=T(()=>e("td",null,"Base volume for all songs played.",-1)),Ug=T(()=>e("td",null,[e("code",null,"settings.initAutoplay")],-1)),Dg=T(()=>e("td",null,"If checked, the widget will autoplay when first opened.",-1)),Ag=T(()=>e("td",null,[e("code",null,"settings.hideVideoImage")],-1)),Pg={key:0,class:"mb-1"},Tg=T(()=>e("br",null,null,-1)),Eg=T(()=>e("i",{class:"fa fa-remove mr-1"},null,-1)),Fg=g(" Remove Image "),Mg=[Eg,Fg],zg=T(()=>e("td",null,"Image to display when a video is hidden.",-1)),Og=T(()=>e("tr",null,[e("td",{colspan:"3"},"Visuals")],-1)),Ng=T(()=>e("td",null,[e("code",null,"settings.showProgressBar")],-1)),Lg=T(()=>e("td",null,"Render a progress bar in the bottom part of the video in the widget.",-1)),Rg=T(()=>e("td",null,[e("code",null,"settings.showThumbnails")],-1)),jg=T(()=>e("td",null,"Render video thumbnails in the widget.",-1)),Jg=T(()=>e("td",null,[e("code",null,"settings.maxItemsShown")],-1)),Bg=T(()=>e("td",null,"Max. number of items displayed in the playlist. Set to -1 for no limit.",-1)),qg=T(()=>e("code",null,"settings.customCss",-1)),Wg={class:"field has-addons mr-1"},Hg={class:"control is-expanded"},Gg={class:"control"},Kg=["onClick"],Yg=["onClick"],Xg=T(()=>e("i",{class:"fa fa-remove"},null,-1)),Qg=[Xg],Zg=T(()=>e("p",null,"Classes that can be used for styling:",-1)),xg={class:"table"},tf=T(()=>e("thead",null,[e("tr",null,[e("th",null,"Class"),e("th",null,"Description")])],-1)),ef=T(()=>e("p",null,[e("b",null,"Examples:")],-1));function sf(t,s,o,d,v,f){const c=b("volume-slider"),n=b("responsive-image"),m=b("upload");return i(),l("div",null,[t.settings?(i(),l("table",Cg,[e("tbody",null,[Sg,e("tr",null,[Vg,e("td",null,[k(c,{modelValue:t.settings.volume,"onUpdate:modelValue":[s[0]||(s[0]=u=>t.settings.volume=u),t.sendSettings]},null,8,["modelValue","onUpdate:modelValue"])]),Ig]),e("tr",null,[Ug,e("td",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":[s[1]||(s[1]=u=>t.settings.initAutoplay=u),s[2]||(s[2]=(...u)=>t.sendSettings&&t.sendSettings(...u))]},null,512),[[M,t.settings.initAutoplay]])]),Dg]),e("tr",null,[Ag,e("td",null,[t.settings.hideVideoImage.file?(i(),l("div",Pg,[k(n,{src:t.settings.hideVideoImage.file,title:t.settings.hideVideoImage.filename,width:"100px",height:"50px",style:{display:"inline-block"}},null,8,["src","title"]),Tg,e("button",{class:"button is-small",onClick:s[3]||(s[3]=(...u)=>t.hideVideoImageRemoved&&t.hideVideoImageRemoved(...u))},Mg)])):p("",!0),k(m,{onUploaded:t.hideVideoImageUploaded,accept:"image/*",label:"Upload Image"},null,8,["onUploaded"])]),zg]),Og,e("tr",null,[Ng,e("td",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":[s[4]||(s[4]=u=>t.settings.showProgressBar=u),s[5]||(s[5]=(...u)=>t.sendSettings&&t.sendSettings(...u))]},null,512),[[M,t.settings.showProgressBar]])]),Lg]),e("tr",null,[Rg,e("td",null,[h(e("input",{type:"checkbox","onUpdate:modelValue":[s[6]||(s[6]=u=>t.settings.showThumbnails=u),s[7]||(s[7]=(...u)=>t.sendSettings&&t.sendSettings(...u))]},null,512),[[M,t.settings.showThumbnails]])]),jg]),e("tr",null,[Jg,e("td",null,[h(e("input",{type:"number",min:"-1","onUpdate:modelValue":[s[8]||(s[8]=u=>t.settings.maxItemsShown=u),s[9]||(s[9]=(...u)=>t.sendSettings&&t.sendSettings(...u))]},null,512),[[y,t.settings.maxItemsShown]])]),Bg]),e("tr",null,[e("td",null,[qg,e("div",Wg,[e("div",Hg,[h(e("input",{class:"input is-small","onUpdate:modelValue":s[10]||(s[10]=u=>t.cssPresetName=u),onFocus:s[11]||(s[11]=u=>t.cssPresetDropdownActive=!0),onBlur:s[12]||(s[12]=u=>t.cssPresetDropdownActive=!1)},null,544),[[y,t.cssPresetName]])]),e("div",Gg,[e("span",{class:"button is-small",onClick:s[13]||(s[13]=(...u)=>t.savePreset&&t.savePreset(...u))},"Save preset")])]),(i(!0),l(U,null,D(t.settings.customCssPresets,(u,$)=>(i(),l("div",{class:"mb-1",key:$},[e("span",{class:"button is-small",onClick:S=>t.loadPreset(u.name)},_(u.name),9,Kg),e("span",{class:"button is-small ml-1",onClick:S=>t.removePreset(u.name)},Qg,8,Yg)]))),128))]),e("td",null,[h(e("textarea",{class:"textarea","onUpdate:modelValue":[s[14]||(s[14]=u=>t.settings.customCss=u),s[15]||(s[15]=(...u)=>t.sendSettings&&t.sendSettings(...u))]},null,512),[[y,t.settings.customCss]])]),e("td",null,[Zg,e("table",xg,[tf,e("tbody",null,[(i(!0),l(U,null,D(t.css.classExamples,(u,$)=>(i(),l("tr",{key:$},[e("td",null,[e("code",null,_(u.class),1)]),e("td",null,_(u.desc),1)]))),128))])]),ef,(i(!0),l(U,null,D(t.css.codeExamples,(u,$)=>(i(),l("p",{key:$},[g(_(u.desc)+" ",1),e("pre",null,[e("code",null,_(u.code),1)])]))),128))])])])],512)):p("",!0)])}var nf=I(kg,[["render",sf],["__scopeId","data-v-335293ad"]]);const lf=V({props:{tags:Array},data:()=>({editTag:"",tagEditIdx:-1}),methods:{onInputFocus(t,s){this.editTag=t.value,this.tagEditIdx=s},updateTag(t,s){this.$emit("updateTag",[t,s])}}}),of={class:"table is-striped"},af=e("tr",null,[e("th",null,"Tag"),e("th"),e("th")],-1),df=["onKeyup"],rf=["value","onFocus"],uf=["disabled","onClick"];function cf(t,s,o,d,v,f){return i(),l("table",of,[af,(i(!0),l(U,null,D(t.tags,(c,n)=>(i(),l("tr",{key:n},[e("td",null,[t.tagEditIdx===n?h((i(),l("input",{key:0,type:"text",class:"input is-small","onUpdate:modelValue":s[0]||(s[0]=m=>t.editTag=m),onKeyup:B(m=>t.updateTag(c.value,t.editTag),["enter"])},null,40,df)),[[y,t.editTag]]):(i(),l("input",{key:1,type:"text",class:"input is-small",value:c.value,onFocus:m=>t.onInputFocus(c,n)},null,40,rf))]),e("td",null,[t.tagEditIdx===n?(i(),l("span",{key:0,class:"button is-small",disabled:c.value===t.editTag?!0:null,onClick:m=>t.updateTag(c.value,t.editTag)},"Save",8,uf)):p("",!0)]),e("td",null,_(c.count)+"x",1)]))),128))])}var mf=I(lf,[["render",cf]]);const hf=V({props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue","cancel"],data:()=>({item:null,newState:"",newSlotDefinitionName:""}),mounted(){this.item=JSON.parse(JSON.stringify(this.modelValue)),this.adjustAllImagesDivSize(),window.addEventListener("resize",this.adjustAllImagesDivSize)},unmounted(){window.removeEventListener("resize",this.adjustAllImagesDivSize)},watch:{modelValue:{handler(t){this.item=JSON.parse(JSON.stringify(t))}}},computed:{allImages(){var s;const t=[];return(s=this.item)==null||s.slotDefinitions.forEach(o=>{o.items.forEach(d=>{d.states.forEach(v=>{v.frames.forEach(f=>{f.url&&!t.includes(f.url)&&t.push(f.url)})})})}),t},isStateAddable(){return!(!this.item||this.newState===""||this.item.stateDefinitions.find(({value:t})=>t===this.newState))}},methods:{adjustAllImagesDivSize(){this.$nextTick(()=>{if(!this.$refs.cardBody||!this.$refs.allImagesDiv)return;const t=this.$refs.cardBody.clientHeight;this.$refs.allImagesDiv.style.maxHeight=`${t}px`})},imageDragStart(t){t.dataTransfer.setData("avatar-image-url",t.target.getAttribute("data-src"))},onSaveClick(){if(!this.item){console.warn("onSaveClick: this.item not initialized");return}this.$emit("update:modelValue",{name:this.item.name,stateDefinitions:this.item.stateDefinitions,slotDefinitions:this.item.slotDefinitions})},onSaveAndCloseClick(){if(!this.item){console.warn("onSaveClick: this.item not initialized");return}this.$emit("update:modelValue",{name:this.item.name,stateDefinitions:this.item.stateDefinitions,slotDefinitions:this.item.slotDefinitions}),this.$emit("cancel")},onCancelClick(){this.$emit("cancel")},onOverlayClick(){this.$emit("cancel")},onCloseClick(){this.$emit("cancel")},addStateDefinition(){if(!this.item){console.warn("addStateDefinition: this.item not initialized");return}const t={value:this.newState,deletable:!0};this.item.stateDefinitions.push(t);for(let s of this.item.slotDefinitions)for(let o of s.items)o.states.push({state:t.value,frames:[]})},removeStateDefinition(t){if(!this.item){console.warn("removeStateDefinition: this.item not initialized");return}const s=[];for(let d in this.item.stateDefinitions)parseInt(d,10)!==parseInt(`${t}`,10)&&s.push(this.item.stateDefinitions[d]);this.item.stateDefinitions=s;const o=s.map(d=>d.value);for(let d of this.item.slotDefinitions)for(let v of d.items)v.states=v.states.filter(f=>o.includes(f.state))},removeSlotDefinition(t){if(!this.item){console.warn("removeSlotDefinition: this.item not initialized");return}const s=[];for(let o in this.item.slotDefinitions)parseInt(o,10)!==parseInt(`${t}`,10)&&s.push(this.item.slotDefinitions[o]);this.item.slotDefinitions=s},updateSlotDefinition(t,s){if(!this.item){console.warn("updateSlotDefinition: this.item not initialized");return}this.item.slotDefinitions[parseInt(`${t}`,10)]=s},addSlotDefinition(){if(!this.item){console.warn("addSlotDefinition: this.item not initialized");return}const t={slot:"Unnamed slot",defaultItemIndex:-1,items:[]};this.item.slotDefinitions.push(t)},moveSlotUp(t){if(!this.item){console.warn("moveSlotUp: this.item not initialized");return}if(t<=0)return;const s=this.item.slotDefinitions[t-1];this.item.slotDefinitions[t-1]=this.item.slotDefinitions[t],this.item.slotDefinitions[t]=s},moveSlotDown(t){if(!this.item){console.warn("moveSlotDown: this.item not initialized");return}if(t>=this.item.slotDefinitions.length-1)return;const s=this.item.slotDefinitions[t+1];this.item.slotDefinitions[t+1]=this.item.slotDefinitions[t],this.item.slotDefinitions[t]=s}}}),pf={key:0,class:"avatar-editor modal is-active"},gf={class:"modal-card"},ff={class:"modal-card-head"},vf=e("p",{class:"modal-card-title"},"Edit Avatar",-1),$f={class:"modal-card-body",ref:"cardBody"},yf={class:"columns"},bf={class:"column is-three-quarters"},_f={class:"table is-striped"},wf=e("td",null,"Name:",-1),kf=e("td",null,"States:",-1),Cf=["onClick"],Sf=e("i",{class:"fa fa-trash"},null,-1),Vf=[Sf],If=["disabled"],Uf=e("td",null,"Slots",-1),Df={class:"column"},Af={class:"avatar-all-images",ref:"allImagesDiv"},Pf=["src","data-src"],Tf={class:"modal-card-foot"};function Ef(t,s,o,d,v,f){const c=b("avatar-slot-definition-editor");return t.item?(i(),l("div",pf,[e("div",{class:"modal-background",onClick:s[0]||(s[0]=(...n)=>t.onOverlayClick&&t.onOverlayClick(...n))}),e("div",gf,[e("header",ff,[vf,e("button",{class:"delete","aria-label":"close",onClick:s[1]||(s[1]=(...n)=>t.onCloseClick&&t.onCloseClick(...n))})]),e("section",$f,[e("div",yf,[e("div",bf,[e("table",_f,[e("tbody",null,[e("tr",null,[wf,e("td",null,[h(e("input",{class:"input is-small","onUpdate:modelValue":s[2]||(s[2]=n=>t.item.name=n)},null,512),[[y,t.item.name]])])]),e("tr",null,[kf,e("td",null,[(i(!0),l(U,null,D(t.item.stateDefinitions,(n,m)=>(i(),l("span",{class:"tag",key:m},[e("span",null,_(n.value),1),n.deletable?(i(),l("span",{key:0,class:"ml-1 is-clickable",onClick:u=>t.removeStateDefinition(m)},Vf,8,Cf)):p("",!0)]))),128)),h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":s[3]||(s[3]=n=>t.newState=n),placeholder:"State"},null,512),[[y,t.newState]]),e("span",{class:"button is-small",onClick:s[4]||(s[4]=(...n)=>t.addStateDefinition&&t.addStateDefinition(...n)),disabled:t.isStateAddable?null:!0},"Add custom state",8,If)])]),e("tr",null,[Uf,e("td",null,[(i(!0),l(U,null,D(t.item.slotDefinitions,(n,m)=>(i(),F(c,{class:"card mb-2",key:m,modelValue:n,avatarDef:t.item,"onUpdate:modelValue":u=>t.updateSlotDefinition(m,u),onMoveUp:u=>t.moveSlotUp(m),onMoveDown:u=>t.moveSlotDown(m),onRemove:u=>t.removeSlotDefinition(m)},null,8,["modelValue","avatarDef","onUpdate:modelValue","onMoveUp","onMoveDown","onRemove"]))),128))])])])]),e("span",{class:"button is-small",onClick:s[5]||(s[5]=(...n)=>t.addSlotDefinition&&t.addSlotDefinition(...n))},"Add slot")]),e("div",Df,[e("div",Af,[(i(!0),l(U,null,D(t.allImages,(n,m)=>(i(),l("img",{key:m,src:n,draggable:"true",class:"mr-1 mb-1",onDragstart:s[6]||(s[6]=(...u)=>t.imageDragStart&&t.imageDragStart(...u)),"data-src":n},null,40,Pf))),128))],512)])])],512),e("footer",Tf,[e("button",{class:"button is-small is-primary",onClick:s[7]||(s[7]=(...n)=>t.onSaveClick&&t.onSaveClick(...n))}," Save "),e("button",{class:"button is-small is-primary",onClick:s[8]||(s[8]=(...n)=>t.onSaveAndCloseClick&&t.onSaveAndCloseClick(...n))}," Save and close "),e("button",{class:"button is-small",onClick:s[9]||(s[9]=(...n)=>t.onCancelClick&&t.onCancelClick(...n))},"Cancel")])])])):p("",!0)}var Ff=I(hf,[["render",Ef]]);const Mf=V({props:{modelValue:{type:Object,required:!0},avatarDef:{type:Object,required:!0}},emits:["update:modelValue","remove","moveUp","moveDown"],data:()=>({titleFocused:!1}),computed:{defaultItem(){return this.modelValue.defaultItemIndex>=0&&this.modelValue.items.length>this.modelValue.defaultItemIndex?this.modelValue.items[this.modelValue.defaultItemIndex]:null},defaultAnimation(){if(!this.defaultItem)return[];const t=this.defaultItem.states.find(({state:s})=>s==="default");return t?t.frames:[]}},methods:{emitChange(){this.$emit("update:modelValue",this.modelValue)},updateItem(t,s){this.modelValue.items[t]=s,this.emitChange()},removeItem(t,s){this.modelValue.items=this.modelValue.items.filter((o,d)=>d!==t),t<=this.modelValue.defaultItemIndex&&(this.modelValue.defaultItemIndex=this.modelValue.defaultItemIndex-1),this.modelValue.items.length>0&&this.modelValue.defaultItemIndex<0&&(this.modelValue.defaultItemIndex=0),this.emitChange()},makeItemDefault(t,s){this.modelValue.defaultItemIndex=t,this.emitChange()},addItem(){const t={title:`${this.modelValue.slot} item ${this.modelValue.items.length+1}`,states:this.avatarDef.stateDefinitions.map(s=>({state:s.value,frames:[]}))};this.modelValue.items.push(t),this.modelValue.defaultItemIndex===-1&&(this.modelValue.defaultItemIndex=0),this.emitChange()},moveItemUp(t){this.swapItems(t-1,t)},moveItemDown(t){this.swapItems(t+1,t)},swapItems(t,s){if(t<0||t>this.modelValue.items.length-1||s<0||s>this.modelValue.items.length-1)return;const o=this.modelValue.items[t];this.modelValue.items[t]=this.modelValue.items[s],this.modelValue.items[s]=o,this.modelValue.defaultItemIndex===t?this.modelValue.defaultItemIndex=s:this.modelValue.defaultItemIndex===s&&(this.modelValue.defaultItemIndex=t),this.modelValue.items=this.modelValue.items.slice()}}}),zf={class:"avatar-slot-definition-editor"},Of={class:"level avatar-slot-definition-editor-title p-1"},Nf={class:"level-left"},Lf={class:"level-item"},Rf={class:"level-item"},jf={class:"level-right"},Jf={class:"level-item"},Bf={class:"level-item"},qf={class:"level-item"},Wf=e("i",{class:"fa fa-trash"},null,-1),Hf=[Wf],Gf={class:"p-1"};function Kf(t,s,o,d,v,f){const c=b("avatar-animation"),n=b("avatar-slot-item-editor");return i(),l("div",zf,[e("div",Of,[e("div",Nf,[e("div",Lf,[k(c,{frames:t.defaultAnimation,width:32,height:32},null,8,["frames"])]),e("div",Rf,[h(e("input",{class:A(["input is-small avatar-slot-definition-editor-title-input",{"is-static":!t.titleFocused}]),onFocus:s[0]||(s[0]=m=>t.titleFocused=!0),onBlur:s[1]||(s[1]=m=>t.titleFocused=!1),"onUpdate:modelValue":s[2]||(s[2]=m=>t.modelValue.slot=m)},null,34),[[y,t.modelValue.slot]])])]),e("div",jf,[e("div",Jf,[e("i",{class:"fa fa-chevron-up is-clickable ml-1",onClick:s[3]||(s[3]=m=>t.$emit("moveUp"))})]),e("div",Bf,[e("i",{class:"fa fa-chevron-down is-clickable ml-1",onClick:s[4]||(s[4]=m=>t.$emit("moveDown"))})]),e("div",qf,[e("span",{class:"button is-small",onClick:s[5]||(s[5]=m=>t.$emit("remove"))},Hf)])])]),e("div",Gf,[(i(!0),l(U,null,D(t.modelValue.items,(m,u)=>(i(),F(n,{class:A(["card mb-1",{"is-default":u===this.modelValue.defaultItemIndex}]),key:u,modelValue:m,isDefault:u===this.modelValue.defaultItemIndex,onMoveUp:$=>t.moveItemUp(u),onMoveDown:$=>t.moveItemDown(u),"onUpdate:modelValue":$=>t.updateItem(u,$),onRemove:$=>t.removeItem(u,$),onMakeDefault:$=>t.makeItemDefault(u,$)},null,8,["class","modelValue","isDefault","onMoveUp","onMoveDown","onUpdate:modelValue","onRemove","onMakeDefault"]))),128))]),e("span",{class:"button is-small",onClick:s[6]||(s[6]=(...m)=>t.addItem&&t.addItem(...m))},"Add item")])}var Yf=I(Mf,[["render",Kf]]);const Xf=V({props:{modelValue:{type:Object,required:!0},isDefault:{type:Boolean,required:!0}},emits:["update:modelValue","makeDefault","moveUp","moveDown"],data:()=>({titleFocused:!1}),computed:{defaultState(){return this.modelValue.states.find(({state:t})=>t==="default")}},methods:{updateAnimation(t,s){},makeDefault(){this.$emit("makeDefault",this.modelValue)}}}),Qf={class:"avatar-slot-item-editor p-1"},Zf={class:"level"},xf={class:"level-left"},t1={class:"level-item"},e1={class:"level-item"},s1={key:0,class:"has-text-success mr-1"},n1=e("i",{class:"fa fa-check"},null,-1),i1=g(" Default"),l1=[n1,i1],o1={class:"level-right"},a1={class:"level-item"},d1={class:"level-item"},r1={class:"level-item"},u1=e("i",{class:"fa fa-trash"},null,-1),c1=[u1];function m1(t,s,o,d,v,f){const c=b("avatar-slot-item-state-editor");return i(),l("div",Qf,[e("div",Zf,[e("div",xf,[e("div",t1,[h(e("input",{type:"text",class:A(["input is-small avatar-slot-item-editor-title",{"is-static":!t.titleFocused}]),onFocus:s[0]||(s[0]=n=>t.titleFocused=!0),onBlur:s[1]||(s[1]=n=>t.titleFocused=!1),"onUpdate:modelValue":s[2]||(s[2]=n=>t.modelValue.title=n)},null,34),[[y,t.modelValue.title]])]),e("div",e1,[t.isDefault?(i(),l("span",s1,l1)):(i(),l("span",{key:1,class:"button is-small",onClick:s[3]||(s[3]=(...n)=>t.makeDefault&&t.makeDefault(...n))},"Make default"))])]),e("div",o1,[e("div",a1,[e("i",{class:"fa fa-chevron-up is-clickable ml-1",onClick:s[4]||(s[4]=n=>t.$emit("moveUp"))})]),e("div",d1,[e("i",{class:"fa fa-chevron-down is-clickable ml-1",onClick:s[5]||(s[5]=n=>t.$emit("moveDown"))})]),e("div",r1,[e("span",{class:"button is-small",onClick:s[6]||(s[6]=n=>t.$emit("remove"))},c1)])])]),(i(!0),l(U,null,D(t.modelValue.states,(n,m)=>(i(),F(c,{class:"mr-1",modelValue:n,defaultState:t.defaultState,"onUpdate:modelValue":u=>t.updateAnimation(m,u),key:m},null,8,["modelValue","defaultState","onUpdate:modelValue"]))),128))])}var h1=I(Xf,[["render",m1]]);const p1=V({props:{avatar:{type:Object,required:!0},width:{type:Number,required:!1,default:64},height:{type:Number,required:!1,default:64}},computed:{animations(){return this.avatar.slotDefinitions.map(t=>t.items[t.defaultItemIndex].states.find(({state:o})=>o==="default"))}}});function g1(t,s,o,d,v,f){const c=b("avatar-animation");return i(),l("div",{class:"avatar-preview",style:q({width:`${t.width}px`,height:`${t.height}px`})},[(i(!0),l(U,null,D(t.animations,(n,m)=>(i(),F(c,{frames:n.frames,key:m,width:t.width,height:t.height},null,8,["frames","width","height"]))),128))],4)}var f1=I(p1,[["render",g1]]);const v1=V({props:{modelValue:{type:Object,required:!0},defaultState:{type:Object,required:!0}},data(){return{editing:!1}},methods:{onDragOver(t){t.dataTransfer.getData("avatar-image-url")&&t.preventDefault()},onDragEnter(t){t.dataTransfer.getData("avatar-image-url")&&t.preventDefault()},onDrop(t){if(t.dataTransfer.getData("avatar-image-url")){t.preventDefault();const s={url:t.dataTransfer.getData("avatar-image-url"),duration:100};this.modelValue.frames.push(s)}},onOverlayClick(){this.editing=!1},imageUploaded(t,s){this.modelValue.frames[t].url=`/uploads/${s.filename}`},removeFrame(t){this.modelValue.frames=this.modelValue.frames.filter((s,o)=>o!==t)},addFrame(){const t={url:"",duration:100};this.modelValue.frames.push(t)}}}),$1={class:"avatar-slot-item-state-editor-title"},y1={class:"avatar-animation-frame"},b1={class:"avatar-animation-frame-remove"},_1=["onClick"],w1=e("i",{class:"fa fa-trash"},null,-1),k1=[w1],C1=["src"],S1=["onUpdate:modelValue"],V1={class:"avatar-animation-card mr-1"},I1={class:"avatar-animation-frame"},U1=e("i",{class:"fa fa-plus"},null,-1),D1=[U1];function A1(t,s,o,d,v,f){const c=b("avatar-animation"),n=b("upload");return i(),l("div",{class:"avatar-slot-item-state-editor card",onDragover:s[1]||(s[1]=(...m)=>t.onDragOver&&t.onDragOver(...m)),onDragenter:s[2]||(s[2]=(...m)=>t.onDragEnter&&t.onDragEnter(...m)),onDrop:s[3]||(s[3]=(...m)=>t.onDrop&&t.onDrop(...m))},[e("div",$1,_(t.modelValue.state),1),t.modelValue.frames.length?(i(),F(c,{key:0,frames:t.modelValue.frames},null,8,["frames"])):(i(),F(c,{key:1,frames:t.defaultState.frames,class:"avatar-fallback-animation"},null,8,["frames"])),e("div",null,[(i(!0),l(U,null,D(t.modelValue.frames,(m,u)=>(i(),l("div",{class:"avatar-animation-card mr-1",key:u},[e("span",y1,[e("div",b1,[e("span",{class:"button is-small",onClick:$=>t.removeFrame(u)},k1,8,_1)]),m.url?(i(),l("img",{key:0,src:m.url,width:"64",height:"64"},null,8,C1)):(i(),F(n,{key:1,onUploaded:$=>t.imageUploaded(u,$),accept:"image/*",label:"",class:"avatar-animation-frame-upload"},null,8,["onUploaded"])),h(e("input",{class:"input is-small",type:"text","onUpdate:modelValue":$=>m.duration=$},null,8,S1),[[y,m.duration]])])]))),128)),e("div",V1,[e("span",I1,[e("span",{class:"button is-small",onClick:s[0]||(s[0]=(...m)=>t.addFrame&&t.addFrame(...m))},D1)])])])],32)}var P1=I(v1,[["render",A1]]);const T1=V({props:{frames:{type:Array,required:!0},width:{type:Number,required:!1,default:64},height:{type:Number,required:!1,default:64}},data(){return{timeout:null,idx:-1}},watch:{frames:{handler(t,s){this.nextFrame()},deep:!0}},computed:{src(){return this.idx>=0&&this.idx<this.frames.length?this.frames[this.idx].url:""}},methods:{nextFrame(){if(this.frames.length===0){this.idx=-1;return}this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.idx++,this.idx>=this.frames.length&&(this.idx=0),this.timeout=setTimeout(()=>{this.nextFrame()},this.frames[this.idx].duration)}},created(){this.nextFrame()},unmounted(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}}),E1={class:"avatar-animation"},F1=["src","width","height"];function M1(t,s,o,d,v,f){return i(),l("span",E1,[t.src?(i(),l("img",{key:0,src:t.src,width:t.width,height:t.height},null,8,F1)):(i(),l("span",{key:1,style:q({width:`${t.width}px`,height:`${t.width}px`,display:"inline-block"})},null,4))])}var z1=I(T1,[["render",M1]]);const O1=async()=>{const t=gt({history:ft(),routes:[{name:"index",path:"/",component:Et,meta:{title:"Hyottoko.club",protected:!0}},{name:"login",path:"/login",component:te,meta:{title:"Login",protected:!1}},{name:"register",path:"/register",component:Gs,meta:{title:"Register",protected:!1}},{name:"password-reset",path:"/password-reset",component:Sr,meta:{title:"Password Reset",protected:!1}},{name:"forgot-password",path:"/forgot-password",component:Rr,meta:{title:"Forgot Password",protected:!1}},{name:"commands",path:"/commands/",component:Co,meta:{title:"Commands",protected:!0}},{name:"variables",path:"/variables/",component:gs,meta:{title:"Variables",protected:!0}},{name:"sr",path:"/sr/",component:Ni,meta:{title:"Song Request",protected:!0}},{name:"speech-to-text",path:"/speech-to-text/",component:Ad,meta:{title:"Speech to text",protected:!0}},{name:"avatar",path:"/avatar/",component:rr,meta:{title:"Avatar",protected:!0}},{name:"drawcast",path:"/drawcast/",component:xe,meta:{title:"Drawcast",protected:!0}},{name:"settings",path:"/settings/",component:Rn,meta:{title:"Settings",protected:!0}}]}),o=await(async v=>{const f=await fetch(v);return f.status===200?await f.json():null})("/api/conf");await N.init(),t.beforeEach((v,f,c)=>{if(v.meta.protected&&!N.getMe()){c({name:"login"});return}if(!v.meta.protected&&N.getMe()){c({name:"index"});return}f.name&&document.documentElement.classList.remove(`view-${String(f.name)}`),document.documentElement.classList.add(`view-${String(v.name)}`),document.title=`${v.meta.title}`,c()});const d=vt(Ct);d.config.globalProperties.$conf=o,d.use(t),d.use($t,{}),d.component("doubleclick-button",Nu),d.component("draggable",yt),d.component("duration-input",Yr),d.component("duration",Fu),d.component("navbar",Du),d.component("player",Zr),d.component("responsive-image",gu),d.component("slider",du),d.component("upload",Hr),d.component("volume-slider",cu),d.component("youtube",Wu),d.component("command-editor",Ah),d.component("countdown-editor",Ap),d.component("playlist-editor",wg),d.component("tags-editor",mf),d.component("song-request-settings",nf),d.component("help",Op),d.component("avatar-editor",Ff),d.component("avatar-slot-definition-editor",Yf),d.component("avatar-slot-item-editor",h1),d.component("avatar-preview",f1),d.component("avatar-slot-item-state-editor",P1),d.component("avatar-animation",z1),d.mount("#app")};O1();
