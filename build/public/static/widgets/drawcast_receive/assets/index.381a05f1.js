import{d as g,c as m,n as p,a as y,o as w,b as v}from"./vendor.11985ee1.js";const k=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};k();let a=[];const _=s=>{switch(s){case"error":a=["error"];break;case"info":a=["error","info"];break;case"log":a=["error","info","log"];break;case"debug":a=["error","info","log","debug"];break}};_("info");const c=(s,...e)=>{const t=s,i=n=>(...o)=>{a.includes(n)&&console[n](b("hh:mm:ss",new Date),`[${t}]`,...e,...o)};return{log:i("log"),info:i("info"),debug:i("debug"),error:i("error")}},b=(s,e)=>s.replace(/(hh|mm|ss)/g,(t,i)=>{switch(i){case"hh":return l(e.getHours(),"00");case"mm":return l(e.getMinutes(),"00");case"ss":return l(e.getSeconds(),"00");default:return t}}),l=(s,e)=>{const t=`${s}`;return t.length>=e.length?t:e.substr(0,e.length-t.length)+t},L=1001,u=4e3,h=c("WsWrapper.ts");class S{constructor(e,t){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=t}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){const e=new WebSocket(this.addr,this.protocols);e.onopen=t=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const i=this.sendBuffer.shift();i&&this.handle.send(i)}this.onopen(t)},e.onmessage=t=>{this.onmessage(t)},e.onclose=t=>{this.handle=null,t.code===u?h.info("custom disconnect, will not reconnect"):t.code===L?h.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(t)}}disconnect(){this.handle&&this.handle.close(u)}}const d=c("WsClient.ts");class A extends S{constructor(e,t){super(e,t);this._on={},this.onopen=i=>{this._dispatch("socket","open",i)},this.onmessage=i=>{if(this._dispatch("socket","message",i),this._on.message){const n=this._parseMessageData(i.data);n.event&&this._dispatch("message",`${n.event}`,n.data)}},this.onclose=i=>{this._dispatch("socket","close",i)}}onSocket(e,t){this.addEventListener("socket",e,t)}onMessage(e,t){this.addEventListener("message",e,t)}addEventListener(e,t,i){const n=Array.isArray(t)?t:[t];this._on[e]=this._on[e]||{};for(const o of n)this._on[e][o]=this._on[e][o]||[],this._on[e][o].push(i)}_parseMessageData(e){try{const t=JSON.parse(e);if(t.event)return{event:t.event,data:t.data||null}}catch(t){d.info(t)}return{event:null,data:null}}_dispatch(e,t,...i){const o=(this._on[e]||{})[t]||[];if(o.length!==0){d.log(`ws dispatch ${e} ${t}`);for(const r of o)r(...i)}}}const f=(s,e)=>`${window[s]!==`{{${s}}}`?window[s]:e}`,$=f("wsUrl",""),T=f("widgetToken","");var C={wsClient:s=>new A($+"/"+s,T)},O=(s,e)=>{const t=s.__vccOpts||s;for(const[i,n]of e)t[i]=n;return t};const D=g({data(){return{ws:null,queue:[],worker:null,imgstyle:null,displayDuration:5e3,displayLatestForever:!1,displayLatestAutomatically:!1,notificationSound:null,notificationSoundAudio:null,latestResolved:!0,images:[]}},methods:{async playone(s){return new Promise(async e=>{this.latestResolved=!1,await this.prepareImage(s.media.image.url),this.imgstyle={backgroundImage:`url(${s.media.image.url})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",height:"100%"},s.playsound&&this.notificationSoundAudio&&this.notificationSoundAudio.play(),setTimeout(()=>{this.displayLatestForever||(this.imgstyle=null),this.latestResolved=!0,e()},this.displayDuration)})},addQueue(s,e){if(this.queue.push({media:s,playsound:e}),this.worker)return;const t=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}const i=this.queue.shift();if(!i){clearInterval(this.worker),this.worker=null;return}await this.playone(i),this.worker=setTimeout(t,500)};this.worker=setTimeout(t,500)},async prepareImage(s){return new Promise(e=>{const t=new Image;t.src=s,this.$nextTick(()=>{t.loaded?e():t.onload=e})})},playmedia(s,e){this.addQueue(s,e)}},mounted(){this.ws=C.wsClient("drawcast"),this.ws.onMessage("init",s=>{this.displayDuration=s.settings.displayDuration,this.displayLatestForever=s.settings.displayLatestForever,this.notificationSound=s.settings.notificationSound,this.displayLatestAutomatically=s.settings.displayLatestAutomatically,!this.displayLatestForever&&this.latestResolved&&(this.imgstyle=null),this.notificationSound&&(this.notificationSoundAudio=new Audio(this.notificationSound.urlpath),this.notificationSoundAudio.volume=this.notificationSound.volume/100),this.images=s.images,this.displayLatestAutomatically&&this.images.length>0&&this.playmedia({image:{url:this.images[0]}},!1)}),this.ws.onMessage("post",s=>{this.images.unshift(s.img),this.images=this.images.slice(0,20),this.playmedia({image:{url:s.img}},!0)}),this.ws.connect()}});function E(s,e,t,i,n,o){return s.imgstyle?(w(),m("div",{key:0,style:p(s.imgstyle)},null,4)):y("",!0)}var I=O(D,[["render",E]]);const M=v(I);M.mount("#app");
