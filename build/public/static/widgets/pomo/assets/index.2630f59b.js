import{d as C,c as d,t as T,a as $,n as I,o as f,b as W}from"./vendor.2507a7c0.js";const A=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}};A();const H=1,m=1e3*H,p=60*m,g=60*p,M=24*g;let w=[];const P=t=>{switch(t){case"error":w=["error"];break;case"info":w=["error","info"];break;case"log":w=["error","info","log"];break;case"debug":w=["error","info","log","debug"];break}};P("info");const b=(t,...s)=>{const e=t,n=o=>(...i)=>{w.includes(o)&&console[o](U("hh:mm:ss",new Date),`[${e}]`,...s,...i)};return{log:n("log"),info:n("info"),debug:n("debug"),error:n("error")}},U=(t,s)=>t.replace(/(hh|mm|ss)/g,(e,n)=>{switch(n){case"hh":return y(s.getHours(),"00");case"mm":return y(s.getMinutes(),"00");case"ss":return y(s.getSeconds(),"00");default:return e}}),y=(t,s)=>{const e=`${t}`;return e.length>=s.length?e:s.substr(0,s.length-e.length)+e},S=(t,s=!1)=>{if(t==="")throw new Error("unable to parse duration");const e=`${t}`.trim();if(!e)throw new Error("unable to parse duration");const n=l=>{if(l<0&&!s)throw new Error("negative value not allowed");return l};if(e.match(/^-?\d+$/))return n(parseInt(e,10));const o=e.match(/^(-?(?:\d*)\.(?:\d*))(d|h|m|s)$/);if(o){const l=parseFloat(o[1]);if(isNaN(l))throw new Error("unable to parse duration");const _=o[2];let u=0;return _==="d"?u=l*M:_==="h"?u=l*g:_==="m"?u=l*p:_==="s"&&(u=l*m),n(Math.round(u))}const i=e.match(/^(-?)(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!i)throw new Error("unable to parse duration");const a=i[1]?-1:1,v=i[2]?parseInt(i[2],10):0,r=i[3]?parseInt(i[3],10):0,c=i[4]?parseInt(i[4],10):0,h=i[5]?parseInt(i[5],10):0,k=i[6]?parseInt(i[6],10):0;return n(a*(h*m+c*p+r*g+v*M+k))},B=(t,s=!1)=>{try{return S(t,s)}catch{return 0}},R=(t,s=["ms","s","m","h","d"])=>{let e=t;const n=Math.floor(e/M);e=e%M;const o=Math.floor(e/g);e=e%g;const i=Math.floor(e/p);e=e%p;const a=Math.floor(e/m);e=e%m;const r=[e,a,i,o,n];let c=0;for(;c<r.length&&r[c]===0;)c++;let h=r.length-1;for(;h>=0&&r[h]===0;)h--;const k=[];for(let l=c;l<=h;l++)k.unshift(`${r[l]}${s[l]}`);return k.join(" ")};function q(t,s,e){if(e>=t.length){let n=e-t.length+1;for(;n--;)t.push(void 0)}return t.splice(e,0,t.splice(s,1)[0]),t}const z=(t,s)=>{const e=[/\$args(?:\((\d*)(:?)(\d*)\))?/g,/\$rand\(\s*(\d+)?\s*,\s*?(\d+)?\s*\)/g,/\$var\(([^)]+)\)/g,/\$user\.name/g,/\$customapi\(([^$)]*)\)\['([A-Za-z0-9_ -]+)'\]/g,/\$customapi\(([^$)]*)\)/g,/\$urlencode\(([^$)]*)\)/g,/\$calc\((\d+)([*/+-])(\d+)\)/g];let n=t,o;do{o=n;for(const i of e)n=n.replace(i,s)}while(o!==n);return n},j=(t,s=",",e=-1)=>{const n=t.split(s);return e===-1||n.length<=e?n:[...n.slice(0,e-1),n.slice(e-1).join(s)]},V=t=>{let s=t.length;for(;s>0;){const e=Math.floor(Math.random()*s);s--;const n=t[s];t[s]=t[e],t[e]=n}return t};function G(t){return{filename:t.originalname,file:t.filename,urlpath:t.urlpath}}function J(t){return{filename:t.originalname,file:t.filename,urlpath:t.urlpath,volume:100}}var E={arrayMove:q,humanDuration:R,parseHumanDuration:B,mustParseHumanDuration:S,doDummyReplacements:z,split:j,shuffle:V,pad:y,mediaFileFromUploadedFile:G,soundMediaFileFromUploadedFile:J};const Q=1001,D=4e3,L=b("WsWrapper.ts");class Y{constructor(s,e){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=s,this.protocols=e}send(s){this.handle?this.handle.send(s):this.sendBuffer.push(s)}connect(){const s=new WebSocket(this.addr,this.protocols);s.onopen=e=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=s;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(e)},s.onmessage=e=>{this.onmessage(e)},s.onclose=e=>{this.handle=null,e.code===D?L.info("custom disconnect, will not reconnect"):e.code===Q?L.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(e)}}disconnect(){this.handle&&this.handle.close(D)}}const N=b("WsClient.ts");class K extends Y{constructor(s,e){super(s,e);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const o=this._parseMessageData(n.data);o.event&&this._dispatch("message",`${o.event}`,o.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(s,e){this.addEventListener("socket",s,e)}onMessage(s,e){this.addEventListener("message",s,e)}addEventListener(s,e,n){const o=Array.isArray(e)?e:[e];this._on[s]=this._on[s]||{};for(const i of o)this._on[s][i]=this._on[s][i]||[],this._on[s][i].push(n)}_parseMessageData(s){try{const e=JSON.parse(s);if(e.event)return{event:e.event,data:e.data||null}}catch(e){N.info(e)}return{event:null,data:null}}_dispatch(s,e,...n){const i=(this._on[s]||{})[e]||[];if(i.length!==0){N.log(`ws dispatch ${s} ${e}`);for(const a of i)a(...n)}}}const O=(t,s)=>`${window[t]!==`{{${t}}}`?window[t]:s}`,Z=O("wsUrl",""),x=O("widgetToken","");var X={wsClient:t=>new K(Z+"/"+t,x)},ee=(t,s)=>{const e=t.__vccOpts||t;for(const[n,o]of s)e[n]=o;return e};const F=100,te=C({data(){return{ws:null,queue:[],worker:null,imgstyle:null,data:null,timeout:null,now:null}},computed:{showTimerWhenFinished(){return this.data?!!this.data.settings.showTimerWhenFinished:!1},finishedText(){return this.data?this.data.settings.finishedText:!1},finishined(){return this.timeLeft<=0},running(){return this.data?!!this.data.state.running:!1},timeLeftHumanReadable(){const t=Math.max(this.timeLeft,0),e=1e3*1,n=60*e,o=60*n,i=E.pad(Math.floor(t/o),"00"),a=E.pad(Math.floor(t%o/n),"00"),v=E.pad(Math.floor(t%o%n/e),"00");let r=this.data.settings.timerFormat;return r=r.replace("{hh}",i),r=r.replace("{mm}",a),r=r.replace("{ss}",v),r},timeLeft(){return!this.dateEnd||!this.now?0:this.dateEnd.getTime()-this.now.getTime()},dateEnd(){return!this.dateStarted||!this.data?null:new Date(this.dateStarted.getTime()+this.data.state.durationMs)},dateStarted(){return this.data?new Date(JSON.parse(this.data.state.startTs)):null},widgetStyles(){return this.data?{fontFamily:this.data.settings.fontFamily,fontSize:this.data.settings.fontSize,color:this.data.settings.color}:{}}},methods:{tick(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.now=new Date,this.data.state.running&&this.tick()},1e3)},async playone(t){return new Promise(async s=>{const e=[];t.file&&e.push(new Promise(n=>{const o=new Audio(t.urlpath);o.addEventListener("ended",()=>{n()});const i=100/100,a=t.volume/100;o.volume=i*a,o.play()})),e.length===0&&e.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(e).then(n=>{this.imgstyle=null,s()})})},addQueue(t){if(this.queue.push(t),this.worker)return;const s=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}const e=this.queue.shift();if(!e){clearInterval(this.worker),this.worker=null;return}await this.playone(e),this.worker=setTimeout(s,F)};this.worker=setTimeout(s,F)},playsound(t){this.addQueue(t)}},mounted(){this.ws=X.wsClient("pomo"),this.ws.onMessage("init",t=>{this.data=t,this.tick()}),this.ws.onMessage("effect",t=>{console.log(t),this.playsound(t.sound)}),this.ws.connect()},unmounted(){this.timeout&&clearTimeout(this.timeout)}}),se={key:0},ne={key:1},oe={key:0},ie={key:1};function re(t,s,e,n,o,i){return t.running?(f(),d("div",{key:0,style:I(t.widgetStyles)},[t.finishined?(f(),d("div",ne,[t.showTimerWhenFinished?(f(),d("span",oe,T(t.timeLeftHumanReadable),1)):$("",!0),t.finishedText?(f(),d("span",ie,T(t.finishedText),1)):$("",!0)])):(f(),d("div",se,T(t.timeLeftHumanReadable),1))],4)):$("",!0)}var ae=ee(te,[["render",re]]);const le=W(ae);le.mount("#app");
