import{d as y,c as M,n as E,a as I,o as T,b as D}from"./vendor.97a40784.js";const b=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}};b();const C=1001,w=4e3;class N{constructor(e,t){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=t}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){let e=new WebSocket(this.addr,this.protocols);e.onopen=t=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(t)},e.onmessage=t=>{this.onmessage(t)},e.onclose=t=>{this.handle=null,t.code===w||t.code===C||(this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3)),this.onclose(t)}}disconnect(){this.handle&&this.handle.close(w)}}const O=(...s)=>console.log("[WsClient.ts]",...s);class S extends N{constructor(e,t){super(e,t);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const r=this._parseMessageData(n.data);r.event&&this._dispatch("message",r.event,r.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(e,t){this.addEventListener("socket",e,t)}onMessage(e,t){this.addEventListener("message",e,t)}addEventListener(e,t,n){const r=Array.isArray(t)?t:[t];this._on[e]=this._on[e]||{};for(const o of r)this._on[e][o]=this._on[e][o]||[],this._on[e][o].push(n)}_parseMessageData(e){try{const t=JSON.parse(e);if(t.event)return{event:t.event,data:t.data||null}}catch{}return{event:null,data:null}}_dispatch(e,t,...n){const o=(this._on[e]||{})[t]||[];if(o.length!==0){O(`ws dispatch ${e} ${t}`);for(const i of o)i(...n)}}}const P=1,d=1e3*P,m=60*d,p=60*m,g=24*p,_=s=>{if(s==="")throw new Error("unable to parse duration");const e=`${s}`.trim();if(!e)throw new Error("unable to parse duration");if(e.match(/^\d+$/))return parseInt(e,10);const t=e.match(/^((?:\d*)\.(?:\d*))(d|h|m|s)$/);if(t){const a=parseFloat(t[1]);if(isNaN(a))throw new Error("unable to parse duration");const c=t[2];let u=0;return c==="d"?u=a*g:c==="h"?u=a*p:c==="m"?u=a*m:c==="s"&&(u=a*d),Math.round(u)}const n=e.match(/^(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!n)throw new Error("unable to parse duration");const r=n[1]?parseInt(n[1],10):0,o=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,h=n[4]?parseInt(n[4],10):0,l=n[5]?parseInt(n[5],10):0;return h*d+i*m+o*p+r*g+l},x=s=>{try{return _(s)}catch{return 0}},A=s=>{let e=s;const t=Math.floor(e/g);e=e%g;const n=Math.floor(e/p);e=e%p;const r=Math.floor(e/m);e=e%m;const o=Math.floor(e/d);e=e%d;const i=e,h=["ms","s","m","h","d"],l=[i,o,r,n,t];let a=0;for(;a<l.length&&l[a]===0;)a++;let c=l.length-1;for(;c>=0&&l[c]===0;)c--;const u=[];for(let f=a;f<=c;f++)u.unshift(`${l[f]}${h[f]}`);return u.join(" ")};function L(s,e,t){if(t>=s.length)for(var n=t-s.length+1;n--;)s.push(void 0);return s.splice(t,0,s.splice(e,1)[0]),s}const U=(s,e)=>{const t=[{regex:/\$args\((\d*)(:?)(\d*)\)/g,replacer:(o,i)=>e},{regex:/\$rand\((\d+),(\d+)\)/g,replacer:(o,i,h)=>e},{regex:/\$var\(([^)]+)\)/g,replacer:(o,i)=>e},{regex:/\$user\.name/g,replacer:()=>e},{regex:/\$([a-z][a-z0-9]*)(?!\()/g,replacer:(o,i)=>o},{regex:/\$customapi\(([^$\)]*)\)\[\'([A-Za-z0-9_ -]+)\'\]/g,replacer:(o,i,h)=>e},{regex:/\$customapi\(([^$\)]*)\)/g,replacer:(o,i)=>e},{regex:/\$urlencode\(([^$\)]*)\)/g,replacer:(o,i)=>e},{regex:/\$calc\((\d+)([*/+-])(\d+)\)/g,replacer:(o,i,h,l)=>e}];let n=s,r;do{r=n;for(let o of t)n=n.replace(o.regex,o.replacer)}while(r!==n);return n},B=(s,e=",",t=-1)=>{const n=s.split(e);return t===-1||n.length<=t?n:[...n.slice(0,t-1),n.slice(t-1).join(e)]},W=s=>{let e=s.length;for(;e>0;){let t=Math.floor(Math.random()*e);e--;let n=s[e];s[e]=s[t],s[t]=n}return s};var R={arrayMove:L,humanDuration:A,parseHumanDuration:x,mustParseHumanDuration:_,doDummyReplacements:U,split:B,shuffle:W},q=(s,e)=>{const t=s.__vccOpts||s;for(const[n,r]of e)t[n]=r;return t};const v=(s,e)=>`${window[s]!==`{{${s}}}`?window[s]:e}`,$=v("wsUrl","/general");console.log($);const z=v("widgetToken",""),k=100,H=y({data(){return{ws:null,queue:[],worker:null,imgstyle:"",settings:{volume:100}}},methods:{async playone(s){return new Promise(async e=>{const t=[];s.image&&s.image.file&&(await this.prepareImage(s.image.file),this.imgstyle={backgroundImage:`url(/uploads/${encodeURIComponent(s.image.file)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",height:"100%"}),s.minDurationMs&&t.push(new Promise(n=>{setTimeout(n,R.parseHumanDuration(s.minDurationMs))})),s.sound&&s.sound.file&&t.push(new Promise(n=>{const r=new Audio(`/uploads/${encodeURIComponent(s.sound.file)}`);r.addEventListener("ended",()=>{n()});const o=this.settings.volume/100,i=s.sound.volume/100;r.volume=o*i,r.play()})),t.length===0&&t.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(t).then(n=>{this.imgstyle="",e()})})},addQueue(s){if(this.queue.push(s),this.worker)return;const e=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}await this.playone(this.queue.shift()),this.worker=setTimeout(e,k)};this.worker=setTimeout(e,k)},async prepareImage(s){return new Promise(e=>{const t=new Image;t.src="/uploads/"+encodeURIComponent(s),this.$nextTick(()=>{t.loaded?e():t.onload=e})})},playmedia(s){this.addQueue(s)}},mounted(){this.ws=new S($,z),this.ws.onMessage("init",s=>{this.settings=s.settings}),this.ws.onMessage("playmedia",s=>{this.playmedia(s)}),this.ws.connect()}});function j(s,e,t,n,r,o){return s.imgstyle?(T(),M("div",{key:0,style:E(s.imgstyle)},null,4)):I("",!0)}var V=q(H,[["render",j]]);const F=D(V);F.mount("#app");
