import{d as I,c as D,n as T,a as C,o as N,b as O}from"./vendor.11985ee1.js";const S=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}};S();const L=1,h=1e3*L,d=60*h,f=60*d,p=24*f;let m=[];const P=s=>{switch(s){case"error":m=["error"];break;case"info":m=["error","info"];break;case"log":m=["error","info","log"];break;case"debug":m=["error","info","log","debug"];break}};P("info");const v=(s,...e)=>{const t=s,n=o=>(...r)=>{m.includes(o)&&console[o](A("hh:mm:ss",new Date),`[${t}]`,...e,...r)};return{log:n("log"),info:n("info"),debug:n("debug"),error:n("error")}},A=(s,e)=>s.replace(/(hh|mm|ss)/g,(t,n)=>{switch(n){case"hh":return w(e.getHours(),"00");case"mm":return w(e.getMinutes(),"00");case"ss":return w(e.getSeconds(),"00");default:return t}}),w=(s,e)=>{const t=`${s}`;return t.length>=e.length?t:e.substr(0,e.length-t.length)+t},_=s=>{if(s==="")throw new Error("unable to parse duration");const e=`${s}`.trim();if(!e)throw new Error("unable to parse duration");if(e.match(/^\d+$/))return parseInt(e,10);const t=e.match(/^((?:\d*)\.(?:\d*))(d|h|m|s)$/);if(t){const c=parseFloat(t[1]);if(isNaN(c))throw new Error("unable to parse duration");const a=t[2];let l=0;return a==="d"?l=c*p:a==="h"?l=c*f:a==="m"?l=c*d:a==="s"&&(l=c*h),Math.round(l)}const n=e.match(/^(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!n)throw new Error("unable to parse duration");const o=n[1]?parseInt(n[1],10):0,r=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,$=n[4]?parseInt(n[4],10):0,u=n[5]?parseInt(n[5],10):0;return $*h+i*d+r*f+o*p+u},W=s=>{try{return _(s)}catch{return 0}},U=s=>{let e=s;const t=Math.floor(e/p);e=e%p;const n=Math.floor(e/f);e=e%f;const o=Math.floor(e/d);e=e%d;const r=Math.floor(e/h);e=e%h;const i=e,$=["ms","s","m","h","d"],u=[i,r,o,n,t];let c=0;for(;c<u.length&&u[c]===0;)c++;let a=u.length-1;for(;a>=0&&u[a]===0;)a--;const l=[];for(let g=c;g<=a;g++)l.unshift(`${u[g]}${$[g]}`);return l.join(" ")};function B(s,e,t){if(t>=s.length){let n=t-s.length+1;for(;n--;)s.push(void 0)}return s.splice(t,0,s.splice(e,1)[0]),s}const H=(s,e)=>{const t=[/\$args(?:\((\d*)(:?)(\d*)\))?/g,/\$rand\(\s*(\d+)?\s*,\s*?(\d+)?\s*\)/g,/\$var\(([^)]+)\)/g,/\$user\.name/g,/\$customapi\(([^$)]*)\)\['([A-Za-z0-9_ -]+)'\]/g,/\$customapi\(([^$)]*)\)/g,/\$urlencode\(([^$)]*)\)/g,/\$calc\((\d+)([*/+-])(\d+)\)/g];let n=s,o;do{o=n;for(const r of t)n=n.replace(r,e)}while(o!==n);return n},R=(s,e=",",t=-1)=>{const n=s.split(e);return t===-1||n.length<=t?n:[...n.slice(0,t-1),n.slice(t-1).join(e)]},q=s=>{let e=s.length;for(;e>0;){const t=Math.floor(Math.random()*e);e--;const n=s[e];s[e]=s[t],s[t]=n}return s};var j={arrayMove:B,humanDuration:U,parseHumanDuration:W,mustParseHumanDuration:_,doDummyReplacements:H,split:R,shuffle:q,pad:w};const z=1001,k=4e3,b=v("WsWrapper.ts");class V{constructor(e,t){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=t}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){const e=new WebSocket(this.addr,this.protocols);e.onopen=t=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(t)},e.onmessage=t=>{this.onmessage(t)},e.onclose=t=>{this.handle=null,t.code===k?b.info("custom disconnect, will not reconnect"):t.code===z?b.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(t)}}disconnect(){this.handle&&this.handle.close(k)}}const y=v("WsClient.ts");class x extends V{constructor(e,t){super(e,t);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const o=this._parseMessageData(n.data);o.event&&this._dispatch("message",`${o.event}`,o.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(e,t){this.addEventListener("socket",e,t)}onMessage(e,t){this.addEventListener("message",e,t)}addEventListener(e,t,n){const o=Array.isArray(t)?t:[t];this._on[e]=this._on[e]||{};for(const r of o)this._on[e][r]=this._on[e][r]||[],this._on[e][r].push(n)}_parseMessageData(e){try{const t=JSON.parse(e);if(t.event)return{event:t.event,data:t.data||null}}catch(t){y.info(t)}return{event:null,data:null}}_dispatch(e,t,...n){const r=(this._on[e]||{})[t]||[];if(r.length!==0){y.log(`ws dispatch ${e} ${t}`);for(const i of r)i(...n)}}}const M=(s,e)=>`${window[s]!==`{{${s}}}`?window[s]:e}`,F=M("wsUrl",""),G=M("widgetToken","");var Q={wsClient:s=>new x(F+"/"+s,G)},Y=(s,e)=>{const t=s.__vccOpts||s;for(const[n,o]of e)t[n]=o;return t};const E=100,J=I({data(){return{ws:null,queue:[],worker:null,imgstyle:"",settings:{volume:100}}},methods:{async playone(s){return new Promise(async e=>{const t=[];s.image&&s.image.file&&(await this.prepareImage(s.image.file),this.imgstyle={backgroundImage:`url(/uploads/${encodeURIComponent(s.image.file)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",height:"100%"}),s.minDurationMs&&t.push(new Promise(n=>{setTimeout(n,j.parseHumanDuration(s.minDurationMs))})),s.sound&&s.sound.file&&t.push(new Promise(n=>{const o=new Audio(`/uploads/${encodeURIComponent(s.sound.file)}`);o.addEventListener("ended",()=>{n()});const r=this.settings.volume/100,i=s.sound.volume/100;o.volume=r*i,o.play()})),t.length===0&&t.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(t).then(n=>{this.imgstyle="",e()})})},addQueue(s){if(this.queue.push(s),this.worker)return;const e=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}await this.playone(this.queue.shift()),this.worker=setTimeout(e,E)};this.worker=setTimeout(e,E)},async prepareImage(s){return new Promise(e=>{const t=new Image;t.src="/uploads/"+encodeURIComponent(s),this.$nextTick(()=>{t.loaded?e():t.onload=e})})},playmedia(s){this.addQueue(s)}},mounted(){this.ws=Q.wsClient("general"),this.ws.onMessage("init",s=>{this.settings=s.settings}),this.ws.onMessage("playmedia",s=>{this.playmedia(s)}),this.ws.connect()}});function K(s,e,t,n,o,r){return s.imgstyle?(N(),D("div",{key:0,style:T(s.imgstyle)},null,4)):C("",!0)}var Z=Y(J,[["render",K]]);const X=O(Z);X.mount("#app");
