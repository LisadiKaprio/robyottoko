import{d as D,c as T,n as I,a as N,o as O,b as S}from"./vendor.11985ee1.js";const C=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=s(o);fetch(o.href,r)}};C();const L=1,h=1e3*L,d=60*h,f=60*d,p=24*f;let m=[];const P=t=>{switch(t){case"error":m=["error"];break;case"info":m=["error","info"];break;case"log":m=["error","info","log"];break;case"debug":m=["error","info","log","debug"];break}};P("info");const k=(t,...e)=>{const s=t,n=o=>(...r)=>{m.includes(o)&&console[o](A("hh:mm:ss",new Date),`[${s}]`,...e,...r)};return{log:n("log"),info:n("info"),debug:n("debug"),error:n("error")}},A=(t,e)=>t.replace(/(hh|mm|ss)/g,(s,n)=>{switch(n){case"hh":return w(e.getHours(),"00");case"mm":return w(e.getMinutes(),"00");case"ss":return w(e.getSeconds(),"00");default:return s}}),w=(t,e)=>{const s=`${t}`;return s.length>=e.length?s:e.substr(0,e.length-s.length)+s},_=t=>{if(t==="")throw new Error("unable to parse duration");const e=`${t}`.trim();if(!e)throw new Error("unable to parse duration");if(e.match(/^\d+$/))return parseInt(e,10);const s=e.match(/^((?:\d*)\.(?:\d*))(d|h|m|s)$/);if(s){const a=parseFloat(s[1]);if(isNaN(a))throw new Error("unable to parse duration");const l=s[2];let c=0;return l==="d"?c=a*p:l==="h"?c=a*f:l==="m"?c=a*d:l==="s"&&(c=a*h),Math.round(c)}const n=e.match(/^(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!n)throw new Error("unable to parse duration");const o=n[1]?parseInt(n[1],10):0,r=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,v=n[4]?parseInt(n[4],10):0,u=n[5]?parseInt(n[5],10):0;return v*h+i*d+r*f+o*p+u},W=t=>{try{return _(t)}catch{return 0}},F=t=>{let e=t;const s=Math.floor(e/p);e=e%p;const n=Math.floor(e/f);e=e%f;const o=Math.floor(e/d);e=e%d;const r=Math.floor(e/h);e=e%h;const i=e,v=["ms","s","m","h","d"],u=[i,r,o,n,s];let a=0;for(;a<u.length&&u[a]===0;)a++;let l=u.length-1;for(;l>=0&&u[l]===0;)l--;const c=[];for(let g=a;g<=l;g++)c.unshift(`${u[g]}${v[g]}`);return c.join(" ")};function B(t,e,s){if(s>=t.length){let n=s-t.length+1;for(;n--;)t.push(void 0)}return t.splice(s,0,t.splice(e,1)[0]),t}const U=(t,e)=>{const s=[/\$args(?:\((\d*)(:?)(\d*)\))?/g,/\$rand\(\s*(\d+)?\s*,\s*?(\d+)?\s*\)/g,/\$var\(([^)]+)\)/g,/\$user\.name/g,/\$customapi\(([^$)]*)\)\['([A-Za-z0-9_ -]+)'\]/g,/\$customapi\(([^$)]*)\)/g,/\$urlencode\(([^$)]*)\)/g,/\$calc\((\d+)([*/+-])(\d+)\)/g];let n=t,o;do{o=n;for(const r of s)n=n.replace(r,e)}while(o!==n);return n},H=(t,e=",",s=-1)=>{const n=t.split(e);return s===-1||n.length<=s?n:[...n.slice(0,s-1),n.slice(s-1).join(e)]},q=t=>{let e=t.length;for(;e>0;){const s=Math.floor(Math.random()*e);e--;const n=t[e];t[e]=t[s],t[s]=n}return t};function j(t){return{filename:t.originalname,file:t.filename,urlpath:t.urlpath}}function z(t){return{filename:t.originalname,file:t.filename,urlpath:t.urlpath,volume:100}}var R={arrayMove:B,humanDuration:F,parseHumanDuration:W,mustParseHumanDuration:_,doDummyReplacements:U,split:H,shuffle:q,pad:w,mediaFileFromUploadedFile:j,soundMediaFileFromUploadedFile:z};const V=1001,$=4e3,b=k("WsWrapper.ts");class x{constructor(e,s){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=s}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){const e=new WebSocket(this.addr,this.protocols);e.onopen=s=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(s)},e.onmessage=s=>{this.onmessage(s)},e.onclose=s=>{this.handle=null,s.code===$?b.info("custom disconnect, will not reconnect"):s.code===V?b.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(s)}}disconnect(){this.handle&&this.handle.close($)}}const y=k("WsClient.ts");class G extends x{constructor(e,s){super(e,s);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const o=this._parseMessageData(n.data);o.event&&this._dispatch("message",`${o.event}`,o.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(e,s){this.addEventListener("socket",e,s)}onMessage(e,s){this.addEventListener("message",e,s)}addEventListener(e,s,n){const o=Array.isArray(s)?s:[s];this._on[e]=this._on[e]||{};for(const r of o)this._on[e][r]=this._on[e][r]||[],this._on[e][r].push(n)}_parseMessageData(e){try{const s=JSON.parse(e);if(s.event)return{event:s.event,data:s.data||null}}catch(s){y.info(s)}return{event:null,data:null}}_dispatch(e,s,...n){const r=(this._on[e]||{})[s]||[];if(r.length!==0){y.log(`ws dispatch ${e} ${s}`);for(const i of r)i(...n)}}}const M=(t,e)=>`${window[t]!==`{{${t}}}`?window[t]:e}`,Q=M("wsUrl",""),Y=M("widgetToken","");var J={wsClient:t=>new G(Q+"/"+t,Y)};const K=()=>({volume:100});var Z=(t,e)=>{const s=t.__vccOpts||t;for(const[n,o]of e)s[n]=o;return s};const E=100,X=D({data(){return{ws:null,queue:[],worker:null,imgstyle:null,settings:K()}},methods:{async playone(t){return new Promise(async e=>{const s=[];t.image&&t.image.file&&(await this.prepareImage(t.image.urlpath),this.imgstyle={backgroundImage:`url(${t.image.urlpath})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",height:"100%"}),t.minDurationMs&&s.push(new Promise(n=>{setTimeout(n,R.parseHumanDuration(t.minDurationMs))})),t.sound&&t.sound.file&&s.push(new Promise(n=>{const o=new Audio(t.sound.urlpath);o.addEventListener("ended",()=>{n()});const r=this.settings.volume/100,i=t.sound.volume/100;o.volume=r*i,o.play()})),s.length===0&&s.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(s).then(n=>{this.imgstyle=null,e()})})},addQueue(t){if(this.queue.push(t),this.worker)return;const e=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}const s=this.queue.shift();if(!s){clearInterval(this.worker),this.worker=null;return}await this.playone(s),this.worker=setTimeout(e,E)};this.worker=setTimeout(e,E)},async prepareImage(t){return new Promise(e=>{const s=new Image;s.src=t,this.$nextTick(()=>{s.loaded?e():s.onload=e})})},playmedia(t){this.addQueue(t)}},mounted(){this.ws=J.wsClient("general"),this.ws.onMessage("init",t=>{this.settings=t.settings}),this.ws.onMessage("playmedia",t=>{this.playmedia(t)}),this.ws.connect()}});function ee(t,e,s,n,o,r){return t.imgstyle?(O(),T("div",{key:0,style:I(t.imgstyle)},null,4)):N("",!0)}var te=Z(X,[["render",ee]]);const se=S(te);se.mount("#app");
