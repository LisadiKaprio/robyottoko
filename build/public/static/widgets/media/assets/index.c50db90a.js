import{d as L,c as M,a as $,n as O,b as F,e as B,F as S,o as y,r as P,f as q,g as A}from"./vendor.6424a435.js";const V=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}};V();const W=1,m=1e3*W,f=60*m,p=60*f,v=24*p;let d=[];const U=t=>{switch(t){case"error":d=["error"];break;case"info":d=["error","info"];break;case"log":d=["error","info","log"];break;case"debug":d=["error","info","log","debug"];break}};U("info");const D=(t,...s)=>{const e=t,n=o=>(...r)=>{d.includes(o)&&console[o](R("hh:mm:ss",new Date),`[${e}]`,...s,...r)};return{log:n("log"),info:n("info"),debug:n("debug"),error:n("error")}},H=t=>[...t].length,R=(t,s)=>t.replace(/(hh|mm|ss)/g,(e,n)=>{switch(n){case"hh":return _(s.getHours(),"00");case"mm":return _(s.getMinutes(),"00");case"ss":return _(s.getSeconds(),"00");default:return e}}),_=(t,s)=>{const e=`${t}`;return e.length>=s.length?e:s.substr(0,s.length-e.length)+e},N=(t,s=!1)=>{if(t==="")throw new Error("unable to parse duration");const e=`${t}`.trim();if(!e)throw new Error("unable to parse duration");const n=a=>{if(a<0&&!s)throw new Error("negative value not allowed");return a};if(e.match(/^-?\d+$/))return n(parseInt(e,10));const o=e.match(/^(-?(?:\d*)\.(?:\d*))(d|h|m|s)$/);if(o){const a=parseFloat(o[1]);if(isNaN(a))throw new Error("unable to parse duration");const w=o[2];let h=0;return w==="d"?h=a*v:w==="h"?h=a*p:w==="m"?h=a*f:w==="s"&&(h=a*m),n(Math.round(h))}const r=e.match(/^(-?)(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!r)throw new Error("unable to parse duration");const i=r[1]?-1:1,k=r[2]?parseInt(r[2],10):0,l=r[3]?parseInt(r[3],10):0,c=r[4]?parseInt(r[4],10):0,u=r[5]?parseInt(r[5],10):0,g=r[6]?parseInt(r[6],10):0;return n(i*(u*m+c*f+l*p+k*v+g))},Q=(t,s=!1)=>{try{return N(t,s)}catch{return 0}},z=(t,s=["ms","s","m","h","d"])=>{let e=t;const n=Math.floor(e/v);e=e%v;const o=Math.floor(e/p);e=e%p;const r=Math.floor(e/f);e=e%f;const i=Math.floor(e/m);e=e%m;const l=[e,i,r,o,n];let c=0;for(;c<l.length&&l[c]===0;)c++;let u=l.length-1;for(;u>=0&&l[u]===0;)u--;const g=[];for(let a=c;a<=u;a++)g.unshift(`${l[a]}${s[a]}`);return g.join(" ")};function j(t,s,e){if(e>=t.length){let n=e-t.length+1;for(;n--;)t.push(void 0)}return t.splice(e,0,t.splice(s,1)[0]),t}const G=(t,s)=>{const e=[/\$args(?:\((\d*)(:?)(\d*)\))?/g,/\$rand\(\s*(\d+)?\s*,\s*?(\d+)?\s*\)/g,/\$var\(([^)]+)\)/g,/\$user(?:\(([^)]+)\)|())\.(name|profile_image_url|recent_clip_url|last_stream_category)/g,/\$customapi\(([^$)]*)\)\['([A-Za-z0-9_ -]+)'\]/g,/\$customapi\(([^$)]*)\)/g,/\$urlencode\(([^$)]*)\)/g,/\$calc\((\d+)([*/+-])(\d+)\)/g];let n=t,o;do{o=n;for(const r of e)n=n.replace(r,s)}while(o!==n);return n},Y=(t,s=",",e=-1)=>{const n=t.split(s);return e===-1||n.length<=e?n:[...n.slice(0,e-1),n.slice(e-1).join(s)]},x=t=>{let s=t.length;for(;s>0;){const e=Math.floor(Math.random()*s);s--;const n=t[s];t[s]=t[e],t[e]=n}return t};function J(t){return{filename:t.originalname,file:t.filename,urlpath:t.urlpath}}function K(t){return{filename:t.originalname,file:t.filename,urlpath:t.urlpath,volume:100}}var Z={unicodeLength:H,arrayMove:j,humanDuration:z,parseHumanDuration:Q,mustParseHumanDuration:N,doDummyReplacements:G,split:Y,shuffle:x,pad:_,mediaFileFromUploadedFile:J,soundMediaFileFromUploadedFile:K};var T=(t,s)=>{const e=t.__vccOpts||t;for(const[n,o]of s)e[n]=o;return e};const X=L({props:{timeBetweenMediaMs:{type:Number,default:400},baseVolume:{type:Number,default:100},displayLatestForever:{type:Boolean,default:!1}},data(){return{queue:[],worker:null,showimage:!1,imgstyle:null,videosrc:"",latestResolved:!0}},methods:{async _playone(t){return new Promise(async s=>{this.latestResolved=!1;const e=[];t.twitch_clip.url&&(this.videosrc=t.twitch_clip.url,e.push(new Promise(n=>{this.$nextTick(()=>{this.$refs.video.volume=t.twitch_clip.volume?100/t.twitch_clip.volume:0,this.$refs.video.addEventListener("ended",()=>{n()})})}))),t.image_url?(this.showimage=!0,this.imgstyle={backgroundImage:`url(${t.image_url})`}):t.image&&t.image.file&&(await this._prepareImage(t.image.urlpath),this.showimage=!0,this.imgstyle={backgroundImage:`url(${t.image.urlpath})`}),t.minDurationMs&&e.push(new Promise(n=>{setTimeout(n,Z.parseHumanDuration(t.minDurationMs))})),t.sound&&t.sound.file&&e.push(new Promise(n=>{const o=new Audio(t.sound.urlpath);o.addEventListener("ended",()=>{n()});const r=this.baseVolume/100,i=t.sound.volume/100;o.volume=r*i,o.play()})),e.length===0&&e.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(e).then(n=>{this.displayLatestForever||(this.showimage=!1),this.latestResolved=!0,this.videosrc="",s()})})},_addQueue(t){if(this.queue.push(t),this.worker)return;const s=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}const e=this.queue.shift();if(!e){clearInterval(this.worker),this.worker=null;return}await this._playone(e),this.worker=setTimeout(s,this.timeBetweenMediaMs)};this.worker=setTimeout(s,this.timeBetweenMediaMs)},async _prepareImage(t){return new Promise(s=>{const e=new Image;e.src=t,this.$nextTick(()=>{e.loaded?s():e.onload=s})})},playmedia(t){!this.displayLatestForever&&this.latestResolved&&(this.showimage=!1),this._addQueue(t)}}}),ee={key:0,class:"video-container"},te={class:"video-16-9"},se=["src"];function ne(t,s,e,n,o,r){return y(),M(S,null,[$("div",{style:O(t.imgstyle),class:F(["image-container",{"m-fadeIn":t.showimage,"m-fadeOut":!t.showimage}])},null,6),t.videosrc?(y(),M("div",ee,[$("div",te,[$("video",{src:t.videosrc,ref:"video",autoplay:""},null,8,se)])])):B("",!0)],64)}var oe=T(X,[["render",ne],["__scopeId","data-v-3ece661a"]]);const re=1001,b=4e3,E=D("WsWrapper.ts");class ie{constructor(s,e){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=s,this.protocols=e}send(s){this.handle?this.handle.send(s):this.sendBuffer.push(s)}connect(){const s=new WebSocket(this.addr,this.protocols);s.onopen=e=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=s;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(e)},s.onmessage=e=>{this.onmessage(e)},s.onclose=e=>{this.handle=null,e.code===b?E.info("custom disconnect, will not reconnect"):e.code===re?E.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(e)}}disconnect(){this.handle&&this.handle.close(b)}}const I=D("WsClient.ts");class ae extends ie{constructor(s,e){super(s,e);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const o=this._parseMessageData(n.data);o.event&&this._dispatch("message",`${o.event}`,o.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(s,e){this.addEventListener("socket",s,e)}onMessage(s,e){this.addEventListener("message",s,e)}addEventListener(s,e,n){const o=Array.isArray(e)?e:[e];this._on[s]=this._on[s]||{};for(const r of o)this._on[s][r]=this._on[s][r]||[],this._on[s][r].push(n)}_parseMessageData(s){try{const e=JSON.parse(s);if(e.event)return{event:e.event,data:e.data||null}}catch(e){I.info(e)}return{event:null,data:null}}_dispatch(s,e,...n){const r=(this._on[s]||{})[e]||[];if(r.length!==0){I.log(`ws dispatch ${s} ${e}`);for(const i of r)i(...n)}}}const C=(t,s)=>`${window[t]!==`{{${t}}}`?window[t]:s}`,le=C("wsUrl",""),ce=C("widgetToken","");var ue={wsClient:t=>new ae(le+"/"+t,ce)};const he=()=>({volume:100}),de=L({components:{MediaQueueElement:oe},data(){return{ws:null,settings:he()}},mounted(){this.ws=ue.wsClient("general"),this.ws.onMessage("init",t=>{this.settings=t.settings}),this.ws.onMessage("playmedia",t=>{this.$refs.q.playmedia(t)}),this.ws.connect()}});function me(t,s,e,n,o,r){const i=P("media-queue-element");return y(),q(i,{ref:"q",baseVolume:t.settings.volume},null,8,["baseVolume"])}var fe=T(de,[["render",me]]);const pe=A(fe);pe.mount("#app");
