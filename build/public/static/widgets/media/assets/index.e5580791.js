import{d as k,c as y,n as M,a as E,o as I,b as T}from"./vendor.97a40784.js";const D=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}};D();const b=1001,w=4e3;class C{constructor(e,s){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=s}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){let e=new WebSocket(this.addr,this.protocols);e.onopen=s=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(s)},e.onmessage=s=>{this.onmessage(s)},e.onclose=s=>{this.handle=null,s.code===w||s.code===b||(this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3)),this.onclose(s)}}disconnect(){this.handle&&this.handle.close(w)}}const N=(...t)=>console.log("[WsClient.ts]",...t);class O extends C{constructor(e,s){super(e,s);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const r=this._parseMessageData(n.data);r.event&&this._dispatch("message",r.event,r.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(e,s){this.addEventListener("socket",e,s)}onMessage(e,s){this.addEventListener("message",e,s)}addEventListener(e,s,n){const r=Array.isArray(s)?s:[s];this._on[e]=this._on[e]||{};for(const o of r)this._on[e][o]=this._on[e][o]||[],this._on[e][o].push(n)}_parseMessageData(e){try{const s=JSON.parse(e);if(s.event)return{event:s.event,data:s.data||null}}catch{}return{event:null,data:null}}_dispatch(e,s,...n){const o=(this._on[e]||{})[s]||[];if(o.length!==0){N(`ws dispatch ${e} ${s}`);for(const i of o)i(...n)}}}const v=(t,e)=>`${window[t]!==`{{${t}}}`?window[t]:e}`,S=v("wsUrl",""),P=v("widgetToken","");var x={wsClient:t=>new O(S+"/"+t,P)};const A=1,d=1e3*A,m=60*d,p=60*m,g=24*p,_=t=>{if(t==="")throw new Error("unable to parse duration");const e=`${t}`.trim();if(!e)throw new Error("unable to parse duration");if(e.match(/^\d+$/))return parseInt(e,10);const s=e.match(/^((?:\d*)\.(?:\d*))(d|h|m|s)$/);if(s){const a=parseFloat(s[1]);if(isNaN(a))throw new Error("unable to parse duration");const c=s[2];let u=0;return c==="d"?u=a*g:c==="h"?u=a*p:c==="m"?u=a*m:c==="s"&&(u=a*d),Math.round(u)}const n=e.match(/^(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!n)throw new Error("unable to parse duration");const r=n[1]?parseInt(n[1],10):0,o=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,h=n[4]?parseInt(n[4],10):0,l=n[5]?parseInt(n[5],10):0;return h*d+i*m+o*p+r*g+l},L=t=>{try{return _(t)}catch{return 0}},U=t=>{let e=t;const s=Math.floor(e/g);e=e%g;const n=Math.floor(e/p);e=e%p;const r=Math.floor(e/m);e=e%m;const o=Math.floor(e/d);e=e%d;const i=e,h=["ms","s","m","h","d"],l=[i,o,r,n,s];let a=0;for(;a<l.length&&l[a]===0;)a++;let c=l.length-1;for(;c>=0&&l[c]===0;)c--;const u=[];for(let f=a;f<=c;f++)u.unshift(`${l[f]}${h[f]}`);return u.join(" ")};function B(t,e,s){if(s>=t.length)for(var n=s-t.length+1;n--;)t.push(void 0);return t.splice(s,0,t.splice(e,1)[0]),t}const W=(t,e)=>{const s=[{regex:/\$args\((\d*)(:?)(\d*)\)/g,replacer:(o,i)=>e},{regex:/\$rand\((\d+),(\d+)\)/g,replacer:(o,i,h)=>e},{regex:/\$var\(([^)]+)\)/g,replacer:(o,i)=>e},{regex:/\$user\.name/g,replacer:()=>e},{regex:/\$([a-z][a-z0-9]*)(?!\()/g,replacer:(o,i)=>o},{regex:/\$customapi\(([^$\)]*)\)\[\'([A-Za-z0-9_ -]+)\'\]/g,replacer:(o,i,h)=>e},{regex:/\$customapi\(([^$\)]*)\)/g,replacer:(o,i)=>e},{regex:/\$urlencode\(([^$\)]*)\)/g,replacer:(o,i)=>e},{regex:/\$calc\((\d+)([*/+-])(\d+)\)/g,replacer:(o,i,h,l)=>e}];let n=t,r;do{r=n;for(let o of s)n=n.replace(o.regex,o.replacer)}while(r!==n);return n},R=(t,e=",",s=-1)=>{const n=t.split(e);return s===-1||n.length<=s?n:[...n.slice(0,s-1),n.slice(s-1).join(e)]},q=t=>{let e=t.length;for(;e>0;){let s=Math.floor(Math.random()*e);e--;let n=t[e];t[e]=t[s],t[s]=n}return t};var z={arrayMove:B,humanDuration:U,parseHumanDuration:L,mustParseHumanDuration:_,doDummyReplacements:W,split:R,shuffle:q},H=(t,e)=>{const s=t.__vccOpts||t;for(const[n,r]of e)s[n]=r;return s};const $=100,j=k({data(){return{ws:null,queue:[],worker:null,imgstyle:"",settings:{volume:100}}},methods:{async playone(t){return new Promise(async e=>{const s=[];t.image&&t.image.file&&(await this.prepareImage(t.image.file),this.imgstyle={backgroundImage:`url(/uploads/${encodeURIComponent(t.image.file)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",height:"100%"}),t.minDurationMs&&s.push(new Promise(n=>{setTimeout(n,z.parseHumanDuration(t.minDurationMs))})),t.sound&&t.sound.file&&s.push(new Promise(n=>{const r=new Audio(`/uploads/${encodeURIComponent(t.sound.file)}`);r.addEventListener("ended",()=>{n()});const o=this.settings.volume/100,i=t.sound.volume/100;r.volume=o*i,r.play()})),s.length===0&&s.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(s).then(n=>{this.imgstyle="",e()})})},addQueue(t){if(this.queue.push(t),this.worker)return;const e=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}await this.playone(this.queue.shift()),this.worker=setTimeout(e,$)};this.worker=setTimeout(e,$)},async prepareImage(t){return new Promise(e=>{const s=new Image;s.src="/uploads/"+encodeURIComponent(t),this.$nextTick(()=>{s.loaded?e():s.onload=e})})},playmedia(t){this.addQueue(t)}},mounted(){this.ws=x.wsClient("general"),this.ws.onMessage("init",t=>{this.settings=t.settings}),this.ws.onMessage("playmedia",t=>{this.playmedia(t)}),this.ws.connect()}});function V(t,e,s,n,r,o){return t.imgstyle?(I(),y("div",{key:0,style:M(t.imgstyle)},null,4)):E("",!0)}var F=H(j,[["render",V]]);const G=T(F);G.mount("#app");
