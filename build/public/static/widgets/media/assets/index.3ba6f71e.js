import{d as k,c as y,n as M,a as E,o as I,b as T}from"./vendor.97a40784.js";const D=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}};D();const b=1001,w=4e3;class C{constructor(e,s){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=s}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){let e=new WebSocket(this.addr,this.protocols);e.onopen=s=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(s)},e.onmessage=s=>{this.onmessage(s)},e.onclose=s=>{this.handle=null,s.code===w||s.code===b||(this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3)),this.onclose(s)}}disconnect(){this.handle&&this.handle.close(w)}}const N=(...t)=>console.log("[WsClient.ts]",...t);class O extends C{constructor(e,s){super(e,s);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const o=this._parseMessageData(n.data);o.event&&this._dispatch("message",o.event,o.data)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(e,s){this.addEventListener("socket",e,s)}onMessage(e,s){this.addEventListener("message",e,s)}addEventListener(e,s,n){const o=Array.isArray(s)?s:[s];this._on[e]=this._on[e]||{};for(const i of o)this._on[e][i]=this._on[e][i]||[],this._on[e][i].push(n)}_parseMessageData(e){try{const s=JSON.parse(e);if(s.event)return{event:s.event,data:s.data||null}}catch{}return{event:null,data:null}}_dispatch(e,s,...n){const i=(this._on[e]||{})[s]||[];if(i.length!==0){N(`ws dispatch ${e} ${s}`);for(const r of i)r(...n)}}}const v=(t,e)=>`${window[t]!==`{{${t}}}`?window[t]:e}`,S=v("wsUrl",""),P=v("widgetToken","");var A={wsClient:t=>new O(S+"/"+t,P)};const L=1,h=1e3*L,d=60*h,f=60*d,p=24*f,_=t=>{if(t==="")throw new Error("unable to parse duration");const e=`${t}`.trim();if(!e)throw new Error("unable to parse duration");if(e.match(/^\d+$/))return parseInt(e,10);const s=e.match(/^((?:\d*)\.(?:\d*))(d|h|m|s)$/);if(s){const a=parseFloat(s[1]);if(isNaN(a))throw new Error("unable to parse duration");const c=s[2];let l=0;return c==="d"?l=a*p:c==="h"?l=a*f:c==="m"?l=a*d:c==="s"&&(l=a*h),Math.round(l)}const n=e.match(/^(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!n)throw new Error("unable to parse duration");const o=n[1]?parseInt(n[1],10):0,i=n[2]?parseInt(n[2],10):0,r=n[3]?parseInt(n[3],10):0,g=n[4]?parseInt(n[4],10):0,u=n[5]?parseInt(n[5],10):0;return g*h+r*d+i*f+o*p+u},U=t=>{try{return _(t)}catch{return 0}},B=t=>{let e=t;const s=Math.floor(e/p);e=e%p;const n=Math.floor(e/f);e=e%f;const o=Math.floor(e/d);e=e%d;const i=Math.floor(e/h);e=e%h;const r=e,g=["ms","s","m","h","d"],u=[r,i,o,n,s];let a=0;for(;a<u.length&&u[a]===0;)a++;let c=u.length-1;for(;c>=0&&u[c]===0;)c--;const l=[];for(let m=a;m<=c;m++)l.unshift(`${u[m]}${g[m]}`);return l.join(" ")};function W(t,e,s){if(s>=t.length)for(var n=s-t.length+1;n--;)t.push(void 0);return t.splice(s,0,t.splice(e,1)[0]),t}const R=(t,e)=>{const s=[/\$args\((\d*)(:?)(\d*)\)/g,/\$rand\(\s*(\d+)?\s*,\s*?(\d+)?\s*\)/g,/\$var\(([^)]+)\)/g,/\$user\.name/g,/\$customapi\(([^$\)]*)\)\[\'([A-Za-z0-9_ -]+)\'\]/g,/\$customapi\(([^$\)]*)\)/g,/\$urlencode\(([^$\)]*)\)/g,/\$calc\((\d+)([*/+-])(\d+)\)/g];let n=t,o;do{o=n;for(let i of s)n=n.replace(i,e)}while(o!==n);return n},q=(t,e=",",s=-1)=>{const n=t.split(e);return s===-1||n.length<=s?n:[...n.slice(0,s-1),n.slice(s-1).join(e)]},H=t=>{let e=t.length;for(;e>0;){const s=Math.floor(Math.random()*e);e--;const n=t[e];t[e]=t[s],t[s]=n}return t};var j={arrayMove:W,humanDuration:B,parseHumanDuration:U,mustParseHumanDuration:_,doDummyReplacements:R,split:q,shuffle:H},z=(t,e)=>{const s=t.__vccOpts||t;for(const[n,o]of e)s[n]=o;return s};const $=100,V=k({data(){return{ws:null,queue:[],worker:null,imgstyle:"",settings:{volume:100}}},methods:{async playone(t){return new Promise(async e=>{const s=[];t.image&&t.image.file&&(await this.prepareImage(t.image.file),this.imgstyle={backgroundImage:`url(/uploads/${encodeURIComponent(t.image.file)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",height:"100%"}),t.minDurationMs&&s.push(new Promise(n=>{setTimeout(n,j.parseHumanDuration(t.minDurationMs))})),t.sound&&t.sound.file&&s.push(new Promise(n=>{const o=new Audio(`/uploads/${encodeURIComponent(t.sound.file)}`);o.addEventListener("ended",()=>{n()});const i=this.settings.volume/100,r=t.sound.volume/100;o.volume=i*r,o.play()})),s.length===0&&s.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(s).then(n=>{this.imgstyle="",e()})})},addQueue(t){if(this.queue.push(t),this.worker)return;const e=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}await this.playone(this.queue.shift()),this.worker=setTimeout(e,$)};this.worker=setTimeout(e,$)},async prepareImage(t){return new Promise(e=>{const s=new Image;s.src="/uploads/"+encodeURIComponent(t),this.$nextTick(()=>{s.loaded?e():s.onload=e})})},playmedia(t){this.addQueue(t)}},mounted(){this.ws=A.wsClient("general"),this.ws.onMessage("init",t=>{this.settings=t.settings}),this.ws.onMessage("playmedia",t=>{this.playmedia(t)}),this.ws.connect()}});function x(t,e,s,n,o,i){return t.imgstyle?(I(),y("div",{key:0,style:M(t.imgstyle)},null,4)):E("",!0)}var F=z(V,[["render",x]]);const G=T(F);G.mount("#app");
