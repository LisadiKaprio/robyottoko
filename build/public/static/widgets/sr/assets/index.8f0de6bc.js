import{d as p,r as f,o as l,c as r,a,b,e as g,n as P,f as L,F as O,g as D,h as I,t as h,i as v,j as A}from"./vendor.b80ab9a7.js";const N=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};N();let c=[];const R=t=>{switch(t){case"error":c=["error"];break;case"info":c=["error","info"];break;case"log":c=["error","info","log"];break;case"debug":c=["error","info","log","debug"];break}};R("info");const $=(t,...e)=>{const s=t,i=n=>(...o)=>{c.includes(n)&&console[n](j("hh:mm:ss",new Date),`[${s}]`,...e,...o)};return{log:i("log"),info:i("info"),debug:i("debug"),error:i("error")}},j=(t,e)=>t.replace(/(hh|mm|ss)/g,(s,i)=>{switch(i){case"hh":return _(e.getHours(),"00");case"mm":return _(e.getMinutes(),"00");case"ss":return _(e.getSeconds(),"00");default:return s}}),_=(t,e)=>{const s=`${t}`;return s.length>=e.length?s:e.substr(0,e.length-s.length)+s},W=1001,k=4e3,S=$("WsWrapper.ts");class Y{constructor(e,s){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=e,this.protocols=s}send(e){this.handle?this.handle.send(e):this.sendBuffer.push(e)}connect(){const e=new WebSocket(this.addr,this.protocols);e.onopen=s=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=e;this.sendBuffer.length>0;){const i=this.sendBuffer.shift();i&&this.handle.send(i)}this.onopen(s)},e.onmessage=s=>{this.onmessage(s)},e.onclose=s=>{this.handle=null,s.code===k?S.info("custom disconnect, will not reconnect"):s.code===W?S.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(s)}}disconnect(){this.handle&&this.handle.close(k)}}const C=$("WsClient.ts");class F extends Y{constructor(e,s){super(e,s);this._on={},this.onopen=i=>{this._dispatch("socket","open",i)},this.onmessage=i=>{if(this._dispatch("socket","message",i),this._on.message){const n=this._parseMessageData(i.data);n.event&&this._dispatch("message",`${n.event}`,n.data)}},this.onclose=i=>{this._dispatch("socket","close",i)}}onSocket(e,s){this.addEventListener("socket",e,s)}onMessage(e,s){this.addEventListener("message",e,s)}addEventListener(e,s,i){const n=Array.isArray(s)?s:[s];this._on[e]=this._on[e]||{};for(const o of n)this._on[e][o]=this._on[e][o]||[],this._on[e][o].push(i)}_parseMessageData(e){try{const s=JSON.parse(e);if(s.event)return{event:s.event,data:s.data||null}}catch(s){C.info(s)}return{event:null,data:null}}_dispatch(e,s,...i){const o=(this._on[e]||{})[s]||[];if(o.length!==0){C.log(`ws dispatch ${e} ${s}`);for(const d of o)d(...i)}}}const T=(t,e)=>`${window[t]!==`{{${t}}}`?window[t]:e}`,q=T("wsUrl",""),U=T("widgetToken","");var z={wsClient:t=>new F(q+"/"+t,U)},y=(t,e)=>{const s=t.__vccOpts||t;for(const[i,n]of e)s[i]=n;return s};const G=p({data(){return{ws:null,filter:{tag:""},hasPlayed:!1,playlist:[],settings:{volume:100,hideVideoImage:{file:"",filename:""},customCss:"",customCssPresets:[],showProgressBar:!1,initAutoplay:!0,showThumbnails:!0,maxItemsShown:-1},progress:0,progressInterval:null,inited:!1}},watch:{playlist:function(t,e){t.find((s,i)=>!this.isFilteredOut(s,i))||this.player.stop()},filter:function(t,e){this.playlist.find((s,i)=>!this.isFilteredOut(s,i))||this.player.stop()}},computed:{classes(){return[this.settings.showThumbnails?"with-thumbnails":"without-thumbnails",this.settings.showProgressBar?"with-progress-bar":"without-progress-bar"]},player(){return this.$refs.youtube},progressValueStyle(){return{width:`${this.progress*100}%`}},playlistItems(){const t=[];for(const e in this.playlist){const s=this.playlist[e];this.isFilteredOut(s,e)||(t[e]=s)}return t},filteredPlaylist(){return this.filter.tag===""?this.playlist:this.playlist.filter(t=>t.tags.includes(this.filter.tag))},hidevideo(){return this.item?this.item.hidevideo:!1},item(){return this.filteredPlaylist[0]},hasItems(){return this.filteredPlaylist.length!==0}},methods:{isFilteredOut(t,e){return this.settings.maxItemsShown>=0&&this.settings.maxItemsShown-1<e?!0:this.filter.tag!==""&&!t.tags.includes(this.filter.tag)},ended(){this.sendMsg({event:"ended"})},sendMsg(t){this.ws.send(JSON.stringify(t))},play(){this.hasPlayed=!0,this.adjustVolume(),this.hasItems&&(this.player.play(this.item.yt),this.sendMsg({event:"play",id:this.item.id}))},unpause(){this.hasItems&&(this.player.unpause(),this.sendMsg({event:"unpause",id:this.item.id}))},pause(){this.hasItems&&(this.player.pause(),this.sendMsg({event:"pause"}))},adjustVolume(){this.player&&this.player.setVolume(this.settings.volume)},applySettings(t){if(this.settings.customCss!==t.customCss){let e=document.getElementById("customCss");e&&e.parentElement.removeChild(e),e=document.createElement("style"),e.id="customCss",e.textContent=t.customCss,document.head.appendChild(e)}this.settings.showProgressBar!==t.showProgressBar&&(this.progressInterval&&window.clearInterval(this.progressInterval),t.showProgressBar&&(this.progressInterval=window.setInterval(()=>{this.player&&(this.progress=this.player.getProgress())},500))),this.settings=t,this.adjustVolume()}},mounted(){this.ws=z.wsClient("sr"),this.ws.onMessage(["save","settings"],t=>{this.applySettings(t.settings)}),this.ws.onMessage(["onEnded","prev","skip","remove","clear","move","tags"],t=>{this.applySettings(t.settings);const e=this.filteredPlaylist.length>0?this.filteredPlaylist[0].id:null;this.filter=t.filter,this.playlist=t.playlist;const s=this.filteredPlaylist.length>0?this.filteredPlaylist[0].id:null;e!==s&&this.play()}),this.ws.onMessage(["filter"],t=>{this.applySettings(t.settings);const e=this.filteredPlaylist.length>0?this.filteredPlaylist[0].id:null;this.filter=t.filter,this.playlist=t.playlist,this.filteredPlaylist.find(s=>s.id===e)||this.play()}),this.ws.onMessage(["pause"],t=>{this.player.playing()&&this.pause()}),this.ws.onMessage(["unpause"],t=>{this.player.playing()||(this.hasPlayed?this.unpause():this.play())}),this.ws.onMessage(["loop"],t=>{this.player.setLoop(!0)}),this.ws.onMessage(["noloop"],t=>{this.player.setLoop(!1)}),this.ws.onMessage(["dislike","like","video","playIdx","resetStats","shuffle"],t=>{this.applySettings(t.settings),this.filter=t.filter,this.playlist=t.playlist}),this.ws.onMessage(["add","init"],t=>{this.applySettings(t.settings),this.filter=t.filter,this.playlist=t.playlist,!this.inited&&!this.player.playing()&&this.settings.initAutoplay&&this.play(),this.inited=!0}),this.ws.connect()}}),J={class:"player video-16-9"},H={key:1,class:"hide-video"},K={key:2,class:"progress"},Q={class:"list"};function X(t,e,s,i,n,o){const d=f("responsive-image"),M=f("youtube"),E=f("list-item");return l(),r("div",{class:I(["wrapper",t.classes])},[a("div",J,[t.hidevideo&&t.settings.hideVideoImage.file?(l(),b(d,{key:0,class:"hide-video",src:t.settings.hideVideoImage.file},null,8,["src"])):t.hidevideo?(l(),r("div",H)):g("",!0),t.settings.showProgressBar?(l(),r("div",K,[a("div",{class:"progress-value",style:P(t.progressValueStyle)},null,4)])):g("",!0),L(M,{ref:"youtube",onEnded:t.ended},null,8,["onEnded"])]),a("ol",Q,[(l(!0),r(O,null,D(t.playlistItems,(B,w)=>(l(),b(E,{class:I(w===0?"playing":"not-playing"),key:w,item:B,showThumbnails:t.settings.showThumbnails},null,8,["class","item","showThumbnails"]))),128))])],2)}var Z=y(G,[["render",X]]);const x=p({name:"responsive-image",props:{src:String,title:String,height:{type:String,default:"100%"},width:{type:String,default:"100%"}},computed:{style(){return{display:"inline-block",verticalAlign:"text-bottom",backgroundImage:`url(/uploads/${encodeURIComponent(this.src)})`,backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundPosition:"center",width:this.width,height:this.height}}}}),tt=["title"];function et(t,e,s,i,n,o){return l(),r("div",{class:"responsive-image",style:P(t.style),title:t.title},null,12,tt)}var st=y(x,[["render",et]]);const u=(...t)=>console.log("[youtube.js]",...t);let V=!1;function it(){return V?(u("ytapi ALREADY ready"),Promise.resolve()):new Promise(t=>{const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.head.append(e),window.onYouTubeIframeAPIReady=()=>{V=!0,u("ytapi ready"),t()}})}function nt(t){return new Promise(e=>{u("create player on "+t);const s=new YT.Player(t,{playerVars:{iv_load_policy:3,modestbranding:1},events:{onReady:()=>{u("player ready"),e(s)}}})})}async function ot(t){return await it(),await nt(t)}const at=p({name:"youtube",props:{visible:{type:Boolean,default:!0}},data:()=>({id:"",yt:null,toplay:null,tovolume:null,tryPlayInterval:null}),created(){this.id=`yt-${Math.floor(Math.random()*99+1)}-${new Date().getTime()}`},methods:{getDuration(){return this.yt?this.yt.getDuration():0},getCurrentTime(){return this.yt?this.yt.getCurrentTime():0},getProgress(){const t=this.getDuration(),e=this.getCurrentTime();return t?e/t:0},stop(){this.yt&&this.yt.stopVideo()},stopTryPlayInterval(){this.tryPlayInterval&&(clearInterval(this.tryPlayInterval),this.tryPlayInterval=null)},tryPlay(){if(this.stopTryPlayInterval(),!this.visible)return;this.yt.playVideo();let t=20;this.tryPlayInterval=setInterval(()=>{if(u("playing",this.playing(),"triesRemaining",t),--t,this.playing()||t<0){u("stopping interval"),this.stopTryPlayInterval();return}this.yt.playVideo()},250)},play(t){this.yt?(this.yt.cueVideoById(t),this.tryPlay()):this.toplay=t},pause(){this.yt&&this.yt.pauseVideo()},unpause(){this.yt&&this.tryPlay()},setVolume(t){this.yt?this.yt.setVolume(t):this.tovolume=t},setLoop(t){this.loop=t},playing(){return this.yt&&this.yt.getPlayerState()===1}},async mounted(){this.yt=await ot(this.id),this.tovolume!==null&&this.yt.setVolume(this.tovolume),this.toplay!==null&&(u("trying to play.."),this.play(this.toplay)),this.yt.addEventListener("onStateChange",t=>{t.data===YT.PlayerState.CUED?this.tryPlay():t.data===YT.PlayerState.ENDED&&(this.loop?this.tryPlay():this.$emit("ended"))})}}),lt=["id"];function rt(t,e,s,i,n,o){return l(),r("div",{id:t.id},null,8,lt)}var ht=y(at,[["render",rt]]);const dt=p({props:{item:{type:Object,required:!0},showThumbnails:{type:Boolean,required:!0}},template:" ",computed:{thumbnail(){return`https://i.ytimg.com/vi/${this.item.yt}/mqdefault.jpg`}}}),ut=["data-user","data-yt"],ct={key:0,class:"thumbnail"},pt={class:"media-16-9"},yt=["src"],mt={class:"title"},ft={class:"title-content title-orig"},gt={class:"title-content title-dupl"},vt={class:"meta meta-left"},_t={class:"meta-user"},wt=a("span",{class:"meta-user-text-before"},"requested by ",-1),bt={class:"meta-user-name"},Pt=a("span",{class:"meta-user-text-after"},null,-1),It={class:"meta-plays"},$t=a("span",{class:"meta-plays-text-before"},"played ",-1),kt={class:"meta-plays-count"},St={class:"meta-plays-text-after"},Ct={class:"meta meta-right vote"},Tt={class:"meta-plays"},Vt=a("i",{class:"fa fa-repeat"},null,-1),Mt={class:"vote-up"},Et=a("i",{class:"fa fa-thumbs-up"},null,-1),Bt={class:"vote-down"},Lt=a("i",{class:"fa fa-thumbs-down"},null,-1);function Ot(t,e,s,i,n,o){return l(),r("li",{class:"item","data-user":t.item.user,"data-yt":t.item.yt},[t.showThumbnails?(l(),r("div",ct,[a("div",pt,[a("img",{src:t.thumbnail},null,8,yt)])])):g("",!0),a("div",mt,[a("span",ft,h(t.item.title||t.item.yt),1),a("span",gt,h(t.item.title||t.item.yt),1)]),a("div",vt,[a("span",_t,[wt,a("span",bt,h(t.item.user),1),Pt]),a("span",It,[$t,a("span",kt,h(t.item.plays),1),a("span",St," time"+h(t.item.plays===1?"":"s"),1)])]),a("div",Ct,[a("span",Tt,[Vt,v(" "+h(t.item.plays),1)]),a("span",Mt,[Et,v(" "+h(t.item.goods),1)]),a("span",Bt,[Lt,v(" "+h(t.item.bads),1)])])],8,ut)}var Dt=y(dt,[["render",Ot]]);const m=A(Z);m.component("responsive-image",st);m.component("youtube",ht);m.component("list-item",Dt);m.mount("#app");
