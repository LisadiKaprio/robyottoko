import{d as L,c as p,a as d,n as U,b as B,e as q,F as N,o as m,r as R,f as V}from"./vendor.e90aaa32.js";const W=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};W();const S=async(e,s,t)=>new Promise((n,i)=>{const o=new window.XMLHttpRequest;o.open(e,s,!0),o.withCredentials=!0;const a=t.headers||{};for(const l in a)o.setRequestHeader(l,a[l]);o.addEventListener("load",function(l){n({status:this.status,text:this.responseText,json:async()=>JSON.parse(this.responseText)})}),o.addEventListener("error",function(l){i(new Error("xhr error"))}),o.upload&&t.onUploadProgress&&o.upload.addEventListener("progress",function(l){t.onUploadProgress&&t.onUploadProgress(l)}),o.send(t.body)}),h=async(e,s={})=>S("get",e,s),H=async(e,s={})=>S("post",e,s),C=async(e,s)=>S("post",e,{headers:{Accept:"application/json","Content-Type":"application/json"},body:s}),c=async(e,s)=>C(e,JSON.stringify(s));var j={resendVerificationMail:async e=>c("/api/user/_resend_verification_mail",e),requestPasswordReset:async e=>c("/api/user/_request_password_reset",e),register:async e=>c("/api/user/_register",e),resetPassword:async e=>c("/api/user/_reset_password",e),handleToken:async e=>c("/api/_handle-token",e),saveVariables:async e=>c("/api/save-variables",e),twitchUserIdByName:async e=>c("/api/twitch/user-id-by-name",e),saveUserSettings:async e=>c("/api/save-settings",e),getPageVariablesData:async()=>h("/api/page/variables"),getPageIndexData:async()=>h("/api/page/index"),getPageSettingsData:async()=>h("/api/page/settings"),getDataGlobal:async()=>h("/api/data/global"),getMe:async()=>h("/api/user/me"),logout:async()=>H("/api/logout"),login:async e=>c("/api/auth",e),getConf:async()=>h("/api/conf"),upload:async(e,s)=>{const t=new FormData;return t.append("file",e,e.name),S("post","/api/upload",{body:t,onUploadProgress:s})},importPlaylist:async e=>C("/api/sr/import",e),getDrawcastAllImages:async()=>h("/api/drawcast/all-images/"),createWidgetUrl:async e=>c("/api/widget/create_url",e)};const J=1,_=1e3*J,y=60*_,$=60*y,A=24*$;let w=[];const z=e=>{switch(e){case"error":w=["error"];break;case"info":w=["error","info"];break;case"log":w=["error","info","log"];break;case"debug":w=["error","info","log","debug"];break}};z("info");const P=(e,...s)=>{const t=e,n=i=>(...o)=>{w.includes(i)&&console[i](G("hh:mm:ss",new Date),`[${t}]`,...s,...o)};return{log:n("log"),info:n("info"),debug:n("debug"),error:n("error")}},Q=e=>[...e].length,G=(e,s)=>e.replace(/(hh|mm|ss)/g,(t,n)=>{switch(n){case"hh":return M(s.getHours(),"00");case"mm":return M(s.getMinutes(),"00");case"ss":return M(s.getSeconds(),"00");default:return t}}),M=(e,s)=>{const t=`${e}`;return t.length>=s.length?t:s.substr(0,s.length-t.length)+t},T=(e,s=!1)=>{if(e==="")throw new Error("unable to parse duration");const t=`${e}`.trim();if(!t)throw new Error("unable to parse duration");const n=r=>{if(r<0&&!s)throw new Error("negative value not allowed");return r};if(t.match(/^-?\d+$/))return n(parseInt(t,10));const i=t.match(/^(-?(?:\d*)\.(?:\d*))(d|h|m|s)$/);if(i){const r=parseFloat(i[1]);if(isNaN(r))throw new Error("unable to parse duration");const k=i[2];let v=0;return k==="d"?v=r*A:k==="h"?v=r*$:k==="m"?v=r*y:k==="s"&&(v=r*_),n(Math.round(v))}const o=t.match(/^(-?)(?:(\d+)d)?\s?(?:(\d+)h)?\s?(?:(\d+)m)?\s?(?:(\d+)s)?\s?(?:(\d+)ms)?$/);if(!o)throw new Error("unable to parse duration");const a=o[1]?-1:1,l=o[2]?parseInt(o[2],10):0,u=o[3]?parseInt(o[3],10):0,g=o[4]?parseInt(o[4],10):0,f=o[5]?parseInt(o[5],10):0,b=o[6]?parseInt(o[6],10):0;return n(a*(f*_+g*y+u*$+l*A+b))},Y=(e,s=!1)=>{try{return T(e,s)}catch{return 0}},K=(e,s=["ms","s","m","h","d"])=>{let t=e;const n=Math.floor(t/A);t=t%A;const i=Math.floor(t/$);t=t%$;const o=Math.floor(t/y);t=t%y;const a=Math.floor(t/_);t=t%_;const u=[t,a,o,i,n];let g=0;for(;g<u.length&&u[g]===0;)g++;let f=u.length-1;for(;f>=0&&u[f]===0;)f--;const b=[];for(let r=g;r<=f;r++)b.unshift(`${u[r]}${s[r]}`);return b.join(" ")};function X(e,s,t){if(t>=e.length){let n=t-e.length+1;for(;n--;)e.push(void 0)}return e.splice(t,0,e.splice(s,1)[0]),e}const Z=(e,s,t)=>{if(s===t||s<0||s>e.length-1||t<0||t>e.length-1)return!1;const n=e[s];return e[s]=e[t],e[t]=n,!0},x=(e,s)=>{const t=[/\$args(?:\((\d*)(:?)(\d*)\))?/g,/\$rand\(\s*(\d+)?\s*,\s*?(\d+)?\s*\)/g,/\$var\(([^)]+)\)/g,/\$bot\.(version|date|website|github|features)/g,/\$user(?:\(([^)]+)\)|())\.(name|profile_image_url|recent_clip_url|last_stream_category)/g,/\$customapi\(([^$)]*)\)\['([A-Za-z0-9_ -]+)'\]/g,/\$customapi\(([^$)]*)\)/g,/\$urlencode\(([^$)]*)\)/g,/\$calc\((\d+)([*/+-])(\d+)\)/g];let n=e,i;do{i=n;for(const o of t)n=n.replace(o,s)}while(i!==n);return n},ee=(e,s=",",t=-1)=>{const n=e.split(s);return t===-1||n.length<=t?n:[...n.slice(0,t-1),n.slice(t-1).join(s)]},te=e=>{let s=e.length;for(;s>0;){const t=Math.floor(Math.random()*s);s--;const n=e[s];e[s]=e[t],e[t]=n}return e};function se(e){return{filename:e.originalname,file:e.filename,urlpath:e.urlpath}}function ne(e){return{filename:e.originalname,file:e.filename,urlpath:e.urlpath,volume:100}}const oe=(e,s="pt")=>{const t=`${e}`;return t.match(/^\d+$/)?`${t}${s}`:t};var ie={unicodeLength:Q,arrayMove:X,arraySwap:Z,humanDuration:K,parseHumanDuration:Y,mustParseHumanDuration:T,doDummyReplacements:x,split:ee,shuffle:te,pad:M,mediaFileFromUploadedFile:se,soundMediaFileFromUploadedFile:ne,toNumberUnitString:oe};const ae=1001,D=4e3,I=P("WsWrapper.ts");class re{constructor(s,t){this.handle=null,this.reconnectTimeout=null,this.sendBuffer=[],this.onopen=()=>{},this.onclose=()=>{},this.onmessage=()=>{},this.addr=s,this.protocols=t}send(s){this.handle?this.handle.send(s):this.sendBuffer.push(s)}connect(){const s=new WebSocket(this.addr,this.protocols);s.onopen=t=>{for(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.handle=s;this.sendBuffer.length>0;){const n=this.sendBuffer.shift();n&&this.handle.send(n)}this.onopen(t)},s.onmessage=t=>{this.onmessage(t)},s.onclose=t=>{this.handle=null,t.code===D?I.info("custom disconnect, will not reconnect"):t.code===ae?I.info("going away, will not reconnect"):this.reconnectTimeout=setTimeout(()=>{this.connect()},1e3),this.onclose(t)}}disconnect(){this.handle&&this.handle.close(D)}}const E=P("WsClient.ts");class le extends re{constructor(s,t){super(s,t);this._on={},this.onopen=n=>{this._dispatch("socket","open",n)},this.onmessage=n=>{if(this._dispatch("socket","message",n),this._on.message){const i=this._parseMessageData(n.data);i.event&&this._dispatch("message",`${i.event}`,i.data,i)}},this.onclose=n=>{this._dispatch("socket","close",n)}}onSocket(s,t){this.addEventListener("socket",s,t)}onMessage(s,t){this.addEventListener("message",s,t)}addEventListener(s,t,n){const i=Array.isArray(t)?t:[t];this._on[s]=this._on[s]||{};for(const o of i)this._on[s][o]=this._on[s][o]||[],this._on[s][o].push(n)}_parseMessageData(s){try{const t=JSON.parse(s);if(t.event)return t.data=t.data||null,t}catch(t){E.info(t)}return{event:null,data:null}}_dispatch(s,t,...n){const o=(this._on[s]||{})[t]||[];if(o.length!==0){E.log(`ws dispatch ${s} ${t}`);for(const a of o)a(...n)}}}const O=(e,s)=>`${window[e]!==`{{${e}}}`?window[e]:s}`,ce=O("wsUrl",""),ue=O("widgetToken","");var de={wsClient:e=>new le(ce+"/widget_"+e,ue)};var F=(e,s)=>{const t=e.__vccOpts||e;for(const[n,i]of s)t[n]=i;return t};const he=L({props:{timeBetweenMediaMs:{type:Number,default:400},baseVolume:{type:Number,default:100},displayLatestForever:{type:Boolean,default:!1}},data(){return{queue:[],worker:null,showimage:!1,imgstyle:null,videosrc:"",latestResolved:!0}},methods:{async _playone(e){return new Promise(async s=>{this.latestResolved=!1;const t=[];e.twitch_clip.url&&(this.videosrc=e.twitch_clip.url,t.push(new Promise(n=>{this.$nextTick(()=>{this.$refs.video.volume=e.twitch_clip.volume?100/e.twitch_clip.volume:0,this.$refs.video.addEventListener("ended",()=>{n()})})}))),e.image_url?(this.showimage=!0,this.imgstyle={backgroundImage:`url(${e.image_url})`}):e.image&&e.image.file&&(await this._prepareImage(e.image.urlpath),this.showimage=!0,this.imgstyle={backgroundImage:`url(${e.image.urlpath})`}),e.minDurationMs&&t.push(new Promise(n=>{setTimeout(n,ie.parseHumanDuration(e.minDurationMs))})),e.sound&&e.sound.file&&t.push(new Promise(n=>{const i=new Audio(e.sound.urlpath);i.addEventListener("ended",()=>{n()});const o=this.baseVolume/100,a=e.sound.volume/100;i.volume=o*a,i.play()})),t.length===0&&t.push(new Promise(n=>{setTimeout(n,1e3)})),Promise.all(t).then(n=>{this.displayLatestForever||(this.showimage=!1),this.latestResolved=!0,this.videosrc="",s()})})},_addQueue(e){if(this.queue.push(e),this.worker)return;const s=async()=>{if(this.queue.length===0){clearInterval(this.worker),this.worker=null;return}const t=this.queue.shift();if(!t){clearInterval(this.worker),this.worker=null;return}await this._playone(t),this.worker=setTimeout(s,this.timeBetweenMediaMs)};this.worker=setTimeout(s,this.timeBetweenMediaMs)},async _prepareImage(e){return new Promise(s=>{const t=new Image;t.src=e,this.$nextTick(()=>{t.loaded?s():t.onload=s})})},playmedia(e){!this.displayLatestForever&&this.latestResolved&&(this.showimage=!1),this._addQueue(e)}}}),pe={key:0,class:"video-container"},me={class:"video-16-9"},ge=["src"];function fe(e,s,t,n,i,o){return m(),p(N,null,[d("div",{style:U(e.imgstyle),class:B(["image-container",{"m-fadeIn":e.showimage,"m-fadeOut":!e.showimage}])},null,6),e.videosrc?(m(),p("div",pe,[d("div",me,[d("video",{src:e.videosrc,ref:"video",autoplay:""},null,8,ge)])])):q("",!0)],64)}var ve=F(he,[["render",fe],["__scopeId","data-v-3ece661a"]]);const we=L({components:{MediaQueueElement:ve},data(){return{inited:!1,ws:null,notificationSoundAudio:null,manualApproval:{items:[]}}},methods:{approveImage(e){this.sendMsg({event:"approve_image",path:e})},denyImage(e){this.sendMsg({event:"deny_image",path:e})},sendMsg(e){if(!this.ws){console.warn("sendMsg: this.ws not initialized");return}this.ws.send(JSON.stringify(e))}},mounted(){this.ws=de.wsClient("drawcast_control"),this.ws.onMessage("init",async e=>{const t=await(await j.getDrawcastAllImages()).json();e.settings.notificationSound&&(this.notificationSoundAudio=new Audio(e.settings.notificationSound.urlpath),this.notificationSoundAudio.volume=e.settings.notificationSound.volume/100),this.manualApproval.items=t.filter(n=>!n.approved).map(n=>n.path),this.inited=!0}),this.ws.onMessage("approved_image_received",e=>{this.manualApproval.items=this.manualApproval.items.filter(s=>s!==e.img)}),this.ws.onMessage("denied_image_received",e=>{this.manualApproval.items=this.manualApproval.items.filter(s=>s!==e.img)}),this.ws.onMessage("image_received",e=>{this.manualApproval.items=this.manualApproval.items.filter(s=>s!==e.img),this.manualApproval.items.push(e.img),this.manualApproval.items=this.manualApproval.items.slice(),e.mayNotify&&this.notificationSoundAudio&&this.notificationSoundAudio.play()}),this.ws.connect()}}),_e={class:"p-2"},ye=d("h1",{class:"title"},"Drawings awaiting approval",-1),$e={key:0},be={class:"card-body"},ke=["src"],Me={class:"card-footer"},Ae=["onClick"],Se=["onClick"],De={key:1};function Ie(e,s,t,n,i,o){return m(),p("div",_e,[ye,e.manualApproval.items.length?(m(),p("div",$e,[(m(!0),p(N,null,R(e.manualApproval.items,(a,l)=>(m(),p("div",{class:"image-to-approve card mr-1",key:l},[d("div",be,[d("img",{src:a,class:"thumbnail mr-1"},null,8,ke)]),d("div",Me,[d("span",{class:"card-footer-item button is-small is-success is-light",onClick:u=>e.approveImage(a)}," Approve! ",8,Ae),d("span",{class:"card-footer-item button is-small is-danger is-light",onClick:u=>e.denyImage(a)}," Deny! ",8,Se)])]))),128))])):(m(),p("div",De,"Currently there are no drawings awaiting approval."))])}var Ee=F(we,[["render",Ie]]);const Le=V(Ee);Le.mount("#app");
